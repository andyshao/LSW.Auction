angular.module("SignalR",[]).constant("$",window.jQuery).factory("Hub",["$",function(e){function t(t){var i=null;return i=t&&t.rootPath?e.hubConnection(t.rootPath,{useDefaultPath:!1}):e.hubConnection(),i.logging=t&&t.logging?!0:!1,i}function i(e){var i=!(e&&e.useSharedConnection===!1);return i?"undefined"==typeof n[e.rootPath]?n[e.rootPath]=t(e):n[e.rootPath]:t(e)}var n=[];return function(t,n){var o=this;return o.connection=i(n),o.proxy=o.connection.createHubProxy(t),o.on=function(e,t){o.proxy.on(e,t)},o.invoke=function(e,t){return o.proxy.invoke.apply(o.proxy,arguments)},o.disconnect=function(){o.connection.stop()},o.connect=function(e){var t={};return n.transport&&(t.transport=n.transport),n.jsonp&&(t.jsonp=n.jsonp),angular.isDefined(n.withCredentials)&&(t.withCredentials=n.withCredentials),e&&(o.connection.qs=e),o.connection.start(t)},n&&n.listeners&&Object.getOwnPropertyNames(n.listeners).filter(function(e){return"function"==typeof n.listeners[e]}).forEach(function(e){o.on(e,n.listeners[e])}),n&&n.methods&&angular.forEach(n.methods,function(t){o[t]=function(){var i=e.makeArray(arguments);return i.unshift(t),o.invoke.apply(o,i)}}),n&&n.queryParams&&(o.connection.qs=n.queryParams),n&&n.errorHandler&&o.connection.error(n.errorHandler),n&&n.stateChanged&&o.connection.stateChanged(n.stateChanged),(void 0===n.autoConnect||n.autoConnect)&&(o.promise=o.connect()),o}}]),"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="SignalR"),$(function(){$("#reservationtime").daterangepicker({timePicker:!0,timePicker24Hour:!0,startDate:moment($("#StartTime").val()),endDate:moment($("#EndTime").val())},function(e,t){$("#StartTime").val(e.format("YYYY-MM-DD HH:mm:ss")),$("#EndTime").val(t.format("YYYY-MM-DD HH:mm:ss"))})}),function(){var e=window.UMEDITOR_HOME_URL||function(){function e(){this.documentURL=self.document.URL||self.location.href,this.separator="/",this.separatorPattern=/\\|\//g,this.currentDir="./",this.currentDirPattern=/^[.]\/]/,this.path=this.documentURL,this.stack=[],this.push(this.documentURL)}function t(){var t=e.getProtocol(this.path||"");t?(this.protocol=t,this.localSeparator=/\\|\//.exec(this.path.replace(t,""))[0],this.stack=[]):(t=/\\|\//.exec(this.path),t&&(this.localSeparator=t[0]))}function i(){var t=this.path.replace(this.currentDirPattern,"");e.hasProtocol(this.path)&&(t=t.replace(this.protocol,"")),t=t.split(this.localSeparator),t.length=t.length-1;for(var i,n=0,o=t.length,a=this.stack;o>n;n++)i=t[n],i&&(e.isParentPath(i)?a.pop():a.push(i))}e.isParentPath=function(e){return".."===e},e.hasProtocol=function(t){return!!e.getProtocol(t)},e.getProtocol=function(e){var t=/^[^:]*:\/*/.exec(e);return t?t[0]:null},e.prototype={push:function(e){return this.path=e,t.call(this),i.call(this),this},getPath:function(){return this+""},toString:function(){return this.protocol+this.stack.concat([""]).join(this.separator)}};var n=document.getElementsByTagName("script");return n=n[n.length-1].src,(new e).push(n)+""}();window.UMEDITOR_CONFIG={UMEDITOR_HOME_URL:e,imageUrl:"/admin/home/UploadFile",imagePath:"",imageFieldName:"upfile",toolbar:["source | undo redo | bold italic underline strikethrough | superscript subscript | forecolor backcolor | removeformat |","insertorderedlist insertunorderedlist | selectall cleardoc paragraph | fontfamily fontsize","| justifyleft justifycenter justifyright justifyjustify |","link unlink | emotion image video  | map","| horizontal print preview fullscreen","drafts","formula"]}}(),function($){function getListener(e,t,i){var n;return t=t.toLowerCase(),(n=e.__allListeners||i&&(e.__allListeners={}))&&(n[t]||i&&(n[t]=[]))}function getDomNode(e,t,i,n,o,a){var r,s=n&&e[t];for(!s&&(s=e[i]);!s&&(r=(r||e).parentNode);){if("BODY"==r.tagName||a&&!a(r))return null;s=r[i]}return s&&o&&!o(s)?getDomNode(s,t,i,!1,o):s}UMEDITOR_CONFIG=window.UMEDITOR_CONFIG||{},window.UM={plugins:{},commands:{},I18N:{},version:"1.2.2"};var dom=UM.dom={},browser=UM.browser=function(){var e=navigator.userAgent.toLowerCase(),t=window.opera,i={ie:/(msie\s|trident.*rv:)([\w.]+)/.test(e),opera:!!t&&t.version,webkit:e.indexOf(" applewebkit/")>-1,mac:e.indexOf("macintosh")>-1,quirks:"BackCompat"==document.compatMode};i.gecko="Gecko"==navigator.product&&!i.webkit&&!i.opera&&!i.ie;var n=0;if(i.ie){var o=e.match(/(?:msie\s([\w.]+))/),a=e.match(/(?:trident.*rv:([\w.]+))/);n=o&&a&&o[1]&&a[1]?Math.max(1*o[1],1*a[1]):o&&o[1]?1*o[1]:a&&a[1]?1*a[1]:0,i.ie11Compat=11==document.documentMode,i.ie9Compat=9==document.documentMode,i.ie8=!!document.documentMode,i.ie8Compat=8==document.documentMode,i.ie7Compat=7==n&&!document.documentMode||7==document.documentMode,i.ie6Compat=7>n||i.quirks,i.ie9above=n>8,i.ie9below=9>n}if(i.gecko){var r=e.match(/rv:([\d\.]+)/);r&&(r=r[1].split("."),n=1e4*r[0]+100*(r[1]||0)+1*(r[2]||0))}return/chrome\/(\d+\.\d)/i.test(e)&&(i.chrome=+RegExp.$1),/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(e)&&!/chrome/i.test(e)&&(i.safari=+(RegExp.$1||RegExp.$2)),i.opera&&(n=parseFloat(t.version())),i.webkit&&(n=parseFloat(e.match(/ applewebkit\/(\d+)/)[1])),i.version=n,i.isCompatible=!i.mobile&&(i.ie&&n>=6||i.gecko&&n>=10801||i.opera&&n>=9.5||i.air&&n>=1||i.webkit&&n>=522||!1),i}(),ie=browser.ie,webkit=browser.webkit,gecko=browser.gecko,opera=browser.opera,utils=UM.utils={each:function(e,t,i){if(null!=e)if(e.length===+e.length){for(var n=0,o=e.length;o>n;n++)if(t.call(i,e[n],n,e)===!1)return!1}else for(var a in e)if(e.hasOwnProperty(a)&&t.call(i,e[a],a,e)===!1)return!1},makeInstance:function(e){var t=new Function;return t.prototype=e,e=new t,t.prototype=null,e},extend:function(e,t,i){if(t)for(var n in t)i&&e.hasOwnProperty(n)||(e[n]=t[n]);return e},extend2:function(e){for(var t=arguments,i=1;i<t.length;i++){var n=t[i];for(var o in n)e.hasOwnProperty(o)||(e[o]=n[o])}return e},inherits:function(e,t){var i=e.prototype,n=utils.makeInstance(t.prototype);return utils.extend(n,i,!0),e.prototype=n,n.constructor=e},bind:function(e,t){return function(){return e.apply(t,arguments)}},defer:function(e,t,i){var n;return function(){i&&clearTimeout(n),n=setTimeout(e,t)}},indexOf:function(e,t,i){var n=-1;return i=this.isNumber(i)?i:0,this.each(e,function(e,o){return o>=i&&e===t?(n=o,!1):void 0}),n},removeItem:function(e,t){for(var i=0,n=e.length;n>i;i++)e[i]===t&&(e.splice(i,1),i--)},trim:function(e){return e.replace(/(^[ \t\n\r]+)|([ \t\n\r]+$)/g,"")},listToMap:function(e){if(!e)return{};e=utils.isArray(e)?e:e.split(",");for(var t,i=0,n={};t=e[i++];)n[t.toUpperCase()]=n[t]=1;return n},unhtml:function(e,t){return e?e.replace(t||/[&<">'](?:(amp|lt|quot|gt|#39|nbsp);)?/g,function(e,t){return t?e:{"<":"&lt;","&":"&amp;",'"':"&quot;",">":"&gt;","'":"&#39;"}[e]}):""},html:function(e){return e?e.replace(/&((g|l|quo)t|amp|#39);/g,function(e){return{"&lt;":"<","&amp;":"&","&quot;":'"',"&gt;":">","&#39;":"'"}[e]}):""},cssStyleToDomStyle:function(){var e=document.createElement("div").style,t={"float":void 0!=e.cssFloat?"cssFloat":void 0!=e.styleFloat?"styleFloat":"float"};return function(e){return t[e]||(t[e]=e.toLowerCase().replace(/-./g,function(e){return e.charAt(1).toUpperCase()}))}}(),loadFile:function(){function e(e,i){try{for(var n,o=0;n=t[o++];)if(n.doc===e&&n.url==(i.src||i.href))return n}catch(a){return null}}var t=[];return function(i,n,o){var a=e(i,n);if(a)return void(a.ready?o&&o():a.funs.push(o));if(t.push({doc:i,url:n.src||n.href,funs:[o]}),!i.body){var r=[];for(var s in n)"tag"!=s&&r.push(s+'="'+n[s]+'"');return void i.write("<"+n.tag+" "+r.join(" ")+" ></"+n.tag+">")}if(!n.id||!i.getElementById(n.id)){var l=i.createElement(n.tag);delete n.tag;for(var s in n)l.setAttribute(s,n[s]);l.onload=l.onreadystatechange=function(){if(!this.readyState||/loaded|complete/.test(this.readyState)){if(a=e(i,n),a.funs.length>0){a.ready=1;for(var t;t=a.funs.pop();)t()}l.onload=l.onreadystatechange=null}},l.onerror=function(){throw Error("The load "+(n.href||n.src)+" fails,check the url settings of file umeditor.config.js ")},i.getElementsByTagName("head")[0].appendChild(l)}}}(),isEmptyObject:function(e){if(null==e)return!0;if(this.isArray(e)||this.isString(e))return 0===e.length;for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},fixColor:function(e,t){if(/color/i.test(e)&&/rgba?/.test(t)){var i=t.split(",");if(i.length>3)return"";t="#";for(var n,o=0;n=i[o++];)n=parseInt(n.replace(/[^\d]/gi,""),10).toString(16),t+=1==n.length?"0"+n:n;t=t.toUpperCase()}return t},clone:function(e,t){var i;t=t||{};for(var n in e)e.hasOwnProperty(n)&&(i=e[n],"object"==typeof i?(t[n]=utils.isArray(i)?[]:{},utils.clone(e[n],t[n])):t[n]=i);return t},transUnitToPx:function(e){if(!/(pt|cm)/.test(e))return e;var t;switch(e.replace(/([\d.]+)(\w+)/,function(i,n,o){e=n,t=o}),t){case"cm":e=25*parseFloat(e);break;case"pt":e=Math.round(96*parseFloat(e)/72)}return e+(e?"px":"")},cssRule:browser.ie&&11!=browser.version?function(e,t,i){var n,o;i=i||document,n=i.indexList?i.indexList:i.indexList={};var a;if(n[e])a=i.styleSheets[n[e]];else{if(void 0===t)return"";a=i.createStyleSheet("",o=i.styleSheets.length),n[e]=o}return void 0===t?a.cssText:void(a.cssText=t||"")}:function(e,t,i){i=i||document;var n,o=i.getElementsByTagName("head")[0];if(!(n=i.getElementById(e))){if(void 0===t)return"";n=i.createElement("style"),n.id=e,o.appendChild(n)}return void 0===t?n.innerHTML:void(""!==t?n.innerHTML=t:o.removeChild(n))}};utils.each(["String","Function","Array","Number","RegExp","Object"],function(e){UM.utils["is"+e]=function(t){return Object.prototype.toString.apply(t)=="[object "+e+"]"}});var EventBase=UM.EventBase=function(){};EventBase.prototype={addListener:function(e,t){e=utils.trim(e).split(" ");for(var i,n=0;i=e[n++];)getListener(this,i,!0).push(t)},removeListener:function(e,t){e=utils.trim(e).split(" ");for(var i,n=0;i=e[n++];)utils.removeItem(getListener(this,i)||[],t)},fireEvent:function(){var e=arguments[0];e=utils.trim(e).split(" ");for(var t,i=0;t=e[i++];){var n,o,a,r=getListener(this,t);if(r)for(a=r.length;a--;)if(r[a]){if(o=r[a].apply(this,arguments),o===!0)return o;void 0!==o&&(n=o)}(o=this["on"+t.toLowerCase()])&&(n=o.apply(this,arguments))}return n}};var dtd=dom.dtd=function(){function e(e){for(var t in e)e[t.toUpperCase()]=e[t];return e}var t=utils.extend2,i=e({isindex:1,fieldset:1}),n=e({input:1,button:1,select:1,textarea:1,label:1}),o=t(e({a:1}),n),a=t({iframe:1},o),r=e({hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1}),s=e({ins:1,del:1,script:1,style:1}),l=t(e({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1}),s),d=t(e({sub:1,img:1,embed:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1}),l),c=t(e({p:1}),d),u=t(e({iframe:1}),d,n),h=e({img:1,embed:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1}),f=t(e({a:0}),u),p=e({tr:1}),m=e({"#":1}),g=t(e({param:1}),h),v=t(e({form:1}),i,a,r,c),b=e({li:1,ol:1,ul:1}),y=e({style:1,script:1}),w=e({base:1,link:1,meta:1,title:1}),C=t(w,y),x=e({head:1,body:1}),k=e({html:1}),N=e({address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1}),$=e({area:1,base:1,basefont:1,br:1,col:1,command:1,dialog:1,embed:1,hr:1,img:1,input:1,isindex:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1});return e({$nonBodyContent:t(k,x,w),$block:N,$inline:f,$inlineWithA:t(e({a:1}),f),$body:t(e({script:1,style:1}),N),$cdata:e({script:1,style:1}),$empty:$,$nonChild:e({iframe:1,textarea:1}),$listItem:e({dd:1,dt:1,li:1}),$list:e({ul:1,ol:1,dl:1}),$isNotEmpty:e({table:1,ul:1,ol:1,dl:1,iframe:1,area:1,base:1,col:1,hr:1,img:1,embed:1,input:1,link:1,meta:1,param:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1}),$removeEmpty:e({a:1,abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1}),$removeEmptyBlock:e({p:1,div:1}),$tableContent:e({caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1,table:1}),$notTransContent:e({pre:1,script:1,style:1,textarea:1}),html:x,head:C,style:m,script:m,body:v,base:{},link:{},meta:{},title:m,col:{},tr:e({td:1,th:1}),img:{},embed:{},colgroup:e({thead:1,col:1,tbody:1,tr:1,tfoot:1}),noscript:v,td:v,br:{},th:v,center:v,kbd:f,button:t(c,r),basefont:{},h5:f,h4:f,samp:f,h6:f,ol:b,h1:f,h3:f,option:m,h2:f,form:t(i,a,r,c),select:e({optgroup:1,option:1}),font:f,ins:f,menu:b,abbr:f,label:f,table:e({thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1}),code:f,tfoot:p,cite:f,li:v,input:{},iframe:v,strong:f,textarea:m,noframes:v,big:f,small:f,span:e({"#":1,br:1,b:1,strong:1,u:1,i:1,em:1,sub:1,sup:1,strike:1,span:1}),hr:f,dt:f,sub:f,optgroup:e({option:1}),param:{},bdo:f,"var":f,div:v,object:g,sup:f,dd:v,strike:f,area:{},dir:b,map:t(e({area:1,form:1,p:1}),i,s,r),applet:g,dl:e({dt:1,dd:1}),del:f,isindex:{},fieldset:t(e({legend:1}),h),thead:p,ul:b,acronym:f,b:f,a:t(e({a:1}),u),blockquote:t(e({td:1,tr:1,tbody:1,li:1}),v),caption:f,i:f,u:f,tbody:p,s:f,address:t(a,c),tt:f,legend:f,q:f,pre:t(l,o),p:t(e({a:1}),f),em:f,dfn:f})}(),attrFix=ie&&browser.version<9?{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder"}:{tabindex:"tabIndex",readonly:"readOnly"},styleBlock=utils.listToMap(["-webkit-box","-moz-box","block","list-item","table","table-row-group","table-header-group","table-footer-group","table-row","table-column-group","table-column","table-cell","table-caption"]),domUtils=dom.domUtils={NODE_ELEMENT:1,NODE_DOCUMENT:9,NODE_TEXT:3,NODE_COMMENT:8,NODE_DOCUMENT_FRAGMENT:11,POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16,fillChar:ie&&"6"==browser.version?"\ufeff":"​",keys:{8:1,46:1,16:1,17:1,18:1,37:1,38:1,39:1,40:1,13:1},breakParent:function(e,t){var i,n,o,a=e,r=e;do{for(a=a.parentNode,n?(i=a.cloneNode(!1),i.appendChild(n),n=i,i=a.cloneNode(!1),i.appendChild(o),o=i):(n=a.cloneNode(!1),o=n.cloneNode(!1));i=r.previousSibling;)n.insertBefore(i,n.firstChild);for(;i=r.nextSibling;)o.appendChild(i);r=a}while(t!==a);return i=t.parentNode,i.insertBefore(n,t),i.insertBefore(o,t),i.insertBefore(e,o),domUtils.remove(t),e},trimWhiteTextNode:function(e){function t(t){for(var i;(i=e[t])&&3==i.nodeType&&domUtils.isWhitespace(i);)e.removeChild(i)}t("firstChild"),t("lastChild")},getPosition:function(e,t){if(e===t)return 0;var i,n=[e],o=[t];for(i=e;i=i.parentNode;){if(i===t)return 10;n.push(i)}for(i=t;i=i.parentNode;){if(i===e)return 20;o.push(i)}if(n.reverse(),o.reverse(),n[0]!==o[0])return 1;for(var a=-1;a++,n[a]===o[a];);for(e=n[a],t=o[a];e=e.nextSibling;)if(e===t)return 4;return 2},getNodeIndex:function(e,t){for(var i=e,n=0;i=i.previousSibling;)t&&3==i.nodeType?i.nodeType!=i.nextSibling.nodeType&&n++:n++;return n},inDoc:function(e,t){return 10==domUtils.getPosition(e,t)},findParent:function(e,t,i){if(e&&!domUtils.isBody(e))for(e=i?e:e.parentNode;e;){if(!t||t(e)||domUtils.isBody(e))return t&&!t(e)&&domUtils.isBody(e)?null:e;e=e.parentNode}return null},findParentByTagName:function(e,t,i,n){return t=utils.listToMap(utils.isArray(t)?t:[t]),domUtils.findParent(e,function(e){return t[e.tagName]&&!(n&&n(e))},i)},findParents:function(e,t,i,n){for(var o=t&&(i&&i(e)||!i)?[e]:[];e=domUtils.findParent(e,i);)o.push(e);return n?o:o.reverse()},insertAfter:function(e,t){return e.parentNode.insertBefore(t,e.nextSibling)},remove:function(e,t){var i,n=e.parentNode;if(n){if(t&&e.hasChildNodes())for(;i=e.firstChild;)n.insertBefore(i,e);n.removeChild(e)}return e},getNextDomNode:function(e,t,i,n){return getDomNode(e,"firstChild","nextSibling",t,i,n)},getPreDomNode:function(e,t,i,n){return getDomNode(e,"lastChild","previousSibling",t,i,n)},isBookmarkNode:function(e){return 1==e.nodeType&&e.id&&/^_baidu_bookmark_/i.test(e.id)},getWindow:function(e){var t=e.ownerDocument||e;return t.defaultView||t.parentWindow},getCommonAncestor:function(e,t){if(e===t)return e;for(var i=[e],n=[t],o=e,a=-1;o=o.parentNode;){if(o===t)return o;i.push(o)}for(o=t;o=o.parentNode;){if(o===e)return o;n.push(o)}for(i.reverse(),n.reverse();a++,i[a]===n[a];);return 0==a?null:i[a-1]},clearEmptySibling:function(e,t,i){function n(e,t){for(var i;e&&!domUtils.isBookmarkNode(e)&&(domUtils.isEmptyInlineElement(e)||!new RegExp("[^	\n\r"+domUtils.fillChar+"]").test(e.nodeValue));)i=e[t],domUtils.remove(e),e=i}!t&&n(e.nextSibling,"nextSibling"),!i&&n(e.previousSibling,"previousSibling")},split:function(e,t){var i=e.ownerDocument;if(browser.ie&&t==e.nodeValue.length){var n=i.createTextNode("");return domUtils.insertAfter(e,n)}var o=e.splitText(t);if(browser.ie8){var a=i.createTextNode("");domUtils.insertAfter(o,a),domUtils.remove(a)}return o},isWhitespace:function(e){return!new RegExp("[^ 	\n\r"+domUtils.fillChar+"]").test(e.nodeValue)},getXY:function(e){for(var t=0,i=0;e.offsetParent;)i+=e.offsetTop,t+=e.offsetLeft,e=e.offsetParent;return{x:t,y:i}},isEmptyInlineElement:function(e){if(1!=e.nodeType||!dtd.$removeEmpty[e.tagName])return 0;for(e=e.firstChild;e;){if(domUtils.isBookmarkNode(e))return 0;if(1==e.nodeType&&!domUtils.isEmptyInlineElement(e)||3==e.nodeType&&!domUtils.isWhitespace(e))return 0;e=e.nextSibling}return 1},isBlockElm:function(e){return 1==e.nodeType&&(dtd.$block[e.tagName]||styleBlock[domUtils.getComputedStyle(e,"display")])&&!dtd.$nonChild[e.tagName]},getElementsByTagName:function(e,t,i){if(i&&utils.isString(i)){var n=i;i=function(e){var t=!1;return $.each(utils.trim(n).replace(/[ ]{2,}/g," ").split(" "),function(i,n){return $(e).hasClass(n)?(t=!0,!1):void 0}),t}}t=utils.trim(t).replace(/[ ]{2,}/g," ").split(" ");for(var o,a=[],r=0;o=t[r++];)for(var s,l=e.getElementsByTagName(o),d=0;s=l[d++];)(!i||i(s))&&a.push(s);return a},unSelectable:ie&&browser.ie9below||browser.opera?function(e){e.onselectstart=function(){return!1},e.onclick=e.onkeyup=e.onkeydown=function(){return!1},e.unselectable="on",e.setAttribute("unselectable","on");for(var t,i=0;t=e.all[i++];)switch(t.tagName.toLowerCase()){case"iframe":case"textarea":case"input":case"select":break;default:t.unselectable="on",e.setAttribute("unselectable","on")}}:function(e){e.style.MozUserSelect=e.style.webkitUserSelect=e.style.msUserSelect=e.style.KhtmlUserSelect="none"},removeAttributes:function(e,t){t=utils.isArray(t)?t:utils.trim(t).replace(/[ ]{2,}/g," ").split(" ");for(var i,n=0;i=t[n++];){switch(i=attrFix[i]||i){case"className":e[i]="";break;case"style":e.style.cssText="",!browser.ie&&e.removeAttributeNode(e.getAttributeNode("style"))}e.removeAttribute(i)}},createElement:function(e,t,i){return domUtils.setAttributes(e.createElement(t),i)},setAttributes:function(e,t){for(var i in t)if(t.hasOwnProperty(i)){var n=t[i];switch(i){case"class":e.className=n;break;case"style":e.style.cssText=e.style.cssText+";"+n;break;case"innerHTML":e[i]=n;break;case"value":e.value=n;break;default:e.setAttribute(attrFix[i]||i,n)}}return e},getComputedStyle:function(e,t){return utils.transUnitToPx(utils.fixColor(t,$(e).css(t)))},preventDefault:function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},removeStyle:function(e,t){browser.ie?("color"==t&&(t="(^|;)"+t),e.style.cssText=e.style.cssText.replace(new RegExp(t+"[^:]*:[^;]+;?","ig"),"")):e.style.removeProperty?e.style.removeProperty(t):e.style.removeAttribute(utils.cssStyleToDomStyle(t)),e.style.cssText||domUtils.removeAttributes(e,["style"])},getStyle:function(e,t){var i=e.style[utils.cssStyleToDomStyle(t)];return utils.fixColor(t,i)},setStyle:function(e,t,i){e.style[utils.cssStyleToDomStyle(t)]=i,utils.trim(e.style.cssText)||this.removeAttributes(e,"style")},removeDirtyAttr:function(e){for(var t,i=0,n=e.getElementsByTagName("*");t=n[i++];)t.removeAttribute("_moz_dirty");e.removeAttribute("_moz_dirty")},getChildCount:function(e,t){var i=0,n=e.firstChild;for(t=t||function(){return 1};n;)t(n)&&i++,n=n.nextSibling;return i},isEmptyNode:function(e){return!e.firstChild||0==domUtils.getChildCount(e,function(e){return!domUtils.isBr(e)&&!domUtils.isBookmarkNode(e)&&!domUtils.isWhitespace(e)})},isBr:function(e){return 1==e.nodeType&&"BR"==e.tagName},isFillChar:function(e,t){return 3==e.nodeType&&!e.nodeValue.replace(new RegExp((t?"^":"")+domUtils.fillChar),"").length},isEmptyBlock:function(e,t){if(1!=e.nodeType)return 0;if(t=t||new RegExp("[ 	\r\n"+domUtils.fillChar+"]","g"),e[browser.ie?"innerText":"textContent"].replace(t,"").length>0)return 0;for(var i in dtd.$isNotEmpty)if(e.getElementsByTagName(i).length)return 0;return 1},isCustomeNode:function(e){return 1==e.nodeType&&e.getAttribute("_ue_custom_node_")},fillNode:function(e,t){var i=browser.ie?e.createTextNode(domUtils.fillChar):e.createElement("br");t.innerHTML="",t.appendChild(i)},isBoundaryNode:function(e,t){for(var i;!domUtils.isBody(e);)if(i=e,e=e.parentNode,i!==e[t])return!1;return!0},isFillChar:function(e,t){return 3==e.nodeType&&!e.nodeValue.replace(new RegExp((t?"^":"")+domUtils.fillChar),"").length},isBody:function(e){return $(e).hasClass("edui-body-container")}},fillCharReg=new RegExp(domUtils.fillChar,"g");!function(){function e(e){e.collapsed=e.startContainer&&e.endContainer&&e.startContainer===e.endContainer&&e.startOffset==e.endOffset}function t(e){return!e.collapsed&&1==e.startContainer.nodeType&&e.startContainer===e.endContainer&&e.endOffset-e.startOffset==1}function i(t,i,n,o){return 1==i.nodeType&&(dtd.$empty[i.tagName]||dtd.$nonChild[i.tagName])&&(n=domUtils.getNodeIndex(i)+(t?0:1),i=i.parentNode),t?(o.startContainer=i,o.startOffset=n,o.endContainer||o.collapse(!0)):(o.endContainer=i,o.endOffset=n,o.startContainer||o.collapse(!1)),e(o),o}function n(e,t){try{if(r&&domUtils.inDoc(r,e))if(r.nodeValue.replace(fillCharReg,"").length)r.nodeValue=r.nodeValue.replace(fillCharReg,"");else{var i=r.parentNode;for(domUtils.remove(r);i&&domUtils.isEmptyInlineElement(i)&&(browser.safari?!(domUtils.getPosition(i,t)&domUtils.POSITION_CONTAINS):!i.contains(t));)r=i.parentNode,domUtils.remove(i),i=r}}catch(n){}}function o(e,t){var i;for(e=e[t];e&&domUtils.isFillChar(e);)i=e[t],domUtils.remove(e),e=i}function a(e,t){var i,n,o=e.startContainer,a=e.endContainer,r=e.startOffset,s=e.endOffset,l=e.document,d=l.createDocumentFragment();if(1==o.nodeType&&(o=o.childNodes[r]||(i=o.appendChild(l.createTextNode("")))),1==a.nodeType&&(a=a.childNodes[s]||(n=a.appendChild(l.createTextNode("")))),o===a&&3==o.nodeType)return d.appendChild(l.createTextNode(o.substringData(r,s-r))),t&&(o.deleteData(r,s-r),e.collapse(!0)),d;for(var c,u,h=d,f=domUtils.findParents(o,!0),p=domUtils.findParents(a,!0),m=0;f[m]==p[m];)m++;for(var g,v=m;g=f[v];v++){for(c=g.nextSibling,g==o?i||(3==e.startContainer.nodeType?(h.appendChild(l.createTextNode(o.nodeValue.slice(r))),t&&o.deleteData(r,o.nodeValue.length-r)):h.appendChild(t?o:o.cloneNode(!0))):(u=g.cloneNode(!1),h.appendChild(u));c&&c!==a&&c!==p[v];)g=c.nextSibling,h.appendChild(t?c:c.cloneNode(!0)),c=g;h=u}h=d,f[m]||(h.appendChild(f[m-1].cloneNode(!1)),h=h.firstChild);for(var b,v=m;b=p[v];v++){if(c=b.previousSibling,b==a?n||3!=e.endContainer.nodeType||(h.appendChild(l.createTextNode(a.substringData(0,s))),t&&a.deleteData(0,s)):(u=b.cloneNode(!1),h.appendChild(u)),v!=m||!f[m])for(;c&&c!==o;)b=c.previousSibling,h.insertBefore(t?c:c.cloneNode(!0),h.firstChild),c=b;h=u}return t&&e.setStartBefore(p[m]?f[m]?p[m]:f[m-1]:p[m-1]).collapse(!0),i&&domUtils.remove(i),n&&domUtils.remove(n),d}var r,s=0,l=domUtils.fillChar,d=dom.Range=function(e,t){var i=this;i.startContainer=i.startOffset=i.endContainer=i.endOffset=null,i.document=e,i.collapsed=!0,i.body=t};d.prototype={deleteContents:function(){var e;return this.collapsed||a(this,1),browser.webkit&&(e=this.startContainer,3!=e.nodeType||e.nodeValue.length||(this.setStartBefore(e).collapse(!0),domUtils.remove(e))),this},inFillChar:function(){var e=this.startContainer;return this.collapsed&&3==e.nodeType&&e.nodeValue.replace(new RegExp("^"+domUtils.fillChar),"").length+1==e.nodeValue.length?!0:!1},setStart:function(e,t){return i(!0,e,t,this)},setEnd:function(e,t){return i(!1,e,t,this)},setStartAfter:function(e){return this.setStart(e.parentNode,domUtils.getNodeIndex(e)+1)},setStartBefore:function(e){return this.setStart(e.parentNode,domUtils.getNodeIndex(e))},setEndAfter:function(e){return this.setEnd(e.parentNode,domUtils.getNodeIndex(e)+1)},setEndBefore:function(e){return this.setEnd(e.parentNode,domUtils.getNodeIndex(e))},setStartAtFirst:function(e){return this.setStart(e,0)},setStartAtLast:function(e){return this.setStart(e,3==e.nodeType?e.nodeValue.length:e.childNodes.length)},setEndAtFirst:function(e){return this.setEnd(e,0)},setEndAtLast:function(e){return this.setEnd(e,3==e.nodeType?e.nodeValue.length:e.childNodes.length)},selectNode:function(e){return this.setStartBefore(e).setEndAfter(e)},selectNodeContents:function(e){return this.setStart(e,0).setEndAtLast(e)},cloneRange:function(){var e=this;return new d(e.document).setStart(e.startContainer,e.startOffset).setEnd(e.endContainer,e.endOffset)},collapse:function(e){var t=this;return e?(t.endContainer=t.startContainer,t.endOffset=t.startOffset):(t.startContainer=t.endContainer,t.startOffset=t.endOffset),t.collapsed=!0,t},shrinkBoundary:function(e){function t(e){return 1==e.nodeType&&!domUtils.isBookmarkNode(e)&&!dtd.$empty[e.tagName]&&!dtd.$nonChild[e.tagName]}for(var i,n=this,o=n.collapsed;1==n.startContainer.nodeType&&(i=n.startContainer.childNodes[n.startOffset])&&t(i);)n.setStart(i,0);if(o)return n.collapse(!0);if(!e)for(;1==n.endContainer.nodeType&&n.endOffset>0&&(i=n.endContainer.childNodes[n.endOffset-1])&&t(i);)n.setEnd(i,i.childNodes.length);return n},trimBoundary:function(e){this.txtToElmBoundary();var t=this.startContainer,i=this.startOffset,n=this.collapsed,o=this.endContainer;if(3==t.nodeType){if(0==i)this.setStartBefore(t);else if(i>=t.nodeValue.length)this.setStartAfter(t);else{var a=domUtils.split(t,i);t===o?this.setEnd(a,this.endOffset-i):t.parentNode===o&&(this.endOffset+=1),this.setStartBefore(a)}if(n)return this.collapse(!0)}return e||(i=this.endOffset,o=this.endContainer,3==o.nodeType&&(0==i?this.setEndBefore(o):(i<o.nodeValue.length&&domUtils.split(o,i),this.setEndAfter(o)))),this},txtToElmBoundary:function(e){function t(e,t){var i=e[t+"Container"],n=e[t+"Offset"];3==i.nodeType&&(n?n>=i.nodeValue.length&&e["set"+t.replace(/(\w)/,function(e){return e.toUpperCase()})+"After"](i):e["set"+t.replace(/(\w)/,function(e){return e.toUpperCase()})+"Before"](i))}return(e||!this.collapsed)&&(t(this,"start"),t(this,"end")),this},insertNode:function(e){var t=e,i=1;11==e.nodeType&&(t=e.firstChild,i=e.childNodes.length),this.trimBoundary(!0);var n=this.startContainer,o=this.startOffset,a=n.childNodes[o];return a?n.insertBefore(e,a):n.appendChild(e),t.parentNode===this.endContainer&&(this.endOffset=this.endOffset+i),this.setStartBefore(t)},setCursor:function(e,t){return this.collapse(!e).select(t)},createBookmark:function(e,t){var i,n=this.document.createElement("span");return n.style.cssText="display:none;line-height:0px;",n.appendChild(this.document.createTextNode("‍")),n.id="_baidu_bookmark_start_"+(t?"":s++),this.collapsed||(i=n.cloneNode(!0),i.id="_baidu_bookmark_end_"+(t?"":s++)),this.insertNode(n),i&&this.collapse().insertNode(i).setEndBefore(i),this.setStartAfter(n),{start:e?n.id:n,end:i?e?i.id:i:null,id:e}},moveToBookmark:function(e){var t=e.id?this.document.getElementById(e.start):e.start,i=e.end&&e.id?this.document.getElementById(e.end):e.end;return this.setStartBefore(t),domUtils.remove(t),i?(this.setEndBefore(i),domUtils.remove(i)):this.collapse(!0),this},adjustmentBoundary:function(){if(!this.collapsed){for(;!domUtils.isBody(this.startContainer)&&this.startOffset==this.startContainer[3==this.startContainer.nodeType?"nodeValue":"childNodes"].length&&this.startContainer[3==this.startContainer.nodeType?"nodeValue":"childNodes"].length;)this.setStartAfter(this.startContainer);for(;!domUtils.isBody(this.endContainer)&&!this.endOffset&&this.endContainer[3==this.endContainer.nodeType?"nodeValue":"childNodes"].length;)this.setEndBefore(this.endContainer)}return this},getClosedNode:function(){var e;if(!this.collapsed){var i=this.cloneRange().adjustmentBoundary().shrinkBoundary();if(t(i)){var n=i.startContainer.childNodes[i.startOffset];n&&1==n.nodeType&&(dtd.$empty[n.tagName]||dtd.$nonChild[n.tagName])&&(e=n)}}return e},select:browser.ie?function(e,t){var i;this.collapsed||this.shrinkBoundary();var a=this.getClosedNode();if(a&&!t){try{i=this.document.body.createControlRange(),i.addElement(a),i.select()}catch(s){}return this}var d,c=this.createBookmark(),u=c.start;if(i=this.document.body.createTextRange(),i.moveToElementText(u),i.moveStart("character",1),this.collapsed){if(!e&&3!=this.startContainer.nodeType){var h=this.document.createTextNode(l),f=this.document.createElement("span");f.appendChild(this.document.createTextNode(l)),u.parentNode.insertBefore(f,u),u.parentNode.insertBefore(h,u),n(this.document,h),r=h,o(f,"previousSibling"),o(u,"nextSibling"),i.moveStart("character",-1),i.collapse(!0)}}else{var p=this.document.body.createTextRange();d=c.end,p.moveToElementText(d),i.setEndPoint("EndToEnd",p)}this.moveToBookmark(c),f&&domUtils.remove(f);try{i.select()}catch(s){}return this}:function(e){function t(e){function t(t,i,n){3==t.nodeType&&t.nodeValue.length<i&&(e[n+"Offset"]=t.nodeValue.length)}t(e.startContainer,e.startOffset,"start"),t(e.endContainer,e.endOffset,"end")}var i,a=domUtils.getWindow(this.document),s=a.getSelection();if(browser.gecko?this.body.focus():a.focus(),s){if(s.removeAllRanges(),this.collapsed&&!e){var d=this.startContainer,c=d;1==d.nodeType&&(c=d.childNodes[this.startOffset]),3==d.nodeType&&this.startOffset||(c?c.previousSibling&&3==c.previousSibling.nodeType:d.lastChild&&3==d.lastChild.nodeType)||(i=this.document.createTextNode(l),this.insertNode(i),n(this.document,i),o(i,"previousSibling"),o(i,"nextSibling"),r=i,this.setStart(i,browser.webkit?1:0).collapse(!0))}var u=this.document.createRange();if(this.collapsed&&browser.opera&&1==this.startContainer.nodeType){var c=this.startContainer.childNodes[this.startOffset];if(c){for(;c&&domUtils.isBlockElm(c)&&1==c.nodeType&&c.childNodes[0];)c=c.childNodes[0];c&&this.setStartBefore(c).collapse(!0)}else c=this.startContainer.lastChild,c&&domUtils.isBr(c)&&this.setStartBefore(c).collapse(!0)}t(this),u.setStart(this.startContainer,this.startOffset),u.setEnd(this.endContainer,this.endOffset),s.addRange(u)}return this},createAddress:function(e,t){function i(e){for(var i,n=e?o.startContainer:o.endContainer,a=domUtils.findParents(n,!0,function(e){return!domUtils.isBody(e)}),r=[],s=0;i=a[s++];)r.push(domUtils.getNodeIndex(i,t));var l=0;if(t)if(3==n.nodeType){for(var d=n.previousSibling;d&&3==d.nodeType;)l+=d.nodeValue.replace(fillCharReg,"").length,d=d.previousSibling;l+=e?o.startOffset:o.endOffset}else if(n=n.childNodes[e?o.startOffset:o.endOffset])l=domUtils.getNodeIndex(n,t);else{n=e?o.startContainer:o.endContainer;for(var c=n.firstChild;c;)if(domUtils.isFillChar(c))c=c.nextSibling;else if(l++,3==c.nodeType)for(;c&&3==c.nodeType;)c=c.nextSibling;else c=c.nextSibling}else l=e?domUtils.isFillChar(n)?0:o.startOffset:o.endOffset;return 0>l&&(l=0),r.push(l),r}var n={},o=this;return n.startAddress=i(!0),e||(n.endAddress=o.collapsed?[].concat(n.startAddress):i()),n},moveToAddress:function(e,t){function i(e,t){for(var i,o,a,r=n.body,s=0,l=e.length;l>s;s++)if(a=e[s],i=r,r=r.childNodes[a],
!r){o=a;break}t?r?n.setStartBefore(r):n.setStart(i,o):r?n.setEndBefore(r):n.setEnd(i,o)}var n=this;return i(e.startAddress,!0),!t&&e.endAddress&&i(e.endAddress),n},equals:function(e){for(var t in this)if(this.hasOwnProperty(t)&&this[t]!==e[t])return!1;return!0},scrollIntoView:function(){var e=$('<span style="padding:0;margin:0;display:block;border:0">&nbsp;</span>');this.cloneRange().insertNode(e.get(0));var t=$(window).scrollTop(),i=$(window).height(),n=e.offset().top;(t-i>n||n>t+i)&&(n>t+i?window.scrollTo(0,n-i+e.height()):window.scrollTo(0,t-n)),e.remove()},getOffset:function(){var e=this.createBookmark(),t=$(e.start).css("display","inline-block").offset();return this.moveToBookmark(e),t}}}(),function(){function e(e,t){var i=domUtils.getNodeIndex;e=e.duplicate(),e.collapse(t);var n=e.parentElement();if(!n.hasChildNodes())return{container:n,offset:0};for(var o,a,r=n.children,s=e.duplicate(),l=0,d=r.length-1,c=-1;d>=l;){c=Math.floor((l+d)/2),o=r[c],s.moveToElementText(o);var u=s.compareEndPoints("StartToStart",e);if(u>0)d=c-1;else{if(!(0>u))return{container:n,offset:i(o)};l=c+1}}if(-1==c){if(s.moveToElementText(n),s.setEndPoint("StartToStart",e),a=s.text.replace(/(\r\n|\r)/g,"\n").length,r=n.childNodes,!a)return o=r[r.length-1],{container:o,offset:o.nodeValue.length};for(var h=r.length;a>0;)a-=r[--h].nodeValue.length;return{container:r[h],offset:-a}}if(s.collapse(u>0),s.setEndPoint(u>0?"StartToStart":"EndToStart",e),a=s.text.replace(/(\r\n|\r)/g,"\n").length,!a)return dtd.$empty[o.tagName]||dtd.$nonChild[o.tagName]?{container:n,offset:i(o)+(u>0?0:1)}:{container:o,offset:u>0?0:o.childNodes.length};for(;a>0;)try{var f=o;o=o[u>0?"previousSibling":"nextSibling"],a-=o.nodeValue.length}catch(p){return{container:n,offset:i(f)}}return{container:o,offset:u>0?-a:o.nodeValue.length+a}}function t(t,i){if(t.item)i.selectNode(t.item(0));else{var n=e(t,!0);i.setStart(n.container,n.offset),0!=t.compareEndPoints("StartToEnd",t)&&(n=e(t,!1),i.setEnd(n.container,n.offset))}return i}function i(e,t){var i;try{i=e.getNative(t).createRange()}catch(n){return null}var o=i.item?i.item(0):i.parentElement();return(o.ownerDocument||o)===e.document?i:null}var n=dom.Selection=function(e,t){var n=this;n.document=e,n.body=t,browser.ie9below&&$(t).on("beforedeactivate",function(){n._bakIERange=n.getIERange()}).on("activate",function(){try{var e=i(n);e&&n.rangeInBody(e)||!n._bakIERange||n._bakIERange.select()}catch(t){}n._bakIERange=null})};n.prototype={hasNativeRange:function(){var e;if(!browser.ie||browser.ie9above){var t=this.getNative();if(!t.rangeCount)return!1;e=t.getRangeAt(0)}else e=i(this);return this.rangeInBody(e)},getNative:function(e){var t=this.document;try{return t?browser.ie9below||e?t.selection:domUtils.getWindow(t).getSelection():null}catch(i){return null}},getIERange:function(e){var t=i(this,e);return t&&this.rangeInBody(t,e)||!this._bakIERange?t:this._bakIERange},rangeInBody:function(e,t){var i=browser.ie9below||t?e.item?e.item():e.parentElement():e.startContainer;return i===this.body||domUtils.inDoc(i,this.body)},cache:function(){this.clear(),this._cachedRange=this.getRange(),this._cachedStartElement=this.getStart(),this._cachedStartElementPath=this.getStartElementPath()},getStartElementPath:function(){if(this._cachedStartElementPath)return this._cachedStartElementPath;var e=this.getStart();return e?domUtils.findParents(e,!0,null,!0):[]},clear:function(){this._cachedStartElementPath=this._cachedRange=this._cachedStartElement=null},isFocus:function(){return this.hasNativeRange()},getRange:function(){function e(e){for(var t=i.body.firstChild,n=e.collapsed;t&&t.firstChild;)e.setStart(t,0),t=t.firstChild;e.startContainer||e.setStart(i.body,0),n&&e.collapse(!0)}var i=this;if(null!=i._cachedRange)return this._cachedRange;var n=new dom.Range(i.document,i.body);if(browser.ie9below){var o=i.getIERange();if(o&&this.rangeInBody(o))try{t(o,n)}catch(a){e(n)}else e(n)}else{var r=i.getNative();if(r&&r.rangeCount&&i.rangeInBody(r.getRangeAt(0))){var s=r.getRangeAt(0),l=r.getRangeAt(r.rangeCount-1);n.setStart(s.startContainer,s.startOffset).setEnd(l.endContainer,l.endOffset),n.collapsed&&domUtils.isBody(n.startContainer)&&!n.startOffset&&e(n)}else{if(this._bakRange&&(this._bakRange.startContainer===this.body||domUtils.inDoc(this._bakRange.startContainer,this.body)))return this._bakRange;e(n)}}return this._bakRange=n},getStart:function(){if(this._cachedStartElement)return this._cachedStartElement;var e,t,i,n,o=browser.ie9below?this.getIERange():this.getRange();if(browser.ie9below){if(!o)return this.document.body.firstChild;if(o.item)return o.item(0);for(e=o.duplicate(),e.text.length>0&&e.moveStart("character",1),e.collapse(1),t=e.parentElement(),n=i=o.parentElement();i=i.parentNode;)if(i==t){t=n;break}}else if(t=o.startContainer,1==t.nodeType&&t.hasChildNodes()&&(t=t.childNodes[Math.min(t.childNodes.length-1,o.startOffset)]),3==t.nodeType)return t.parentNode;return t},getText:function(){var e,t;return this.isFocus()&&(e=this.getNative())?(t=browser.ie9below?e.createRange():e.getRangeAt(0),browser.ie9below?t.text:t.toString()):""}}}(),function(){function e(e,t){var i;if(t.textarea)if(utils.isString(t.textarea)){for(var n,o=0,a=domUtils.getElementsByTagName(e,"textarea");n=a[o++];)if(n.id=="umeditor_textarea_"+t.options.textarea){i=n;break}}else i=t.textarea;i||(e.appendChild(i=domUtils.createElement(document,"textarea",{name:t.options.textarea,id:"umeditor_textarea_"+t.options.textarea,style:"display:none"})),t.textarea=i),i.value=t.hasContents()?t.options.allHtmlEnabled?t.getAllHtml():t.getContent(null,null,!0):""}function t(e){for(var t in UM.plugins)-1==e.options.excludePlugins.indexOf(t)&&(UM.plugins[t].call(e),e.plugins[t]=1);e.langIsReady=!0,e.fireEvent("langReady")}function i(e){for(var t in e)return t}var n,o=0,a=UM.Editor=function(e){var n=this;n.uid=o++,EventBase.call(n),n.commands={},n.options=utils.extend(utils.clone(e||{}),UMEDITOR_CONFIG,!0),n.shortcutkeys={},n.inputRules=[],n.outputRules=[],n.setOpt({isShow:!0,initialContent:"",initialStyle:"",autoClearinitialContent:!1,textarea:"editorValue",focus:!1,focusInEnd:!0,autoClearEmptyNode:!0,fullscreen:!1,readonly:!1,zIndex:999,enterTag:"p",lang:"zh-cn",langPath:n.options.UMEDITOR_HOME_URL+"lang/",theme:"default",themePath:n.options.UMEDITOR_HOME_URL+"themes/",allHtmlEnabled:!1,autoSyncData:!0,autoHeightEnabled:!0,excludePlugins:""}),n.plugins={},utils.isEmptyObject(UM.I18N)?utils.loadFile(document,{src:n.options.langPath+n.options.lang+"/"+n.options.lang+".js",tag:"script",type:"text/javascript",defer:"defer"},function(){t(n)}):(n.options.lang=i(UM.I18N),t(n))};a.prototype={ready:function(e){var t=this;e&&(t.isReady?e.apply(t):t.addListener("ready",e))},setOpt:function(e,t){var i={};utils.isString(e)?i[e]=t:i=e,utils.extend(this.options,i,!0)},getOpt:function(e){return this.options[e]||""},destroy:function(){var e=this;e.fireEvent("destroy");var t=e.container.parentNode;t===document.body&&(t=e.container);var i=e.textarea;i?i.style.display="":(i=document.createElement("textarea"),t.parentNode.insertBefore(i,t)),i.style.width=e.body.offsetWidth+"px",i.style.height=e.body.offsetHeight+"px",i.value=e.getContent(),i.id=e.key,t.contains(i)&&$(i).insertBefore(t),t.innerHTML="",domUtils.remove(t),UM.clearCache(e.id);for(var n in e)e.hasOwnProperty(n)&&delete this[n]},initialCont:function(e){if(e){if(e.getAttribute("name")&&(this.options.textarea=e.getAttribute("name")),e&&/script|textarea/gi.test(e.tagName)){var t=document.createElement("div");e.parentNode.insertBefore(t,e),this.options.initialContent=UM.htmlparser(e.value||e.innerHTML||this.options.initialContent).toHtml(),e.className&&(t.className=e.className),e.style.cssText&&(t.style.cssText=e.style.cssText),/textarea/i.test(e.tagName)?(this.textarea=e,this.textarea.style.display="none"):(e.parentNode.removeChild(e),e.id&&(t.id=e.id)),e=t,e.innerHTML=""}return e}return null},render:function(e){var t=this,i=t.options,n=function(t){return parseInt($(e).css(t))};if(utils.isString(e)&&(e=document.getElementById(e)),e){this.id=e.getAttribute("id"),UM.setEditor(this),utils.cssRule("edui-style-body",t.options.initialStyle,document),e=this.initialCont(e),e.className+=" edui-body-container",i.minFrameWidth=i.initialFrameWidth?i.initialFrameWidth:i.initialFrameWidth=$(e).width()||UM.defaultWidth,i.initialFrameHeight?i.minFrameHeight=i.initialFrameHeight:i.initialFrameHeight=i.minFrameHeight=$(e).height()||UM.defaultHeight,e.style.width=/%$/.test(i.initialFrameWidth)?"100%":i.initialFrameWidth-n("padding-left")-n("padding-right")+"px";var o=/%$/.test(i.initialFrameHeight)?"100%":i.initialFrameHeight-n("padding-top")-n("padding-bottom");this.options.autoHeightEnabled?(e.style.minHeight=o+"px",e.style.height="",browser.ie&&browser.version<=6&&(e.style.height=o,e.style.setExpression("height","this.scrollHeight <= "+o+' ? "'+o+'px" : "auto"'))):$(e).height(o),e.style.zIndex=i.zIndex,this._setup(e)}},_setup:function(t){var i=this,n=i.options;t.contentEditable=!0,document.body.spellcheck=!1,i.document=document,i.window=document.defaultView||document.parentWindow,i.body=t,i.$body=$(t),i.selection=new dom.Selection(document,i.body),i._isEnabled=!1;var o;browser.gecko&&(o=this.selection.getNative())&&o.removeAllRanges(),this._initEvents();for(var a=t.parentNode;a&&!domUtils.isBody(a);a=a.parentNode)if("FORM"==a.tagName){i.form=a,i.options.autoSyncData?$(t).on("blur",function(){e(a,i)}):$(a).on("submit",function(){e(this,i)});break}if(n.initialContent)if(n.autoClearinitialContent){var r=i.execCommand;i.execCommand=function(){return i.fireEvent("firstBeforeExecCommand"),r.apply(i,arguments)},this._setDefaultContent(n.initialContent)}else this.setContent(n.initialContent,!1,!0);domUtils.isEmptyNode(i.body)&&(i.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>"),n.focus&&setTimeout(function(){i.focus(i.options.focusInEnd),!i.options.autoClearinitialContent&&i._selectionChange()},0),i.container||(i.container=t.parentNode),i._bindshortcutKeys(),i.isReady=1,i.fireEvent("ready"),n.onready&&n.onready.call(i),(!browser.ie||browser.ie9above)&&$(i.body).on("blur focus",function(e){var t=i.selection.getNative();if("blur"==e.type)t.rangeCount>0&&(i._bakRange=t.getRangeAt(0));else{try{i._bakRange&&t.addRange(i._bakRange)}catch(e){}i._bakRange=null}}),!n.isShow&&i.setHide(),n.readonly&&i.setDisabled()},sync:function(t){var i=this,n=t?document.getElementById(t):domUtils.findParent(i.body.parentNode,function(e){return"FORM"==e.tagName},!0);n&&e(n,i)},setHeight:function(e,t){!t&&(this.options.initialFrameHeight=e),this.options.autoHeightEnabled?($(this.body).css({"min-height":e+"px"}),browser.ie&&browser.version<=6&&this.container&&(this.container.style.height=e,this.container.style.setExpression("height","this.scrollHeight <= "+e+' ? "'+e+'px" : "auto"'))):$(this.body).height(e),this.fireEvent("resize")},setWidth:function(e){this.$container&&this.$container.width(e),$(this.body).width(e-1*$(this.body).css("padding-left").replace("px","")-1*$(this.body).css("padding-right").replace("px","")),this.fireEvent("resize")},addshortcutkey:function(e,t){var i={};t?i[e]=t:i=e,utils.extend(this.shortcutkeys,i)},_bindshortcutKeys:function(){var e=this,t=this.shortcutkeys;e.addListener("keydown",function(i,n){var o=n.keyCode||n.which;for(var a in t)for(var r,s=t[a].split(","),l=0;r=s[l++];){r=r.split(":");var d=r[0],c=r[1];(/^(ctrl)(\+shift)?\+(\d+)$/.test(d.toLowerCase())||/^(\d+)$/.test(d))&&(("ctrl"==RegExp.$1?n.ctrlKey||n.metaKey:0)&&(""!=RegExp.$2?n[RegExp.$2.slice(1)+"Key"]:1)&&o==RegExp.$3||o==RegExp.$1)&&(-1!=e.queryCommandState(a,c)&&e.execCommand(a,c),domUtils.preventDefault(n))}})},getContent:function(e,t,i,n,o){var a=this;if(e&&utils.isFunction(e)&&(t=e,e=""),t?!t():!this.hasContents())return"";a.fireEvent("beforegetcontent");var r=UM.htmlparser(a.body.innerHTML,n);return a.filterOutputRule(r),a.fireEvent("aftergetcontent",r),r.toHtml(o)},getAllHtml:function(){var e=this,t=[];if(e.fireEvent("getAllHtml",t),browser.ie&&browser.version>8){var i="";utils.each(e.document.styleSheets,function(e){i+=e.href?'<link rel="stylesheet" type="text/css" href="'+e.href+'" />':"<style>"+e.cssText+"</style>"}),utils.each(e.document.getElementsByTagName("script"),function(e){i+=e.outerHTML})}return"<html><head>"+(e.options.charset?'<meta http-equiv="Content-Type" content="text/html; charset='+e.options.charset+'"/>':"")+(i||e.document.getElementsByTagName("head")[0].innerHTML)+t.join("\n")+"</head><body "+(ie&&browser.version<9?'class="view"':"")+">"+e.getContent(null,null,!0)+"</body></html>"},getPlainTxt:function(){var e=new RegExp(domUtils.fillChar,"g"),t=this.body.innerHTML.replace(/[\n\r]/g,"");return t=t.replace(/<(p|div)[^>]*>(<br\/?>|&nbsp;)<\/\1>/gi,"\n").replace(/<br\/?>/gi,"\n").replace(/<[^>\/]+>/g,"").replace(/(\n)?<\/([^>]+)>/g,function(e,t,i){return dtd.$block[i]?"\n":t?t:""}),t.replace(e,"").replace(/\u00a0/g," ").replace(/&nbsp;/g," ")},getContentTxt:function(){var e=new RegExp(domUtils.fillChar,"g");return this.body[browser.ie?"innerText":"textContent"].replace(e,"").replace(/\u00a0/g," ")},setContent:function(t,i,n){function o(e){return"DIV"==e.tagName&&e.getAttribute("cdata_tag")}var a=this;a.fireEvent("beforesetcontent",t);var r=UM.htmlparser(t);if(a.filterInputRule(r),t=r.toHtml(),a.body.innerHTML=(i?a.body.innerHTML:"")+t,"p"==a.options.enterTag){var s,l=this.body.firstChild;if(!l||1==l.nodeType&&(dtd.$cdata[l.tagName]||o(l)||domUtils.isCustomeNode(l))&&l===this.body.lastChild)this.body.innerHTML="<p>"+(browser.ie?"&nbsp;":"<br/>")+"</p>"+this.body.innerHTML;else for(var d=a.document.createElement("p");l;){for(;l&&(3==l.nodeType||1==l.nodeType&&dtd.p[l.tagName]&&!dtd.$cdata[l.tagName]);)s=l.nextSibling,d.appendChild(l),l=s;if(d.firstChild){if(!l){a.body.appendChild(d);break}l.parentNode.insertBefore(d,l),d=a.document.createElement("p")}l=l.nextSibling}}a.fireEvent("aftersetcontent"),a.fireEvent("contentchange"),!n&&a._selectionChange(),a._bakRange=a._bakIERange=a._bakNativeRange=null;var c;browser.gecko&&(c=this.selection.getNative())&&c.removeAllRanges(),a.options.autoSyncData&&a.form&&e(a.form,a)},focus:function(e){try{var t=this,i=t.selection.getRange();e?i.setStartAtLast(t.body.lastChild).setCursor(!1,!0):i.select(!0),this.fireEvent("focus")}catch(n){}},blur:function(){var e=this.selection.getNative();e.empty?e.empty():e.removeAllRanges(),this.fireEvent("blur")},isFocus:function(){return this.fireEvent("isfocus")===!0?!0:this.selection.isFocus()},_initEvents:function(){var e=this,t=e.body,i=function(){e._proxyDomEvent.apply(e,arguments)};$(t).on("click contextmenu mousedown keydown keyup keypress mouseup mouseover mouseout selectstart",i).on("focus blur",i).on("mouseup keydown",function(t){"keydown"==t.type&&(t.ctrlKey||t.metaKey||t.shiftKey||t.altKey)||2!=t.button&&e._selectionChange(250,t)})},_proxyDomEvent:function(e){return this.fireEvent(e.type.replace(/^on/,""),e)},_selectionChange:function(e,t){var i,o,a=this,r=!1;if(browser.ie&&browser.version<9&&t&&"mouseup"==t.type){var s=this.selection.getRange();s.collapsed||(r=!0,i=t.clientX,o=t.clientY)}clearTimeout(n),n=setTimeout(function(){if(a.selection.getNative()){var e;if(r&&"None"==a.selection.getNative().type){e=a.document.body.createTextRange();try{e.moveToPoint(i,o)}catch(n){e=null}}var s;e&&(s=a.selection.getIERange,a.selection.getIERange=function(){return e}),a.selection.cache(),s&&(a.selection.getIERange=s),a.selection._cachedRange&&a.selection._cachedStartElement&&(a.fireEvent("beforeselectionchange"),a.fireEvent("selectionchange",!!t),a.fireEvent("afterselectionchange"),a.selection.clear())}},e||50)},_callCmdFn:function(e,t){t=Array.prototype.slice.call(t,0);var i,n,o=t.shift().toLowerCase();return i=this.commands[o]||UM.commands[o],n=i&&i[e],i&&n||"queryCommandState"!=e?n?n.apply(this,[o].concat(t)):void 0:0},execCommand:function(e){if(!this.isFocus()){var t=this.selection._bakRange;t?t.select():this.focus(!0)}e=e.toLowerCase();var i,n=this,o=n.commands[e]||UM.commands[e];return o&&o.execCommand?(o.notNeedUndo||n.__hasEnterExecCommand?(i=this._callCmdFn("execCommand",arguments),!n.__hasEnterExecCommand&&!o.ignoreContentChange&&!n._ignoreContentChange&&n.fireEvent("contentchange")):(n.__hasEnterExecCommand=!0,-1!=n.queryCommandState.apply(n,arguments)&&(n.fireEvent("saveScene"),n.fireEvent("beforeexeccommand",e),i=this._callCmdFn("execCommand",arguments),!o.ignoreContentChange&&!n._ignoreContentChange&&n.fireEvent("contentchange"),n.fireEvent("afterexeccommand",e),n.fireEvent("saveScene")),n.__hasEnterExecCommand=!1),!n.__hasEnterExecCommand&&!o.ignoreContentChange&&!n._ignoreContentChange&&n._selectionChange(),i):null},queryCommandState:function(e){try{return this._callCmdFn("queryCommandState",arguments)}catch(t){return 0}},queryCommandValue:function(e){try{return this._callCmdFn("queryCommandValue",arguments)}catch(t){return null}},hasContents:function(e){if(e)for(var t,i=0;t=e[i++];)if(this.body.getElementsByTagName(t).length>0)return!0;if(!domUtils.isEmptyBlock(this.body))return!0;for(e=["div"],i=0;t=e[i++];)for(var n,o=domUtils.getElementsByTagName(this.body,t),a=0;n=o[a++];)if(domUtils.isCustomeNode(n))return!0;return!1},reset:function(){this.fireEvent("reset")},isEnabled:function(){return 1!=this._isEnabled},setEnabled:function(){var e,t=this;if(t.body.contentEditable=!0,t.lastBk){e=t.selection.getRange();try{e.moveToBookmark(t.lastBk),delete t.lastBk}catch(i){e.setStartAtFirst(t.body).collapse(!0)}e.select(!0)}t.bkqueryCommandState&&(t.queryCommandState=t.bkqueryCommandState,delete t.bkqueryCommandState),t._bkproxyDomEvent&&(t._proxyDomEvent=t._bkproxyDomEvent,delete t._bkproxyDomEvent),t.fireEvent("setEnabled")},enable:function(){return this.setEnabled()},setDisabled:function(e,t){var i=this;i.body.contentEditable=!1,i._except=e?utils.isArray(e)?e:[e]:[],i.lastBk||(i.lastBk=i.selection.getRange().createBookmark(!0)),i.bkqueryCommandState||(i.bkqueryCommandState=i.queryCommandState,i.queryCommandState=function(e){return-1!=utils.indexOf(i._except,e)?i.bkqueryCommandState.apply(i,arguments):-1}),t||i._bkproxyDomEvent||(i._bkproxyDomEvent=i._proxyDomEvent,i._proxyDomEvent=function(){return!1}),i.fireEvent("selectionchange"),i.fireEvent("setDisabled",i._except)},disable:function(e){return this.setDisabled(e)},_setDefaultContent:function(){function e(){var t=this;t.document.getElementById("initContent")&&(t.body.innerHTML="<p>"+(ie?"":"<br/>")+"</p>",t.removeListener("firstBeforeExecCommand focus",e),setTimeout(function(){t.focus(),t._selectionChange()},0))}return function(t){var i=this;i.body.innerHTML='<p id="initContent">'+t+"</p>",i.addListener("firstBeforeExecCommand focus",e)}}(),setShow:function(){var e=this,t=e.selection.getRange();if("none"==e.container.style.display){try{t.moveToBookmark(e.lastBk),delete e.lastBk}catch(i){t.setStartAtFirst(e.body).collapse(!0)}setTimeout(function(){t.select(!0)},100),e.container.style.display=""}},show:function(){return this.setShow()},setHide:function(){var e=this;e.lastBk||(e.lastBk=e.selection.getRange().createBookmark(!0)),e.container.style.display="none"},hide:function(){return this.setHide()},getLang:function(e){var t=UM.I18N[this.options.lang];if(!t)throw Error("not import language file");e=(e||"").split(".");for(var i,n=0;(i=e[n++])&&(t=t[i],t););return t},getContentLength:function(e,t){var i=this.getContent(!1,!1,!0).length;if(e){t=(t||[]).concat(["hr","img","iframe"]),i=this.getContentTxt().replace(/[\t\r\n]+/g,"").length;for(var n,o=0;n=t[o++];)i+=this.body.getElementsByTagName(n).length}return i},addInputRule:function(e,t){e.ignoreUndo=t,this.inputRules.push(e)},filterInputRule:function(e,t){for(var i,n=0;i=this.inputRules[n++];)t&&i.ignoreUndo||i.call(this,e)},addOutputRule:function(e,t){e.ignoreUndo=t,this.outputRules.push(e)},filterOutputRule:function(e,t){for(var i,n=0;i=this.outputRules[n++];)t&&i.ignoreUndo||i.call(this,e)}},utils.inherits(a,EventBase)}();var filterWord=UM.filterWord=function(){function e(e){return/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument|<(v|o):|lang=)/gi.test(e)}function t(e){return e=e.replace(/[\d.]+\w+/g,function(e){return utils.transUnitToPx(e)})}function i(e){return e.replace(/[\t\r\n]+/g," ").replace(/<!--[\s\S]*?-->/gi,"").replace(/<v:shape [^>]*>[\s\S]*?.<\/v:shape>/gi,function(e){if(browser.opera)return"";try{if(/Bitmap/i.test(e))return"";var i=e.match(/width:([ \d.]*p[tx])/i)[1],n=e.match(/height:([ \d.]*p[tx])/i)[1],o=e.match(/src=\s*"([^"]*)"/i)[1];return'<img width="'+t(i)+'" height="'+t(n)+'" src="'+o+'" />'}catch(a){return""}}).replace(/<\/?div[^>]*>/g,"").replace(/v:\w+=(["']?)[^'"]+\1/g,"").replace(/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|xml|meta|link|style|\w+:\w+)(?=[\s\/>]))[^>]*>/gi,"").replace(/<p [^>]*class="?MsoHeading"?[^>]*>(.*?)<\/p>/gi,"<p><strong>$1</strong></p>").replace(/\s+(class|lang|align)\s*=\s*(['"]?)([\w-]+)\2/gi,function(e,t,i,n){return"class"==t&&"MsoListParagraph"==n?e:""}).replace(/<(font|span)[^>]*>(\s*)<\/\1>/gi,function(e,t,i){return i.replace(/[\t\r\n ]+/g," ")}).replace(/(<[a-z][^>]*)\sstyle=(["'])([^\2]*?)\2/gi,function(e,i,n,o){for(var a,r=[],s=o.replace(/^\s+|\s+$/,"").replace(/&#39;/g,"'").replace(/&quot;/gi,"'").split(/;\s*/g),l=0;a=s[l];l++){var d,c,u=a.split(":");if(2==u.length){if(d=u[0].toLowerCase(),c=u[1].toLowerCase(),/^(background)\w*/.test(d)&&0==c.replace(/(initial|\s)/g,"").length||/^(margin)\w*/.test(d)&&/^0\w+$/.test(c))continue;switch(d){case"mso-padding-alt":case"mso-padding-top-alt":case"mso-padding-right-alt":case"mso-padding-bottom-alt":case"mso-padding-left-alt":case"mso-margin-alt":case"mso-margin-top-alt":case"mso-margin-right-alt":case"mso-margin-bottom-alt":case"mso-margin-left-alt":case"mso-height":case"mso-width":case"mso-vertical-align-alt":/<table/.test(i)||(r[l]=d.replace(/^mso-|-alt$/g,"")+":"+t(c));continue;case"horiz-align":r[l]="text-align:"+c;continue;case"vert-align":r[l]="vertical-align:"+c;continue;case"font-color":case"mso-foreground":r[l]="color:"+c;continue;case"mso-background":case"mso-highlight":r[l]="background:"+c;continue;case"mso-default-height":r[l]="min-height:"+t(c);continue;case"mso-default-width":r[l]="min-width:"+t(c);continue;case"mso-padding-between-alt":r[l]="border-collapse:separate;border-spacing:"+t(c);continue;case"text-line-through":("single"==c||"double"==c)&&(r[l]="text-decoration:line-through");continue;case"mso-zero-height":"yes"==c&&(r[l]="display:none");continue;case"margin":if(!/[1-9]/.test(c))continue}if(/^(mso|column|font-emph|lang|layout|line-break|list-image|nav|panose|punct|row|ruby|sep|size|src|tab-|table-border|text-(?:decor|trans)|top-bar|version|vnd|word-break)/.test(d)||/text\-indent|padding|margin/.test(d)&&/\-[\d.]+/.test(c))continue;r[l]=d+":"+u[1]}}return i+(r.length?' style="'+r.join(";").replace(/;{2,}/g,";")+'"':"")}).replace(/[\d.]+(cm|pt)/g,function(e){return utils.transUnitToPx(e)})}return function(t){return e(t)?i(t):t}}();!function(){function e(e,t,i){return e.push(f),t+(i?1:-1)}function t(e,t){for(var i=0;t>i;i++)e.push(h)}function i(r,s,l,d){switch(r.type){case"root":for(var c,u=0;c=r.children[u++];)l&&"element"==c.type&&!dtd.$inlineWithA[c.tagName]&&u>1&&(e(s,d,!0),t(s,d)),i(c,s,l,d);break;case"text":n(r,s);break;case"element":o(r,s,l,d);break;case"comment":a(r,s,l)}return s}function n(e,t){t.push("pre"==e.parentNode.tagName?e.data:u[e.parentNode.tagName]?utils.html(e.data):e.data.replace(/[ ]{2}/g," &nbsp;"))}function o(n,o,a,r){var s="";if(n.attrs){s=[];var l=n.attrs;for(var d in l)s.push(d+(void 0!==l[d]?'="'+(c[d]?utils.html(l[d]).replace(/["]/g,function(e){return"&quot;"}):utils.unhtml(l[d]))+'"':""));s=s.join(" ")}if(o.push("<"+n.tagName+(s?" "+s:"")+(dtd.$empty[n.tagName]?"/":"")+">"),a&&!dtd.$inlineWithA[n.tagName]&&"pre"!=n.tagName&&n.children&&n.children.length&&(r=e(o,r,!0),t(o,r)),n.children&&n.children.length)for(var u,h=0;u=n.children[h++];)a&&"element"==u.type&&!dtd.$inlineWithA[u.tagName]&&h>1&&(e(o,r),t(o,r)),i(u,o,a,r);dtd.$empty[n.tagName]||(a&&!dtd.$inlineWithA[n.tagName]&&"pre"!=n.tagName&&n.children&&n.children.length&&(r=e(o,r),t(o,r)),o.push("</"+n.tagName+">"))}function a(e,t){t.push("<!--"+e.data+"-->")}function r(e,t){var i;if("element"==e.type&&e.getAttr("id")==t)return e;if(e.children&&e.children.length)for(var n,o=0;n=e.children[o++];)if(i=r(n,t))return i}function s(e,t,i){if("element"==e.type&&e.tagName==t&&i.push(e),e.children&&e.children.length)for(var n,o=0;n=e.children[o++];)s(n,t,i)}function l(e,t){if(e.children&&e.children.length)for(var i,n=0;i=e.children[n];)l(i,t),i.parentNode&&(i.children&&i.children.length&&t(i),i.parentNode&&n++);else t(e)}var d=UM.uNode=function(e){this.type=e.type,this.data=e.data,this.tagName=e.tagName,this.parentNode=e.parentNode,this.attrs=e.attrs||{},this.children=e.children},c={href:1,src:1,_src:1,_href:1,cdata_data:1},u={style:1,script:1},h="    ",f="\n";d.createElement=function(e){return/[<>]/.test(e)?UM.htmlparser(e).children[0]:new d({type:"element",children:[],tagName:e})},d.createText=function(e,t){return new UM.uNode({type:"text",data:t?e:utils.unhtml(e||"")})},d.prototype={toHtml:function(e){var t=[];return i(this,t,e,0),t.join("")},innerHTML:function(e){if("element"!=this.type||dtd.$empty[this.tagName])return this;if(utils.isString(e)){if(this.children)for(var t,i=0;t=this.children[i++];)t.parentNode=null;this.children=[];for(var t,n=UM.htmlparser(e),i=0;t=n.children[i++];)this.children.push(t),t.parentNode=this;return this}var n=new UM.uNode({type:"root",children:this.children});return n.toHtml()},innerText:function(e,t){if("element"!=this.type||dtd.$empty[this.tagName])return this;if(e){if(this.children)for(var i,n=0;i=this.children[n++];)i.parentNode=null;return this.children=[],this.appendChild(d.createText(e,t)),this}return this.toHtml().replace(/<[^>]+>/g,"")},getData:function(){return"element"==this.type?"":this.data},firstChild:function(){return this.children?this.children[0]:null},lastChild:function(){return this.children?this.children[this.children.length-1]:null},previousSibling:function(){for(var e,t=this.parentNode,i=0;e=t.children[i];i++)if(e===this)return 0==i?null:t.children[i-1]},nextSibling:function(){for(var e,t=this.parentNode,i=0;e=t.children[i++];)if(e===this)return t.children[i]},replaceChild:function(e,t){if(this.children){e.parentNode&&e.parentNode.removeChild(e);for(var i,n=0;i=this.children[n];n++)if(i===t)return this.children.splice(n,1,e),t.parentNode=null,e.parentNode=this,e}},appendChild:function(e){if("root"==this.type||"element"==this.type&&!dtd.$empty[this.tagName]){this.children||(this.children=[]),e.parentNode&&e.parentNode.removeChild(e);for(var t,i=0;t=this.children[i];i++)if(t===e){this.children.splice(i,1);break}return this.children.push(e),e.parentNode=this,e}},insertBefore:function(e,t){if(this.children){e.parentNode&&e.parentNode.removeChild(e);for(var i,n=0;i=this.children[n];n++)if(i===t)return this.children.splice(n,0,e),e.parentNode=this,e}},insertAfter:function(e,t){if(this.children){e.parentNode&&e.parentNode.removeChild(e);for(var i,n=0;i=this.children[n];n++)if(i===t)return this.children.splice(n+1,0,e),e.parentNode=this,e}},removeChild:function(e,t){if(this.children)for(var i,n=0;i=this.children[n];n++)if(i===e){if(this.children.splice(n,1),i.parentNode=null,t&&i.children&&i.children.length)for(var o,a=0;o=i.children[a];a++)this.children.splice(n+a,0,o),o.parentNode=this;return i}},getAttr:function(e){return this.attrs&&this.attrs[e.toLowerCase()]},setAttr:function(e,t){if(!e)return void delete this.attrs;if(this.attrs||(this.attrs={}),utils.isObject(e))for(var i in e)e[i]?this.attrs[i.toLowerCase()]=e[i]:delete this.attrs[i];else t?this.attrs[e.toLowerCase()]=t:delete this.attrs[e]},hasAttr:function(e){var t=this.getAttr(e);return null!==t&&void 0!==t},getIndex:function(){for(var e,t=this.parentNode,i=0;e=t.children[i];i++)if(e===this)return i;return-1},getNodeById:function(e){var t;if(this.children&&this.children.length)for(var i,n=0;i=this.children[n++];)if(t=r(i,e))return t},getNodesByTagName:function(e){e=utils.trim(e).replace(/[ ]{2,}/g," ").split(" ");var t=[],i=this;return utils.each(e,function(e){if(i.children&&i.children.length)for(var n,o=0;n=i.children[o++];)s(n,e,t)}),t},getStyle:function(e){var t=this.getAttr("style");if(!t)return"";var i=new RegExp("(^|;)\\s*"+e+":([^;]+)","i"),n=t.match(i);return n&&n[0]?n[2]:""},setStyle:function(e,t){function i(e,t){var i=new RegExp("(^|;)\\s*"+e+":([^;]+;?)","gi");n=n.replace(i,"$1"),t&&(n=e+":"+utils.unhtml(t)+";"+n)}var n=this.getAttr("style");if(n||(n=""),utils.isObject(e))for(var o in e)i(o,e[o]);else i(e,t);this.setAttr("style",utils.trim(n))},hasClass:function(e){if(this.hasAttr("class")){var t=this.getAttr("class").split(/\s+/),i=!1;return $.each(t,function(t,n){n===e&&(i=!0)}),i}return!1},addClass:function(e){var t=null,i=!1;this.hasAttr("class")?(t=this.getAttr("class"),t=t.split(/\s+/),t.forEach(function(t){return t===e?void(i=!0):void 0}),!i&&t.push(e),this.setAttr("class",t.join(" "))):this.setAttr("class",e)},removeClass:function(e){if(this.hasAttr("class")){var t=this.getAttr("class");t=t.replace(new RegExp("\\b"+e+"\\b","g"),""),this.setAttr("class",utils.trim(t).replace(/[ ]{2,}/g," "))}},traversal:function(e){return this.children&&this.children.length&&l(this,e),this}}}();var htmlparser=UM.htmlparser=function(e,t){function i(e,t){if(h[e.tagName]){var i=c.createElement(h[e.tagName]);e.appendChild(i),i.appendChild(c.createText(t)),e=i}else e.appendChild(c.createText(t))}function n(e,t,i){var o;if(o=u[t]){for(var a,s=e;"root"!=s.type;){if(utils.isArray(o)?-1!=utils.indexOf(o,s.tagName):o==s.tagName){e=s,a=!0;break}s=s.parentNode}a||(e=n(e,utils.isArray(o)?o[0]:o))}var l=new c({parentNode:e,type:"element",tagName:t.toLowerCase(),children:dtd.$empty[t]?null:[]});if(i){for(var h,f={};h=r.exec(i);)f[h[1].toLowerCase()]=d[h[1].toLowerCase()]?h[2]||h[3]||h[4]:utils.unhtml(h[2]||h[3]||h[4]);l.attrs=f}return e.children.push(l),dtd.$empty[t]?e:l}function o(e,t){e.children.push(new c({type:"comment",data:t,parentNode:e}))}var a=/<(?:(?:\/([^>]+)>)|(?:!--([\S|\s]*?)-->)|(?:([^\s\/>]+)\s*((?:(?:"[^"]*")|(?:'[^']*')|[^"'<>])*)\/?>))/g,r=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,s={b:1,code:1,i:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,span:1,sub:1,img:1,sup:1,font:1,big:1,small:1,iframe:1,a:1,br:1,pre:1};e=e.replace(new RegExp(domUtils.fillChar,"g"),""),t||(e=e.replace(new RegExp("[\\r\\t\\n"+(t?"":" ")+"]*</?(\\w+)\\s*(?:[^>]*)>[\\r\\t\\n"+(t?"":" ")+"]*","g"),function(e,i){return i&&s[i.toLowerCase()]?e.replace(/(^[\n\r]+)|([\n\r]+$)/g,""):e.replace(new RegExp("^[\\r\\n"+(t?"":" ")+"]+"),"").replace(new RegExp("[\\r\\n"+(t?"":" ")+"]+$"),"")}));for(var l,d={href:1,src:1},c=UM.uNode,u={td:"tr",tr:["tbody","thead","tfoot"],tbody:"table",th:"tr",thead:"table",tfoot:"table",caption:"table",li:["ul","ol"],dt:"dl",dd:"dl",option:"select"},h={ol:"li",ul:"li"},f=0,p=0,m=new c({type:"root",children:[]}),g=m;l=a.exec(e);){f=l.index;try{if(f>p&&i(g,e.slice(p,f)),l[3])dtd.$cdata[g.tagName]?i(g,l[0]):g=n(g,l[3].toLowerCase(),l[4]);else if(l[1]){if("root"!=g.type)if(dtd.$cdata[g.tagName]&&!dtd.$cdata[l[1]])i(g,l[0]);else{for(var v=g;"element"==g.type&&g.tagName!=l[1].toLowerCase();)if(g=g.parentNode,"root"==g.type)throw g=v,"break";g=g.parentNode}}else l[2]&&o(g,l[2])}catch(b){}p=a.lastIndex}return p<e.length&&i(g,e.slice(p)),m},filterNode=UM.filterNode=function(){function e(t,i){switch(t.type){case"text":break;case"element":var n;if(n=i[t.tagName])if("-"===n)t.parentNode.removeChild(t);else if(utils.isFunction(n)){var o=t.parentNode,a=t.getIndex();if(n(t),t.parentNode){if(t.children)for(var r,s=0;r=t.children[s];)e(r,i),r.parentNode&&s++}else for(var r,s=a;r=o.children[s];)e(r,i),r.parentNode&&s++}else{var l=n.$;if(l&&t.attrs){var d,c={};for(var u in l){if(d=t.getAttr(u),"style"==u&&utils.isArray(l[u])){var h=[];utils.each(l[u],function(e){var i;(i=t.getStyle(e))&&h.push(e+":"+i)}),d=h.join(";")}d&&(c[u]=d)}t.attrs=c;

}if(t.children)for(var r,s=0;r=t.children[s];)e(r,i),r.parentNode&&s++}else if(dtd.$cdata[t.tagName])t.parentNode.removeChild(t);else{var o=t.parentNode,a=t.getIndex();t.parentNode.removeChild(t,!0);for(var r,s=a;r=o.children[s];)e(r,i),r.parentNode&&s++}break;case"comment":t.parentNode.removeChild(t)}}return function(t,i){if(utils.isEmptyObject(i))return t;var n;(n=i["-"])&&utils.each(n.split(" "),function(e){i[e]="-"});for(var o,a=0;o=t.children[a];)e(o,i),o.parentNode&&a++;return t}}();UM.commands.inserthtml={execCommand:function(e,t,i){var n,o,a=this;if(t&&a.fireEvent("beforeinserthtml",t)!==!0){if(n=a.selection.getRange(),o=n.document.createElement("div"),o.style.display="inline",!i){var r=UM.htmlparser(t);a.options.filterRules&&UM.filterNode(r,a.options.filterRules),a.filterInputRule(r),t=r.toHtml()}if(o.innerHTML=utils.trim(t),!n.collapsed){var s=n.startContainer;if(domUtils.isFillChar(s)&&n.setStartBefore(s),s=n.endContainer,domUtils.isFillChar(s)&&n.setEndAfter(s),n.txtToElmBoundary(),n.endContainer&&1==n.endContainer.nodeType&&(s=n.endContainer.childNodes[n.endOffset],s&&domUtils.isBr(s)&&n.setEndAfter(s)),0==n.startOffset&&(s=n.startContainer,domUtils.isBoundaryNode(s,"firstChild")&&(s=n.endContainer,n.endOffset==(3==s.nodeType?s.nodeValue.length:s.childNodes.length)&&domUtils.isBoundaryNode(s,"lastChild")&&(a.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>",n.setStart(a.body.firstChild,0).collapse(!0)))),!n.collapsed&&n.deleteContents(),1==n.startContainer.nodeType){var l,d=n.startContainer.childNodes[n.startOffset];if(d&&domUtils.isBlockElm(d)&&(l=d.previousSibling)&&domUtils.isBlockElm(l)){for(n.setEnd(l,l.childNodes.length).collapse();d.firstChild;)l.appendChild(d.firstChild);domUtils.remove(d)}}}var d,c,l,u,h,f=0;for(n.inFillChar()&&(d=n.startContainer,domUtils.isFillChar(d)?(n.setStartBefore(d).collapse(!0),domUtils.remove(d)):domUtils.isFillChar(d,!0)&&(d.nodeValue=d.nodeValue.replace(fillCharReg,""),n.startOffset--,n.collapsed&&n.collapse(!0)));d=o.firstChild;){if(f){for(var p=a.document.createElement("p");d&&(3==d.nodeType||!dtd.$block[d.tagName]);)h=d.nextSibling,p.appendChild(d),d=h;p.firstChild&&(d=p)}if(n.insertNode(d),h=d.nextSibling,!f&&d.nodeType==domUtils.NODE_ELEMENT&&domUtils.isBlockElm(d)&&(c=domUtils.findParent(d,function(e){return domUtils.isBlockElm(e)}),c&&"body"!=c.tagName.toLowerCase()&&(!dtd[c.tagName][d.nodeName]||d.parentNode!==c))){if(dtd[c.tagName][d.nodeName])for(u=d.parentNode;u!==c;)l=u,u=u.parentNode;else l=c;domUtils.breakParent(d,l||u);var l=d.previousSibling;domUtils.trimWhiteTextNode(l),l.childNodes.length||domUtils.remove(l),!browser.ie&&(m=d.nextSibling)&&domUtils.isBlockElm(m)&&m.lastChild&&!domUtils.isBr(m.lastChild)&&m.appendChild(a.document.createElement("br")),f=1}var m=d.nextSibling;if(!o.firstChild&&m&&domUtils.isBlockElm(m)){n.setStart(m,0).collapse(!0);break}n.setEndAfter(d).collapse()}if(d=n.startContainer,h&&domUtils.isBr(h)&&domUtils.remove(h),domUtils.isBlockElm(d)&&domUtils.isEmptyNode(d))if(h=d.nextSibling)domUtils.remove(d),1==h.nodeType&&dtd.$block[h.tagName]&&n.setStart(h,0).collapse(!0).shrinkBoundary();else try{d.innerHTML=browser.ie?domUtils.fillChar:"<br/>"}catch(g){n.setStartBefore(d),domUtils.remove(d)}try{if(browser.ie9below&&1==n.startContainer.nodeType&&!n.startContainer.childNodes[n.startOffset]){var v=n.startContainer,l=v.childNodes[n.startOffset-1];if(l&&1==l.nodeType&&dtd.$empty[l.tagName]){var b=this.document.createTextNode(domUtils.fillChar);n.insertNode(b).setStart(b,0).collapse(!0)}}setTimeout(function(){n.select(!0)})}catch(g){}setTimeout(function(){n=a.selection.getRange(),n.scrollIntoView(),a.fireEvent("afterinserthtml")},200)}}},UM.commands.insertimage={execCommand:function(e,t){if(t=utils.isArray(t)?t:[t],t.length){var i,n=this,o=[],a="";if(i=t[0],1==t.length)a='<img src="'+i.src+'" '+(i._src?' _src="'+i._src+'" ':"")+(i.width?'width="'+i.width+'" ':"")+(i.height?' height="'+i.height+'" ':"")+("left"==i.floatStyle||"right"==i.floatStyle?' style="float:'+i.floatStyle+';"':"")+(i.title&&""!=i.title?' title="'+i.title+'"':"")+(i.border&&"0"!=i.border?' border="'+i.border+'"':"")+(i.alt&&""!=i.alt?' alt="'+i.alt+'"':"")+(i.hspace&&"0"!=i.hspace?' hspace = "'+i.hspace+'"':"")+(i.vspace&&"0"!=i.vspace?' vspace = "'+i.vspace+'"':"")+"/>","center"==i.floatStyle&&(a='<p style="text-align: center">'+a+"</p>"),o.push(a);else for(var r=0;i=t[r++];)a="<p "+("center"==i.floatStyle?'style="text-align: center" ':"")+'><img src="'+i.src+'" '+(i.width?'width="'+i.width+'" ':"")+(i._src?' _src="'+i._src+'" ':"")+(i.height?' height="'+i.height+'" ':"")+' style="'+(i.floatStyle&&"center"!=i.floatStyle?"float:"+i.floatStyle+";":"")+(i.border||"")+'" '+(i.title?' title="'+i.title+'"':"")+" /></p>",o.push(a);n.execCommand("insertHtml",o.join(""),!0)}}},UM.plugins.justify=function(){var e=this;$.each("justifyleft justifyright justifycenter justifyfull".split(" "),function(t,i){e.commands[i]={execCommand:function(e){return this.document.execCommand(e)},queryCommandValue:function(e){var t=this.document.queryCommandValue(e);return t===!0||"true"===t?e.replace(/justify/,""):""},queryCommandState:function(e){return this.document.queryCommandState(e)?1:0}}})},UM.plugins.font=function(){var e=this,t={forecolor:"forecolor",backcolor:"backcolor",fontsize:"fontsize",fontfamily:"fontname"},i={forecolor:"color",backcolor:"background-color",fontsize:"font-size",fontfamily:"font-family"},n={forecolor:"color",fontsize:"size",fontfamily:"face"};e.setOpt({fontfamily:[{name:"songti",val:"宋体,SimSun"},{name:"yahei",val:"微软雅黑,Microsoft YaHei"},{name:"kaiti",val:"楷体,楷体_GB2312, SimKai"},{name:"heiti",val:"黑体, SimHei"},{name:"lishu",val:"隶书, SimLi"},{name:"andaleMono",val:"andale mono"},{name:"arial",val:"arial, helvetica,sans-serif"},{name:"arialBlack",val:"arial black,avant garde"},{name:"comicSansMs",val:"comic sans ms"},{name:"impact",val:"impact,chicago"},{name:"timesNewRoman",val:"times new roman"},{name:"sans-serif",val:"sans-serif"}],fontsize:[10,12,16,18,24,32,48]}),e.addOutputRule(function(e){utils.each(e.getNodesByTagName("font"),function(e){if("font"==e.tagName){var t=[];for(var i in e.attrs)switch(i){case"size":var n=e.attrs[i];$.each({10:"1",12:"2",16:"3",18:"4",24:"5",32:"6",48:"7"},function(e,t){return t==n?(n=e,!1):void 0}),t.push("font-size:"+n+"px");break;case"color":t.push("color:"+e.attrs[i]);break;case"face":t.push("font-family:"+e.attrs[i]);break;case"style":t.push(e.attrs[i])}e.attrs={style:t.join(";")}}e.tagName="span","span"==e.parentNode.tagName&&1==e.parentNode.children.length&&($.each(e.attrs,function(t,i){e.parentNode.attrs[t]="style"==t?e.parentNode.attrs[t]+i:i}),e.parentNode.removeChild(e,!0))})});for(var o in t)!function(o){e.commands[o]={execCommand:function(e,n){if("transparent"!=n){var o=this.selection.getRange();if(!o.collapsed){if("fontsize"==e&&(n={10:"1",12:"2",16:"3",18:"4",24:"5",32:"6",48:"7"}[(n+"").replace(/px/,"")]),this.document.execCommand(t[e],!1,n),browser.gecko&&$.each(this.$body.find("a"),function(e,t){var i=t.parentNode;if(i.lastChild===i.firstChild&&/FONT|SPAN/.test(i.tagName)){var n=i.cloneNode(!1);n.innerHTML=t.innerHTML,$(t).html("").append(n).insertBefore(i),$(i).remove()}}),!browser.ie){var a=this.selection.getNative().getRangeAt(0),r=a.commonAncestorContainer,o=this.selection.getRange(),s=o.createBookmark(!0);$(r).find("a").each(function(e,t){var i=t.parentNode;if("FONT"==i.nodeName){var n=i.cloneNode(!1);n.innerHTML=t.innerHTML,$(t).html("").append(n)}}),o.moveToBookmark(s).select()}return!0}var l=$("<span></span>").css(i[e],n)[0];o.insertNode(l).setStart(l,0).setCursor()}},queryCommandValue:function(t){var o=e.selection.getStart(),a=$(o).css(i[t]);return void 0===a&&(a=$(o).attr(n[t])),a?utils.fixColor(t,a).replace(/px/,""):""},queryCommandState:function(e){return this.queryCommandValue(e)}}}(o)},UM.plugins.link=function(){var e=this;e.setOpt("autourldetectinie",!1),browser.ie&&this.options.autourldetectinie===!1&&this.addListener("keyup",function(e,t){var i=this,n=t.keyCode;if(13==n||32==n){var o=i.selection.getRange(),a=o.startContainer;if(13==n){if("P"==a.nodeName){var r=a.previousSibling;if(r&&1==r.nodeType){var r=r.lastChild;r&&"A"==r.nodeName&&!r.getAttribute("_href")&&domUtils.remove(r,!0)}}}else 32==n&&3==a.nodeType&&/^\s$/.test(a.nodeValue)&&(a=a.previousSibling,a&&"A"==a.nodeName&&!a.getAttribute("_href")&&domUtils.remove(a,!0))}}),this.addOutputRule(function(e){$.each(e.getNodesByTagName("a"),function(e,t){var i=utils.html(t.getAttr("_href"));/^(ftp|https?|\/|file)/.test(i)||(i="http://"+i),t.setAttr("href",i),t.setAttr("_href"),""==t.getAttr("title")&&t.setAttr("title")})}),this.addInputRule(function(e){$.each(e.getNodesByTagName("a"),function(e,t){t.setAttr("_href",utils.html(t.getAttr("href")))})}),e.commands.link={execCommand:function(e,t){var i=this,n=i.selection.getRange();if(n.collapsed){var o=n.startContainer;(o=domUtils.findParentByTagName(o,"a",!0))?($(o).attr(t),n.selectNode(o).select()):n.insertNode($("<a>"+t.href+"</a>").attr(t)[0]).select()}else i.document.execCommand("createlink",!1,"_umeditor_link"),utils.each(domUtils.getElementsByTagName(i.body,"a",function(e){return"_umeditor_link"==e.getAttribute("href")}),function(e){"_umeditor_link"==$(e).text()&&$(e).text(t.href),domUtils.setAttributes(e,t),n.selectNode(e).select()})},queryCommandState:function(){return this.queryCommandValue("link")?1:0},queryCommandValue:function(){var e,t=this.selection.getStartElementPath();return $.each(t,function(t,i){return"A"==i.nodeName?(e=i,!1):void 0}),e}},e.commands.unlink={execCommand:function(){this.document.execCommand("unlink")}}},UM.commands.print={execCommand:function(){var e=this,t="editor_print_"+ +new Date;$('<iframe src="" id="'+t+'" name="'+t+'" frameborder="0"></iframe>').attr("id",t).css({width:"0px",height:"0px",overflow:"hidden","float":"left",position:"absolute",top:"-10000px",left:"-10000px"}).appendTo(e.$container.find(".edui-dialog-container"));var i=window.open("",t,""),n=i.document;n.open(),n.write("<html><head></head><body><div>"+this.getContent(null,null,!0)+"</div><script>setTimeout(function(){window.print();setTimeout(function(){window.parent.$('#"+t+"').remove();},100);},200);</script></body></html>"),n.close()},notNeedUndo:1},UM.plugins.paragraph=function(){var e=this;e.setOpt("paragraph",{p:"",h1:"",h2:"",h3:"",h4:"",h5:"",h6:""}),e.commands.paragraph={execCommand:function(e,t){return this.document.execCommand("formatBlock",!1,"<"+t+">")},queryCommandValue:function(){try{var e=this.document.queryCommandValue("formatBlock")}catch(t){}return e}}},UM.plugins.horizontal=function(){var e=this;e.commands.horizontal={execCommand:function(){this.document.execCommand("insertHorizontalRule");var t=e.selection.getRange().txtToElmBoundary(!0),i=t.startContainer;if(domUtils.isBody(t.startContainer)){var n=t.startContainer.childNodes[t.startOffset];n||(n=$("<p></p>").appendTo(t.startContainer).html(browser.ie?"&nbsp;":"<br/>")[0]),t.setStart(n,0).setCursor()}else{for(;dtd.$inline[i.tagName]&&i.lastChild===i.firstChild;){var o=i.parentNode;o.appendChild(i.firstChild),o.removeChild(i),i=o}for(;dtd.$inline[i.tagName];)i=i.parentNode;if(1==i.childNodes.length&&"HR"==i.lastChild.nodeName){var a=i.lastChild;$(a).insertBefore(i),t.setStart(i,0).setCursor()}else{a=$("hr",i)[0],domUtils.breakParent(a,i);var r=a.previousSibling;r&&domUtils.isEmptyBlock(r)&&$(r).remove(),t.setStart(a.nextSibling,0).setCursor()}}}}},UM.commands.cleardoc={execCommand:function(){var e=this,t=e.selection.getRange();e.body.innerHTML="<p>"+(ie?"":"<br/>")+"</p>",t.setStart(e.body.firstChild,0).setCursor(!1,!0),setTimeout(function(){e.fireEvent("clearDoc")},0)}},UM.plugins.undo=function(){function e(e,t){if(e.length!=t.length)return 0;for(var i=0,n=e.length;n>i;i++)if(e[i]!=t[i])return 0;return 1}function t(t,i){return t.collapsed!=i.collapsed?0:e(t.startAddress,i.startAddress)&&e(t.endAddress,i.endAddress)?1:0}function i(){this.list=[],this.index=0,this.hasUndo=!1,this.hasRedo=!1,this.undo=function(){if(this.hasUndo){if(!this.list[this.index-1]&&1==this.list.length)return void this.reset();for(;this.list[this.index].content==this.list[this.index-1].content;)if(this.index--,0==this.index)return this.restore(0);this.restore(--this.index)}},this.redo=function(){if(this.hasRedo){for(;this.list[this.index].content==this.list[this.index+1].content;)if(this.index++,this.index==this.list.length-1)return this.restore(this.index);this.restore(++this.index)}},this.restore=function(){var e=this.editor,t=this.list[this.index],i=UM.htmlparser(t.content.replace(l,""));e.options.autoClearEmptyNode=!1,e.filterInputRule(i,!0),e.options.autoClearEmptyNode=c,e.body.innerHTML=i.toHtml(),e.fireEvent("afterscencerestore"),browser.ie&&utils.each(domUtils.getElementsByTagName(e.document,"td th caption p"),function(t){domUtils.isEmptyNode(t)&&domUtils.fillNode(e.document,t)});try{var n=new dom.Range(e.document,e.body).moveToAddress(t.address);if(browser.ie&&n.collapsed&&1==n.startContainer.nodeType){var o=n.startContainer.childNodes[n.startOffset];(!o||1==o.nodeType&&dtd.$empty[o])&&n.insertNode(e.document.createTextNode(" ")).collapse(!0)}n.select(d[n.startContainer.nodeName.toLowerCase()])}catch(a){}this.update(),this.clearKey(),e.fireEvent("reset",!0)},this.getScene=function(){var e=this.editor,t=e.selection.getRange(),i=t.createAddress(!1,!0);e.fireEvent("beforegetscene");var n=UM.htmlparser(e.body.innerHTML,!0);e.options.autoClearEmptyNode=!1,e.filterOutputRule(n,!0),e.options.autoClearEmptyNode=c;var o=n.toHtml();return browser.ie&&(o=o.replace(/>&nbsp;</g,"><").replace(/\s*</g,"<").replace(/>\s*/g,">")),e.fireEvent("aftergetscene"),{address:i,content:o}},this.save=function(e,i){clearTimeout(o);var n=this.getScene(i),a=this.list[this.index];a&&a.content==n.content&&(e?1:t(a.address,n.address))||(this.list=this.list.slice(0,this.index+1),this.list.push(n),this.list.length>r&&this.list.shift(),this.index=this.list.length-1,this.clearKey(),this.update())},this.update=function(){this.hasRedo=!!this.list[this.index+1],this.hasUndo=!!this.list[this.index-1]},this.reset=function(){this.list=[],this.index=0,this.hasUndo=!1,this.hasRedo=!1,this.clearKey()},this.clearKey=function(){f=0,u=null}}function n(){this.undoManger.save()}var o,a=this,r=a.options.maxUndoCount||20,s=a.options.maxInputCount||20,l=new RegExp(domUtils.fillChar+"|</hr>","gi"),d={ol:1,ul:1,table:1,tbody:1,tr:1,body:1},c=a.options.autoClearEmptyNode;a.undoManger=new i,a.undoManger.editor=a,a.addListener("saveScene",function(){var e=Array.prototype.splice.call(arguments,1);this.undoManger.save.apply(this.undoManger,e)}),a.addListener("beforeexeccommand",n),a.addListener("afterexeccommand",n),a.addListener("reset",function(e,t){t||this.undoManger.reset()}),a.commands.redo=a.commands.undo={execCommand:function(e){this.undoManger[e]()},queryCommandState:function(e){return this.undoManger["has"+("undo"==e.toLowerCase()?"Undo":"Redo")]?0:-1},notNeedUndo:1};var u,h={16:1,17:1,18:1,37:1,38:1,39:1,40:1},f=0,p=!1;a.addListener("ready",function(){$(this.body).on("compositionstart",function(){p=!0}).on("compositionend",function(){p=!1})}),a.addshortcutkey({Undo:"ctrl+90",Redo:"ctrl+89,shift+ctrl+z"});var m=!0;a.addListener("keydown",function(e,t){function i(e){e.selection.getRange().collapsed&&e.fireEvent("contentchange"),e.undoManger.save(!1,!0),e.fireEvent("selectionchange")}var n=this,a=t.keyCode||t.which;if(!(h[a]||t.ctrlKey||t.metaKey||t.shiftKey||t.altKey)){if(p)return;if(!n.selection.getRange().collapsed)return n.undoManger.save(!1,!0),void(m=!1);0==n.undoManger.list.length&&n.undoManger.save(!0),clearTimeout(o),o=setTimeout(function(){if(p)var e=setInterval(function(){p||(i(n),clearInterval(e))},300);else i(n)},200),u=a,f++,f>=s&&i(n)}}),a.addListener("keyup",function(e,t){var i=t.keyCode||t.which;if(!(h[i]||t.ctrlKey||t.metaKey||t.shiftKey||t.altKey)){if(p)return;m||(this.undoManger.save(!1,!0),m=!0)}})},UM.plugins.paste=function(){function e(e){var t=this.document;if(!t.getElementById("baidu_pastebin")){var i=this.selection.getRange(),n=i.createBookmark(),o=t.createElement("div");o.id="baidu_pastebin",browser.webkit&&o.appendChild(t.createTextNode(domUtils.fillChar+domUtils.fillChar)),this.body.appendChild(o),n.start.style.display="",o.style.cssText="position:absolute;width:1px;height:1px;overflow:hidden;left:-1000px;white-space:nowrap;top:"+$(n.start).position().top+"px",i.selectNodeContents(o).select(!0),setTimeout(function(){if(browser.webkit)for(var a,r=0,s=t.querySelectorAll("#baidu_pastebin");a=s[r++];){if(!domUtils.isEmptyNode(a)){o=a;break}domUtils.remove(a)}try{o.parentNode.removeChild(o)}catch(l){}i.moveToBookmark(n).select(!0),e(o)},0)}}function t(e){var t;if(e.firstChild){for(var n,o=domUtils.getElementsByTagName(e,"span"),a=0;n=o[a++];)("_baidu_cut_start"==n.id||"_baidu_cut_end"==n.id)&&domUtils.remove(n);if(browser.webkit){for(var r,s=e.querySelectorAll("div br"),a=0;r=s[a++];){var l=r.parentNode;"DIV"==l.tagName&&1==l.childNodes.length&&(l.innerHTML="<p><br/></p>",domUtils.remove(l))}for(var d,c=e.querySelectorAll("#baidu_pastebin"),a=0;d=c[a++];){var u=i.document.createElement("p");for(d.parentNode.insertBefore(u,d);d.firstChild;)u.appendChild(d.firstChild);domUtils.remove(d)}for(var h,f=e.querySelectorAll("meta"),a=0;h=f[a++];)domUtils.remove(h);var s=e.querySelectorAll("br");for(a=0;h=s[a++];)/^apple-/i.test(h.className)&&domUtils.remove(h)}if(browser.gecko){var p=e.querySelectorAll("[_moz_dirty]");for(a=0;h=p[a++];)h.removeAttribute("_moz_dirty")}if(!browser.ie)for(var h,m=e.querySelectorAll("span.Apple-style-span"),a=0;h=m[a++];)domUtils.remove(h,!0);t=e.innerHTML,t=UM.filterWord(t);var g=UM.htmlparser(t);if(i.options.filterRules&&UM.filterNode(g,i.options.filterRules),i.filterInputRule(g),browser.webkit){var v=g.lastChild();v&&"element"==v.type&&"br"==v.tagName&&g.removeChild(v),utils.each(i.body.querySelectorAll("div"),function(e){domUtils.isEmptyBlock(e)&&domUtils.remove(e)})}if(t={html:g.toHtml()},i.fireEvent("beforepaste",t,g),!t.html)return;i.execCommand("insertHtml",t.html,!0),i.fireEvent("afterpaste",t)}}var i=this;i.addListener("ready",function(){$(i.body).on("cut",function(){var e=i.selection.getRange();!e.collapsed&&i.undoManger&&i.undoManger.save()}).on(browser.ie||browser.opera?"keydown":"paste",function(n){(!browser.ie&&!browser.opera||(n.ctrlKey||n.metaKey)&&"86"==n.keyCode)&&e.call(i,function(e){t(e)})})})},UM.plugins.list=function(){var e=this;e.setOpt({insertorderedlist:{decimal:"","lower-alpha":"","lower-roman":"","upper-alpha":"","upper-roman":""},insertunorderedlist:{circle:"",disc:"",square:""}}),this.addInputRule(function(e){utils.each(e.getNodesByTagName("li"),function(e){0==e.children.length&&e.parentNode.removeChild(e)})}),e.commands.insertorderedlist=e.commands.insertunorderedlist={execCommand:function(e){this.document.execCommand(e);var t=this.selection.getRange(),i=t.createBookmark(!0);return this.$body.find("ol,ul").each(function(e,t){var i=t.parentNode;"P"==i.tagName&&i.lastChild===i.firstChild&&($(t).children().each(function(e,t){var n=i.cloneNode(!1);$(n).append(t.innerHTML),$(t).html("").append(n)}),$(t).insertBefore(i),$(i).remove()),dtd.$inline[i.tagName]&&("SPAN"==i.tagName&&$(t).children().each(function(e,t){var n=i.cloneNode(!1);if("P"!=t.firstChild.nodeName){for(;t.firstChild;)n.appendChild(t.firstChild);$("<p></p>").appendTo(t).append(n)}else{for(;t.firstChild;)n.appendChild(t.firstChild);$(t.firstChild).append(n)}}),domUtils.remove(i,!0))}),t.moveToBookmark(i).select(),!0},queryCommandState:function(e){return this.document.queryCommandState(e)}}},function(){var e={textarea:function(e,t){var i=t.ownerDocument.createElement("textarea");return i.style.cssText="resize:none;border:0;padding:0;margin:0;overflow-y:auto;outline:0",browser.ie&&browser.version<8&&(i.style.width=t.offsetWidth+"px",i.style.height=t.offsetHeight+"px",t.onresize=function(){i.style.width=t.offsetWidth+"px",i.style.height=t.offsetHeight+"px"}),t.appendChild(i),{container:i,setContent:function(e){i.value=e},getContent:function(){return i.value},select:function(){var e;browser.ie?(e=i.createTextRange(),e.collapse(!0),e.select()):(i.setSelectionRange(0,0),i.focus())},dispose:function(){t.removeChild(i),t.onresize=null,i=null,t=null}}}};UM.plugins.source=function(){function t(t){return e.textarea(n,t)}var i,n=this,o=this.options,a=!1;o.sourceEditor="textarea",n.setOpt({sourceEditorFirst:!1});var r,s=n.getContent;n.commands.source={execCommand:function(){if(a=!a){r=n.selection.getRange().createAddress(!1,!0),n.undoManger&&n.undoManger.save(!0),browser.gecko&&(n.body.contentEditable=!1),n.body.style.cssText+=";position:absolute;left:-32768px;top:-32768px;",n.fireEvent("beforegetcontent");var e=UM.htmlparser(n.body.innerHTML);n.filterOutputRule(e),e.traversal(function(e){if("element"==e.type)switch(e.tagName){case"td":case"th":case"caption":e.children&&1==e.children.length&&"br"==e.firstChild().tagName&&e.removeChild(e.firstChild());break;case"pre":e.innerText(e.innerText().replace(/&nbsp;/g," "))}}),n.fireEvent("aftergetcontent");var o=e.toHtml(!0);i=t(n.body.parentNode),i.setContent(o);var l=function(e){return parseInt($(n.body).css(e))};$(i.container).width($(n.body).width()+l("padding-left")+l("padding-right")).height($(n.body).height()),setTimeout(function(){i.select()}),n.getContent=function(){return i.getContent()||"<p>"+(browser.ie?"":"<br/>")+"</p>"}}else{n.$body.css({position:"",left:"",top:""});var d=i.getContent()||"<p>"+(browser.ie?"":"<br/>")+"</p>";d=d.replace(new RegExp("[\\r\\t\\n ]*</?(\\w+)\\s*(?:[^>]*)>","g"),function(e,t){return t&&!dtd.$inlineWithA[t.toLowerCase()]?e.replace(/(^[\n\r\t ]*)|([\n\r\t ]*$)/g,""):e.replace(/(^[\n\r\t]*)|([\n\r\t]*$)/g,"")}),n.setContent(d),i.dispose(),i=null,n.getContent=s;var c=n.body.firstChild;c||(n.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>"),n.undoManger&&n.undoManger.save(!0),browser.gecko&&(n.body.contentEditable=!0);try{n.selection.getRange().moveToAddress(r).select()}catch(u){}}this.fireEvent("sourcemodechanged",a)},queryCommandState:function(){return 0|a},notNeedUndo:1};var l=n.queryCommandState;n.queryCommandState=function(e){return e=e.toLowerCase(),a?e in{source:1,fullscreen:1}?l.apply(this,arguments):-1:l.apply(this,arguments)}}}(),UM.plugins.enterkey=function(){var e,t=this,i=t.options.enterTag;t.addListener("keyup",function(i,n){var o=n.keyCode||n.which;if(13==o){var a,r=t.selection.getRange(),s=r.startContainer;if(browser.ie)t.fireEvent("saveScene",!0,!0);else{if(/h\d/i.test(e)){if(browser.gecko){var l=domUtils.findParentByTagName(s,["h1","h2","h3","h4","h5","h6","blockquote","caption","table"],!0);l||(t.document.execCommand("formatBlock",!1,"<p>"),a=1)}else if(1==s.nodeType){var d,c=t.document.createTextNode("");if(r.insertNode(c),d=domUtils.findParentByTagName(c,"div",!0)){for(var u=t.document.createElement("p");d.firstChild;)u.appendChild(d.firstChild);d.parentNode.insertBefore(u,d),domUtils.remove(d),r.setStartBefore(c).setCursor(),a=1}domUtils.remove(c)}t.undoManger&&a&&t.undoManger.save()}browser.opera&&r.select()}}}),t.addListener("keydown",function(n,o){var a=o.keyCode||o.which;if(13==a){if(t.fireEvent("beforeenterkeydown"))return void domUtils.preventDefault(o);t.fireEvent("saveScene",!0,!0),e="";var r=t.selection.getRange();if(!r.collapsed){var s=r.startContainer,l=r.endContainer,d=domUtils.findParentByTagName(s,"td",!0),c=domUtils.findParentByTagName(l,"td",!0);if(d&&c&&d!==c||!d&&c||d&&!c)return void(o.preventDefault?o.preventDefault():o.returnValue=!1)}"p"==i&&(browser.ie||(s=domUtils.findParentByTagName(r.startContainer,["ol","ul","p","h1","h2","h3","h4","h5","h6","blockquote","caption"],!0),s||browser.opera?(e=s.tagName,"p"==s.tagName.toLowerCase()&&browser.gecko&&domUtils.removeDirtyAttr(s)):(t.document.execCommand("formatBlock",!1,"<p>"),browser.gecko&&(r=t.selection.getRange(),s=domUtils.findParentByTagName(r.startContainer,"p",!0),s&&domUtils.removeDirtyAttr(s)))))}}),browser.ie&&t.addListener("setDisabled",function(){$(t.body).find("p").each(function(e,t){domUtils.isEmptyBlock(t)&&(t.innerHTML="&nbsp;")})})},UM.commands.preview={execCommand:function(){var e=window.open("","_blank",""),t=e.document,i=this.getContent(null,null,!0),n=this.getOpt("UMEDITOR_HOME_URL"),o=-1!=i.indexOf("mathquill-embedded-latex")?'<link rel="stylesheet" href="'+n+'third-party/mathquill/mathquill.css"/><script src="'+n+'third-party/jquery.min.js"></script><script src="'+n+'third-party/mathquill/mathquill.min.js"></script>':"";t.open(),t.write("<html><head>"+o+"</head><body><div>"+i+"</div></body></html>"),t.close()},notNeedUndo:1},UM.plugins.basestyle=function(){var e=["bold","underline","superscript","subscript","italic","strikethrough"],t=this;t.addshortcutkey({Bold:"ctrl+66",Italic:"ctrl+73",Underline:"ctrl+shift+85",strikeThrough:"ctrl+shift+83"}),t.addOutputRule(function(e){$.each(e.getNodesByTagName("b i u strike s"),function(e,t){switch(t.tagName){case"b":t.tagName="strong";break;case"i":t.tagName="em";break;case"u":t.tagName="span",t.setStyle("text-decoration","underline");break;case"s":case"strike":t.tagName="span",t.setStyle("text-decoration","line-through")}})}),$.each(e,function(e,i){t.commands[i]={execCommand:function(e){var t=this.selection.getRange();if(t.collapsed&&1!=this.queryCommandState(e)){var i=this.document.createElement({bold:"strong",underline:"u",superscript:"sup",subscript:"sub",italic:"em",strikethrough:"strike"}[e]);return t.insertNode(i).setStart(i,0).setCursor(!1),!0}return this.document.execCommand(e)},queryCommandState:function(e){if(browser.gecko)return this.document.queryCommandState(e);var t=this.selection.getStartElementPath(),i=!1;return $.each(t,function(t,n){switch(e){case"bold":if("STRONG"==n.nodeName||"B"==n.nodeName)return i=1,!1;break;case"underline":if("U"==n.nodeName||"SPAN"==n.nodeName&&"underline"==$(n).css("text-decoration"))return i=1,!1;break;case"superscript":if("SUP"==n.nodeName)return i=1,!1;break;case"subscript":if("SUB"==n.nodeName)return i=1,!1;break;case"italic":if("EM"==n.nodeName||"I"==n.nodeName)return i=1,!1;break;case"strikethrough":if("S"==n.nodeName||"STRIKE"==n.nodeName||"SPAN"==n.nodeName&&"line-through"==$(n).css("text-decoration"))return i=1,!1}}),i}}})},UM.plugins.video=function(){function e(e,t,n,o,a,r){return r?'<embed type="application/x-shockwave-flash" class="edui-faked-video" pluginspage="http://www.macromedia.com/go/getflashplayer" src="'+e+'" width="'+t+'" height="'+n+'"'+(a?' style="float:'+a+'"':"")+' wmode="transparent" play="true" loop="false" menu="false" allowscriptaccess="never" allowfullscreen="true" >':"<img "+(o?'id="'+o+'"':"")+' width="'+t+'" height="'+n+'" _url="'+e+'" class="edui-faked-video" src="'+i.options.UMEDITOR_HOME_URL+'themes/default/images/spacer.gif" style="background:url('+i.options.UMEDITOR_HOME_URL+"themes/default/images/videologo.gif) no-repeat center center; border:1px solid gray;"+(a?"float:"+a+";":"")+'" />'}function t(t,i){utils.each(t.getNodesByTagName(i?"img":"embed"),function(t){if("edui-faked-video"==t.getAttr("class")){var n=e(t.getAttr(i?"_url":"src"),t.getAttr("width"),t.getAttr("height"),null,t.getStyle("float")||"",i);t.parentNode.replaceChild(UM.uNode.createElement(n),t)}})}var i=this;i.addOutputRule(function(e){t(e,!0)}),i.addInputRule(function(e){t(e)}),i.commands.insertvideo={execCommand:function(t,n){n=utils.isArray(n)?n:[n];for(var o,a=[],r="tmpVedio",s=0,l=n.length;l>s;s++)o=n[s],a.push(e(o.url,o.width||420,o.height||280,r+s,o.align,!1));i.execCommand("inserthtml",a.join(""),!0)},queryCommandState:function(){var e=i.selection.getRange().getClosedNode(),t=e&&"edui-faked-video"==e.className;return t?1:0}}},UM.plugins.selectall=function(){var e=this;e.commands.selectall={execCommand:function(){var e=this,t=e.body,i=e.selection.getRange();i.selectNodeContents(t),domUtils.isEmptyBlock(t)&&(browser.opera&&t.firstChild&&1==t.firstChild.nodeType&&i.setStartAtFirst(t.firstChild),i.collapse(!0)),i.select(!0)},notNeedUndo:1},e.addshortcutkey({selectAll:"ctrl+65"})},UM.plugins.removeformat=function(){var e=this;e.setOpt({removeFormatTags:"b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var",removeFormatAttributes:"class,style,lang,width,height,align,hspace,valign"}),e.commands.removeformat={execCommand:function(e,t,i,n,o){function a(e){if(3==e.nodeType||"span"!=e.tagName.toLowerCase())return 0;if(browser.ie){var t=e.attributes;if(t.length){for(var i=0,n=t.length;n>i;i++)if(t[i].specified)return 0;return 1}}return!e.attributes.length}function r(e){var t=e.createBookmark();if(e.collapsed&&e.enlarge(!0),!o){var n=domUtils.findParentByTagName(e.startContainer,"a",!0);n&&e.setStartBefore(n),n=domUtils.findParentByTagName(e.endContainer,"a",!0),n&&e.setEndAfter(n)}for(s=e.createBookmark(),m=s.start;(l=m.parentNode)&&!domUtils.isBlockElm(l);)domUtils.breakParent(m,l),domUtils.clearEmptySibling(m);if(s.end){for(m=s.end;(l=m.parentNode)&&!domUtils.isBlockElm(l);)domUtils.breakParent(m,l),domUtils.clearEmptySibling(m);for(var r,u=domUtils.getNextDomNode(s.start,!1,h);u&&u!=s.end;)r=domUtils.getNextDomNode(u,!0,h),dtd.$empty[u.tagName.toLowerCase()]||domUtils.isBookmarkNode(u)||(d.test(u.tagName)?i?(domUtils.removeStyle(u,i),a(u)&&"text-decoration"!=i&&domUtils.remove(u,!0)):domUtils.remove(u,!0):dtd.$tableContent[u.tagName]||dtd.$list[u.tagName]||(domUtils.removeAttributes(u,c),a(u)&&domUtils.remove(u,!0))),u=r}var f=s.start.parentNode;!domUtils.isBlockElm(f)||dtd.$tableContent[f.tagName]||dtd.$list[f.tagName]||domUtils.removeAttributes(f,c),f=s.end.parentNode,s.end&&domUtils.isBlockElm(f)&&!dtd.$tableContent[f.tagName]&&!dtd.$list[f.tagName]&&domUtils.removeAttributes(f,c),e.moveToBookmark(s).moveToBookmark(t);for(var p,m=e.startContainer,g=e.collapsed;1==m.nodeType&&domUtils.isEmptyNode(m)&&dtd.$removeEmpty[m.tagName];)p=m.parentNode,e.setStartBefore(m),e.startContainer===e.endContainer&&e.endOffset--,domUtils.remove(m),m=p;if(!g)for(m=e.endContainer;1==m.nodeType&&domUtils.isEmptyNode(m)&&dtd.$removeEmpty[m.tagName];)p=m.parentNode,e.setEndBefore(m),domUtils.remove(m),m=p}var s,l,d=new RegExp("^(?:"+(t||this.options.removeFormatTags).replace(/,/g,"|")+")$","i"),c=i?[]:(n||this.options.removeFormatAttributes).split(","),u=new dom.Range(this.document),h=function(e){return 1==e.nodeType};u=this.selection.getRange(),u.collapsed||(r(u),u.select())}}},UM.plugins.keystrokes=function(){var e=this,t=!0;e.addListener("keydown",function(i,n){var o=n.keyCode||n.which,a=e.selection.getRange();if(!a.collapsed&&!(n.ctrlKey||n.shiftKey||n.altKey||n.metaKey)&&(o>=65&&90>=o||o>=48&&57>=o||o>=96&&111>=o||{13:1,8:1,46:1}[o])){var r=a.startContainer;if(domUtils.isFillChar(r)&&a.setStartBefore(r),r=a.endContainer,domUtils.isFillChar(r)&&a.setEndAfter(r),a.txtToElmBoundary(),a.endContainer&&1==a.endContainer.nodeType&&(r=a.endContainer.childNodes[a.endOffset],r&&domUtils.isBr(r)&&a.setEndAfter(r)),0==a.startOffset&&(r=a.startContainer,domUtils.isBoundaryNode(r,"firstChild")&&(r=a.endContainer,a.endOffset==(3==r.nodeType?r.nodeValue.length:r.childNodes.length)&&domUtils.isBoundaryNode(r,"lastChild"))))return e.fireEvent("saveScene"),e.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>",a.setStart(e.body.firstChild,0).setCursor(!1,!0),void e._selectionChange()}if(8==o){if(a=e.selection.getRange(),t=a.collapsed,e.fireEvent("delkeydown",n))return;var s,l;if(a.collapsed&&a.inFillChar()&&(s=a.startContainer,domUtils.isFillChar(s)?(a.setStartBefore(s).shrinkBoundary(!0).collapse(!0),domUtils.remove(s)):(s.nodeValue=s.nodeValue.replace(new RegExp("^"+domUtils.fillChar),""),a.startOffset--,a.collapse(!0).select(!0))),s=a.getClosedNode())return e.fireEvent("saveScene"),a.setStartBefore(s),domUtils.remove(s),a.setCursor(),e.fireEvent("saveScene"),void domUtils.preventDefault(n);if(!browser.ie&&(s=domUtils.findParentByTagName(a.startContainer,"table",!0),l=domUtils.findParentByTagName(a.endContainer,"table",!0),s&&!l||!s&&l||s!==l))return void n.preventDefault();

if(s=a.startContainer,a.collapsed&&1==s.nodeType){var d=s.childNodes[a.startOffset-1];d&&1==d.nodeType&&"BR"==d.tagName&&(e.fireEvent("saveScene"),a.setStartBefore(d).collapse(!0),domUtils.remove(d),a.select(),e.fireEvent("saveScene"))}if(browser.chrome&&a.collapsed){for(;0==a.startOffset&&!domUtils.isEmptyBlock(a.startContainer);)a.setStartBefore(a.startContainer);var c=a.startContainer.childNodes[a.startOffset-1];c&&"BR"==c.nodeName&&(a.setStartBefore(c),e.fireEvent("saveScene"),$(c).remove(),a.setCursor(),e.fireEvent("saveScene"))}}if(browser.gecko&&46==o){var u=e.selection.getRange();if(u.collapsed&&(s=u.startContainer,domUtils.isEmptyBlock(s))){for(var h=s.parentNode;1==domUtils.getChildCount(h)&&!domUtils.isBody(h);)s=h,h=h.parentNode;return void(s===h.lastChild&&n.preventDefault())}}}),e.addListener("keyup",function(e,i){var n,o=i.keyCode||i.which,a=this;if(8==o){if(a.fireEvent("delkeyup"))return;if(n=a.selection.getRange(),n.collapsed){var r,s=["h1","h2","h3","h4","h5","h6"];if((r=domUtils.findParentByTagName(n.startContainer,s,!0))&&domUtils.isEmptyBlock(r)){var l=r.previousSibling;if(l&&"TABLE"!=l.nodeName)return domUtils.remove(r),void n.setStartAtLast(l).setCursor(!1,!0);var d=r.nextSibling;if(d&&"TABLE"!=d.nodeName)return domUtils.remove(r),void n.setStartAtFirst(d).setCursor(!1,!0)}if(domUtils.isBody(n.startContainer)){var r=domUtils.createElement(a.document,"p",{innerHTML:browser.ie?domUtils.fillChar:"<br/>"});n.insertNode(r).setStart(r,0).setCursor(!1,!0)}}if(!t&&(3==n.startContainer.nodeType||1==n.startContainer.nodeType&&domUtils.isEmptyBlock(n.startContainer)))if(browser.ie){var c=n.document.createElement("span");n.insertNode(c).setStartBefore(c).collapse(!0),n.select(),domUtils.remove(c)}else n.select()}})},UM.plugins.autosave=function(){function e(e){var r=null;if(!(new Date-i<n)){if(!e.hasContents())return void(o&&a.removeItem(o));i=new Date,e._saveFlag=null,r=t.body.innerHTML,e.fireEvent("beforeautosave",{content:r})!==!1&&(a.saveLocalData(o,r),e.fireEvent("afterautosave",{content:r}))}}var t=this,i=new Date,n=20,o=null;t.setOpt("saveInterval",500);var a=UM.LocalStorage=function(){function e(){var e=document.createElement("div");return e.style.display="none",e.addBehavior?(e.addBehavior("#default#userdata"),{getItem:function(t){var n=null;try{document.body.appendChild(e),e.load(i),n=e.getAttribute(t),document.body.removeChild(e)}catch(o){}return n},setItem:function(t,n){document.body.appendChild(e),e.setAttribute(t,n),e.save(i),document.body.removeChild(e)},removeItem:function(t){document.body.appendChild(e),e.removeAttribute(t),e.save(i),document.body.removeChild(e)}}):null}var t=window.localStorage||e()||null,i="localStorage";return{saveLocalData:function(e,i){return t&&i?(t.setItem(e,i),!0):!1},getLocalData:function(e){return t?t.getItem(e):null},removeItem:function(e){t&&t.removeItem(e)}}}();t.addListener("ready",function(){var e="-drafts-data",i=null;i=t.key?t.key+e:(t.container.parentNode.id||"ue-common")+e,o=(location.protocol+location.host+location.pathname).replace(/[.:\/]/g,"_")+i}),t.addListener("contentchange",function(){o&&(t._saveFlag&&window.clearTimeout(t._saveFlag),t.options.saveInterval>0?t._saveFlag=window.setTimeout(function(){e(t)},t.options.saveInterval):e(t))}),t.commands.clearlocaldata={execCommand:function(e,t){o&&a.getLocalData(o)&&a.removeItem(o)},notNeedUndo:!0,ignoreContentChange:!0},t.commands.getlocaldata={execCommand:function(e,t){return o?a.getLocalData(o)||"":""},notNeedUndo:!0,ignoreContentChange:!0},t.commands.drafts={execCommand:function(e,i){o&&(t.body.innerHTML=a.getLocalData(o)||"<p>"+(browser.ie?"&nbsp;":"<br/>")+"</p>",t.focus(!0))},queryCommandState:function(){return o?null===a.getLocalData(o)?-1:0:-1},notNeedUndo:!0,ignoreContentChange:!0}},UM.plugins.autoupload=function(){function getPasteImage(e){return e.clipboardData&&e.clipboardData.items&&1==e.clipboardData.items.length&&/^image\//.test(e.clipboardData.items[0].type)?e.clipboardData.items:null}function getDropImage(e){return e.dataTransfer&&e.dataTransfer.files?e.dataTransfer.files:null}var me=this;me.setOpt("pasteImageEnabled",!0),me.setOpt("dropFileEnabled",!0);var sendAndInsertImage=function(file,editor){var fd=new FormData;fd.append(editor.options.imageFieldName||"upfile",file,file.name||"blob."+file.type.substr("image/".length)),fd.append("type","ajax");var xhr=new XMLHttpRequest;xhr.open("post",me.options.imageUrl,!0),xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),xhr.addEventListener("load",function(e){try{var json=eval("("+e.target.response+")"),link=json.url,picLink=me.options.imagePath+link;editor.execCommand("insertimage",{src:picLink,_src:picLink})}catch(er){}}),xhr.send(fd)};me.addListener("ready",function(){if(window.FormData&&window.FileReader){var e=function(e){var t,i=!1;if(t="paste"==e.type?getPasteImage(e.originalEvent):getDropImage(e.originalEvent)){for(var n,o=t.length;o--;)n=t[o],n.getAsFile&&(n=n.getAsFile()),n&&n.size>0&&/image\/\w+/i.test(n.type)&&(sendAndInsertImage(n,me),i=!0);if(i)return!1}};me.getOpt("pasteImageEnabled")&&me.$body.on("paste",e),me.getOpt("dropFileEnabled")&&me.$body.on("drop",e),me.$body.on("dragover",function(e){return"Files"==e.originalEvent.dataTransfer.types[0]?!1:void 0})}})},UM.plugins.formula=function(){function e(){return i.$body.find("iframe.edui-formula-active")[0]||null}function t(){var t=e();t&&t.contentWindow.formula.blur()}var i=this;i.addInputRule(function(e){$.each(e.getNodesByTagName("span"),function(e,t){if(t.hasClass("mathquill-embedded-latex")){for(var n,o="";n=t.firstChild();)o+=n.data,t.removeChild(n);t.tagName="iframe",t.setAttr({frameborder:"0",src:i.getOpt("UMEDITOR_HOME_URL")+"dialogs/formula/formula.html","data-latex":utils.unhtml(o)})}})}),i.addOutputRule(function(e){$.each(e.getNodesByTagName("iframe"),function(e,t){t.hasClass("mathquill-embedded-latex")&&(t.tagName="span",t.appendChild(UM.uNode.createText(t.getAttr("data-latex"))),t.setAttr({frameborder:"",src:"","data-latex":""}))})}),i.addListener("click",function(){t()}),i.addListener("afterexeccommand",function(e,i){"formula"!=i&&t()}),i.commands.formula={execCommand:function(t,n){var o=e();o?o.contentWindow.formula.insertLatex(n):(i.execCommand("inserthtml",'<span class="mathquill-embedded-latex">'+n+"</span>"),browser.ie&&browser.ie9below&&setTimeout(function(){var e=i.selection.getRange(),t=e.startContainer;1!=t.nodeType||t.childNodes[e.startOffset]||(e.insertNode(i.document.createTextNode(" ")),e.setCursor())},100))},queryCommandState:function(e){return 0},queryCommandValue:function(t){var i=e();return i&&i.contentWindow.formula.getLatex()}}},function(e){function t(t,i,n){if(t.prototype=e.extend2(e.extend({},i),(UM.ui[n]||o).prototype,!0),t.prototype.supper=(UM.ui[n]||o).prototype,UM.ui[n]&&UM.ui[n].prototype.defaultOpt){var a=UM.ui[n].prototype.defaultOpt,r=t.prototype.defaultOpt;t.prototype.defaultOpt=e.extend({},a,r||{})}return t}function i(t,i){e[a+i]=t,e.fn[a+i]=function(i){var n,o=Array.prototype.slice.call(arguments,1);return this.each(function(a,r){var s=e(r),l=s.edui();if(l||(t(i&&e.isPlainObject(i)?i:{},s),s.edui(l)),"string"==e.type(i))if("this"==i)n=l;else{if(n=l[i].apply(l,o),n!==l&&void 0!==n)return!1;n=null}}),null!==n?n:this}}e.parseTmpl=function(e,t){var i="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+e.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/<%=([\s\S]+?)%>/g,function(e,t){return"',"+t.replace(/\\'/g,"'")+",'"}).replace(/<%([\s\S]+?)%>/g,function(e,t){return"');"+t.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+"__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",n=new Function("obj",i);return t?n(t):n},e.extend2=function(t,i){for(var n=arguments,o="boolean"==e.type(n[n.length-1])?n[n.length-1]:!1,a="boolean"==e.type(n[n.length-1])?n.length-1:n.length,r=1;a>r;r++){var s=n[r];for(var l in s)o&&t.hasOwnProperty(l)||(t[l]=s[l])}return t},e.IE6=!!window.ActiveXObject&&6==parseFloat(navigator.userAgent.match(/msie (\d+)/i)[1]);var n=[],o=function(){},a="edui";o.prototype={on:function(t,i){return this.root().on(t,e.proxy(i,this)),this},off:function(t,i){return this.root().off(t,e.proxy(i,this)),this},trigger:function(e,t){return this.root().trigger(e,t)===!1?!1:this},root:function(e){return this._$el||(this._$el=e)},destroy:function(){},data:function(e,t){return void 0!==t?(this.root().data(a+e,t),this):this.root().data(a+e)},register:function(t,i,o){n.push({evtname:t,$els:e.isArray(i)?i:[i],handler:e.proxy(o,i)})}},e.fn.edui=function(e){return e?this.data("eduiwidget",e):this.data("eduiwidget")};var r=1;UM.ui={define:function(n,o,s){var l=UM.ui[n]=t(function(t,i){var o=function(){};e.extend(o.prototype,l.prototype,{guid:n+r++,widgetName:n});var s=new o;if("string"==e.type(t))return s.init&&s.init({}),s.root().edui(s),s.root().find("a").click(function(e){e.preventDefault()}),s.root()[a+n].apply(s.root(),arguments);i&&s.root(i),s.init&&s.init(!t||e.isPlainObject(t)?e.extend2(t||{},s.defaultOpt||{},!0):t);try{s.root().find("a").click(function(e){e.preventDefault()})}catch(d){}return s.root().edui(s)},o,s);i(l,n)}},e(function(){e(document).on("click mouseup mousedown dblclick mouseover",function(t){e.each(n,function(i,n){n.evtname==t.type&&e.each(n.$els,function(i,o){o[0]===t.target||e.contains(o[0],t.target)||n.handler(t)})})})})}(jQuery),UM.ui.define("button",{tpl:'<<%if(!texttype){%>div class="edui-btn edui-btn-<%=icon%> <%if(name){%>edui-btn-name-<%=name%><%}%>" unselectable="on" onmousedown="return false" <%}else{%>a class="edui-text-btn"<%}%><% if(title) {%> data-original-title="<%=title%>" <%};%>> <% if(icon) {%><div unselectable="on" class="edui-icon-<%=icon%> edui-icon"></div><% }; %><%if(text) {%><span unselectable="on" onmousedown="return false" class="edui-button-label"><%=text%></span><%}%><%if(caret && text){%><span class="edui-button-spacing"></span><%}%><% if(caret) {%><span unselectable="on" onmousedown="return false" class="edui-caret"></span><% };%></<%if(!texttype){%>div<%}else{%>a<%}%>>',defaultOpt:{text:"",title:"",icon:"",width:"",caret:!1,texttype:!1,click:function(){}},init:function(e){var t=this;return t.root($($.parseTmpl(t.tpl,e))).click(function(i){t.wrapclick(e.click,i)}),t.root().hover(function(){t.root().hasClass("edui-disabled")||t.root().toggleClass("edui-hover")}),t},wrapclick:function(e,t){return this.disabled()||(this.root().trigger("wrapclick"),$.proxy(e,this,t)()),this},label:function(e){return void 0===e?this.root().find(".edui-button-label").text():(this.root().find(".edui-button-label").text(e),this)},disabled:function(e){return void 0===e?this.root().hasClass("edui-disabled"):(this.root().toggleClass("edui-disabled",e),this.root().hasClass("edui-disabled")&&this.root().removeClass("edui-hover"),this)},active:function(e){return void 0===e?this.root().hasClass("edui-active"):(this.root().toggleClass("edui-active",e),this)},mergeWith:function(e){var t=this;t.data("$mergeObj",e),e.edui().data("$mergeObj",t.root()),$.contains(document.body,e[0])||e.appendTo(t.root()),t.on("click",function(){t.wrapclick(function(){e.edui().show()})}).register("click",t.root(),function(t){e.hide()})}}),function(){UM.ui.define("toolbar",{tpl:'<div class="edui-toolbar"  ><div class="edui-btn-toolbar" unselectable="on" onmousedown="return false"  ></div></div>',init:function(){var e=this.root($(this.tpl));this.data("$btnToolbar",e.find(".edui-btn-toolbar"))},appendToBtnmenu:function(e){var t=this.data("$btnToolbar");e=$.isArray(e)?e:[e],$.each(e,function(e,i){t.append(i)})}})}(),UM.ui.define("menu",{show:function(e,t,i,n,o){i=i||"position",this.trigger("beforeshow")!==!1&&(this.root().css($.extend({display:"block"},e?{top:e[i]().top+("right"==t?0:e.outerHeight())-(n||0),left:e[i]().left+("right"==t?e.outerWidth():0)-(o||0)}:{})),this.trigger("aftershow"))},hide:function(e){var t;this.trigger("beforehide")!==!1&&((t=this.root().data("parentmenu"))&&(t.data("parentmenu")||e)&&t.edui().hide(),this.root().css("display","none"),this.trigger("afterhide"))},attachTo:function(e){var t=this;e.data("$mergeObj")||(e.data("$mergeObj",t.root()),e.on("wrapclick",function(e){t.show()}),t.register("click",e,function(e){t.hide()}),t.data("$mergeObj",e))}}),UM.ui.define("dropmenu",{tmpl:'<ul class="edui-dropdown-menu" aria-labelledby="dropdownMenu" ><%for(var i=0,ci;ci=data[i++];){%><%if(ci.divider){%><li class="edui-divider"></li><%}else{%><li <%if(ci.active||ci.disabled){%>class="<%= ci.active|| \'\' %> <%=ci.disabled||\'\' %>" <%}%> data-value="<%= ci.value%>"><a href="#" tabindex="-1"><em class="edui-dropmenu-checkbox"><i class="edui-icon-ok"></i></em><%= ci.label%></a></li><%}%><%}%></ul>',defaultOpt:{data:[],click:function(){}},init:function(e){var t=this,i={click:1,mouseover:1,mouseout:1};this.root($($.parseTmpl(this.tmpl,e))).on("click",'li[class!="edui-disabled edui-divider edui-dropdown-submenu"]',function(i){$.proxy(e.click,t,i,$(this).data("value"),$(this))()}).find("li").each(function(n,o){var a=$(this);if(!a.hasClass("edui-disabled edui-divider edui-dropdown-submenu")){var r=e.data[n];$.each(i,function(e){r[e]&&a[e](function(i){$.proxy(r[e],o)(i,r,t.root)})})}})},disabled:function(e){$("li[class!=edui-divider]",this.root()).each(function(){var t=$(this);e===!0?t.addClass("edui-disabled"):$.isFunction(e)?t.toggleClass("edui-disabled",e(li)):t.removeClass("edui-disabled")})},val:function(e){var t;return $('li[class!="edui-divider edui-disabled edui-dropdown-submenu"]',this.root()).each(function(){var i=$(this);if(void 0===e){if(i.find("em.edui-dropmenu-checked").length)return t=i.data("value"),!1}else i.find("em").toggleClass("edui-dropmenu-checked",i.data("value")==e)}),void 0===e?t:void 0},addSubmenu:function(e,t,i){i=i||0;var n=$("li[class!=edui-divider]",this.root()),o=$('<li class="edui-dropdown-submenu"><a tabindex="-1" href="#">'+e+"</a></li>").append(t);i>=0&&i<n.length?o.insertBefore(n[i]):0>i?o.insertBefore(n[0]):i>=n.length&&o.appendTo(n)}},"menu"),UM.ui.define("splitbutton",{tpl:'<div class="edui-splitbutton <%if (name){%>edui-splitbutton-<%= name %><%}%>"  unselectable="on" <%if(title){%>data-original-title="<%=title%>"<%}%>><div class="edui-btn"  unselectable="on" ><%if(icon){%><div  unselectable="on" class="edui-icon-<%=icon%> edui-icon"></div><%}%><%if(text){%><%=text%><%}%></div><div  unselectable="on" class="edui-btn edui-dropdown-toggle" ><div  unselectable="on" class="edui-caret"></div></div></div>',defaultOpt:{text:"",title:"",click:function(){}},init:function(e){var t=this;return t.root($($.parseTmpl(t.tpl,e))),t.root().find(".edui-btn:first").click(function(i){t.disabled()||$.proxy(e.click,t)()}),t.root().find(".edui-dropdown-toggle").click(function(){t.disabled()||t.trigger("arrowclick")}),t.root().hover(function(){t.root().hasClass("edui-disabled")||t.root().toggleClass("edui-hover")}),t},wrapclick:function(e,t){return this.disabled()||$.proxy(e,this,t)(),this},disabled:function(e){return void 0===e?this.root().hasClass("edui-disabled"):(this.root().toggleClass("edui-disabled",e).find(".edui-btn").toggleClass("edui-disabled",e),this)},active:function(e){return void 0===e?this.root().hasClass("edui-active"):(this.root().toggleClass("edui-active",e).find(".edui-btn:first").toggleClass("edui-active",e),this)},mergeWith:function(e){var t=this;t.data("$mergeObj",e),e.edui().data("$mergeObj",t.root()),$.contains(document.body,e[0])||e.appendTo(t.root()),t.root().delegate(".edui-dropdown-toggle","click",function(){t.wrapclick(function(){e.edui().show()})}),t.register("click",t.root().find(".edui-dropdown-toggle"),function(t){e.hide()})}}),UM.ui.define("colorsplitbutton",{tpl:'<div class="edui-splitbutton <%if (name){%>edui-splitbutton-<%= name %><%}%>"  unselectable="on" <%if(title){%>data-original-title="<%=title%>"<%}%>><div class="edui-btn"  unselectable="on" ><%if(icon){%><div  unselectable="on" class="edui-icon-<%=icon%> edui-icon"></div><%}%><div class="edui-splitbutton-color-label" <%if (color) {%>style="background: <%=color%>"<%}%>></div><%if(text){%><%=text%><%}%></div><div  unselectable="on" class="edui-btn edui-dropdown-toggle" ><div  unselectable="on" class="edui-caret"></div></div></div>',defaultOpt:{color:""},init:function(e){var t=this;t.supper.init.call(t,e)},colorLabel:function(){return this.root().find(".edui-splitbutton-color-label")}},"splitbutton"),UM.ui.define("popup",{tpl:'<div class="edui-dropdown-menu edui-popup"<%if(!<%=stopprop%>){%>onmousedown="return false"<%}%>><div class="edui-popup-body" unselectable="on" onmousedown="return false"><%=subtpl%></div><div class="edui-popup-caret"></div></div>',defaultOpt:{stopprop:!1,subtpl:"",width:"",height:""},init:function(e){return this.root($($.parseTmpl(this.tpl,e))),this},mergeTpl:function(e){return $.parseTmpl(this.tpl,{subtpl:e})},show:function(e,t){t||(t={});var i=t.fnname||"position";this.trigger("beforeshow")!==!1&&(this.root().css($.extend({display:"block"},e?{top:e[i]().top+("right"==t.dir?0:e.outerHeight())-(t.offsetTop||0),left:e[i]().left+("right"==t.dir?e.outerWidth():0)-(t.offsetLeft||0),position:"absolute"}:{})),this.root().find(".edui-popup-caret").css({top:t.caretTop||0,left:t.caretLeft||0,position:"absolute"}).addClass(t.caretDir||"up"),this.trigger("aftershow"))},hide:function(){this.root().css("display","none"),this.trigger("afterhide")},attachTo:function(e,t){var i=this;e.data("$mergeObj")||(e.data("$mergeObj",i.root()),e.on("wrapclick",function(n){i.show(e,t)}),i.register("click",e,function(e){i.hide()}),i.data("$mergeObj",e))},getBodyContainer:function(){return this.root().find(".edui-popup-body")}}),UM.ui.define("scale",{tpl:'<div class="edui-scale" unselectable="on"><span class="edui-scale-hand0"></span><span class="edui-scale-hand1"></span><span class="edui-scale-hand2"></span><span class="edui-scale-hand3"></span><span class="edui-scale-hand4"></span><span class="edui-scale-hand5"></span><span class="edui-scale-hand6"></span><span class="edui-scale-hand7"></span></div>',defaultOpt:{$doc:$(document),$wrap:$(document)},init:function(e){return e.$doc&&(this.defaultOpt.$doc=e.$doc),e.$wrap&&(this.defaultOpt.$wrap=e.$wrap),this.root($($.parseTmpl(this.tpl,e))),this.initStyle(),this.startPos=this.prePos={x:0,y:0},this.dragId=-1,this},initStyle:function(){utils.cssRule("edui-style-scale",".edui-scale{display:none;position:absolute;border:1px solid #38B2CE;cursor:hand;}.edui-scale span{position:absolute;left:0;top:0;width:7px;height:7px;overflow:hidden;font-size:0px;display:block;background-color:#3C9DD0;}.edui-scale .edui-scale-hand0{cursor:nw-resize;top:0;margin-top:-4px;left:0;margin-left:-4px;}.edui-scale .edui-scale-hand1{cursor:n-resize;top:0;margin-top:-4px;left:50%;margin-left:-4px;}.edui-scale .edui-scale-hand2{cursor:ne-resize;top:0;margin-top:-4px;left:100%;margin-left:-3px;}.edui-scale .edui-scale-hand3{cursor:w-resize;top:50%;margin-top:-4px;left:0;margin-left:-4px;}.edui-scale .edui-scale-hand4{cursor:e-resize;top:50%;margin-top:-4px;left:100%;margin-left:-3px;}.edui-scale .edui-scale-hand5{cursor:sw-resize;top:100%;margin-top:-3px;left:0;margin-left:-4px;}.edui-scale .edui-scale-hand6{cursor:s-resize;top:100%;margin-top:-3px;left:50%;margin-left:-4px;}.edui-scale .edui-scale-hand7{cursor:se-resize;top:100%;margin-top:-3px;left:100%;margin-left:-3px;}")},_eventHandler:function(e){var t=this,i=t.defaultOpt.$doc;switch(e.type){case"mousedown":var n,n=e.target||e.srcElement;-1!=n.className.indexOf("edui-scale-hand")&&(t.dragId=n.className.slice(-1),t.startPos.x=t.prePos.x=e.clientX,t.startPos.y=t.prePos.y=e.clientY,i.bind("mousemove",$.proxy(t._eventHandler,t)));break;case"mousemove":-1!=t.dragId&&(t.updateContainerStyle(t.dragId,{x:e.clientX-t.prePos.x,y:e.clientY-t.prePos.y}),t.prePos.x=e.clientX,t.prePos.y=e.clientY,t.updateTargetElement());break;case"mouseup":if(-1!=t.dragId){t.dragId=-1,t.updateTargetElement();var o=t.data("$scaleTarget");o.parent()&&t.attachTo(t.data("$scaleTarget"))}i.unbind("mousemove",$.proxy(t._eventHandler,t))}},updateTargetElement:function(){var e=this,t=e.root(),i=e.data("$scaleTarget");i.css({width:t.width(),height:t.height()}),e.attachTo(i)},updateContainerStyle:function(e,t){var i,n=this,o=n.root(),a=[[0,0,-1,-1],[0,0,0,-1],[0,0,1,-1],[0,0,-1,0],[0,0,1,0],[0,0,-1,1],[0,0,0,1],[0,0,1,1]];0!=a[e][0]&&(i=parseInt(o.offset().left)+t.x,o.css("left",n._validScaledProp("left",i))),0!=a[e][1]&&(i=parseInt(o.offset().top)+t.y,o.css("top",n._validScaledProp("top",i))),0!=a[e][2]&&(i=o.width()+a[e][2]*t.x,o.css("width",n._validScaledProp("width",i))),0!=a[e][3]&&(i=o.height()+a[e][3]*t.y,o.css("height",n._validScaledProp("height",i)))},_validScaledProp:function(e,t){var i=this.root(),n=this.defaultOpt.$doc,o=function(e,i,n){return e+i>n?n-i:t};switch(t=isNaN(t)?0:t,e){case"left":return 0>t?0:o(t,i.width(),n.width());case"top":return 0>t?0:o(t,i.height(),n.height());case"width":return 0>=t?1:o(t,i.offset().left,n.width());case"height":return 0>=t?1:o(t,i.offset().top,n.height())}},show:function(e){var t=this;e&&t.attachTo(e),t.root().bind("mousedown",$.proxy(t._eventHandler,t)),t.defaultOpt.$doc.bind("mouseup",$.proxy(t._eventHandler,t)),t.root().show(),t.trigger("aftershow")},hide:function(){var e=this;e.root().unbind("mousedown",$.proxy(e._eventHandler,e)),e.defaultOpt.$doc.unbind("mouseup",$.proxy(e._eventHandler,e)),e.root().hide(),e.trigger("afterhide")},attachTo:function(e){var t=this,i=e.offset(),n=t.root(),o=t.defaultOpt.$wrap,a=o.offset();t.data("$scaleTarget",e),t.root().css({position:"absolute",width:e.width(),height:e.height(),left:i.left-a.left-parseInt(o.css("border-left-width"))-parseInt(n.css("border-left-width")),top:i.top-a.top-parseInt(o.css("border-top-width"))-parseInt(n.css("border-top-width"))})},getScaleTarget:function(){return this.data("$scaleTarget")[0]}}),UM.ui.define("colorpicker",{tpl:function(e){for(var t="ffffff,000000,eeece1,1f497d,4f81bd,c0504d,9bbb59,8064a2,4bacc6,f79646,f2f2f2,7f7f7f,ddd9c3,c6d9f0,dbe5f1,f2dcdb,ebf1dd,e5e0ec,dbeef3,fdeada,d8d8d8,595959,c4bd97,8db3e2,b8cce4,e5b9b7,d7e3bc,ccc1d9,b7dde8,fbd5b5,bfbfbf,3f3f3f,938953,548dd4,95b3d7,d99694,c3d69b,b2a2c7,92cddc,fac08f,a5a5a5,262626,494429,17365d,366092,953734,76923c,5f497a,31859b,e36c09,7f7f7f,0c0c0c,1d1b10,0f243e,244061,632423,4f6128,3f3151,205867,974806,c00000,ff0000,ffc000,ffff00,92d050,00b050,00b0f0,0070c0,002060,7030a0,".split(","),i='<div unselectable="on" onmousedown="return false" class="edui-colorpicker<%if (name){%> edui-colorpicker-<%=name%><%}%>" ><table unselectable="on" onmousedown="return false"><tr><td colspan="10">'+e.lang_themeColor+'</td> </tr><tr class="edui-colorpicker-firstrow" >',n=0;n<t.length;n++)n&&n%10===0&&(i+="</tr>"+(60==n?'<tr><td colspan="10">'+e.lang_standardColor+"</td></tr>":"")+"<tr"+(60==n?' class="edui-colorpicker-firstrow"':"")+">"),i+=70>n?'<td><a unselectable="on" onmousedown="return false" title="'+t[n]+'" class="edui-colorpicker-colorcell" data-color="#'+t[n]+'" style="background-color:#'+t[n]+";border:solid #ccc;"+(10>n||n>=60?"border-width:1px;":n>=10&&20>n?"border-width:1px 1px 0 1px;":"border-width:0 1px 0 1px;")+'"></a></td>':"";return i+="</tr></table></div>"},init:function(e){var t=this;t.root($($.parseTmpl(t.supper.mergeTpl(t.tpl(e)),e))),t.root().on("click",function(e){t.trigger("pickcolor",$(e.target).data("color"))})}},"popup"),function(){var e="combobox",t="edui-combobox-item",i="edui-combobox-item-hover",n="edui-combobox-checked-icon",o="edui-combobox-item-label";UM.ui.define(e,function(){return{tpl:'<ul class="dropdown-menu edui-combobox-menu<%if (comboboxName!==\'\') {%> edui-combobox-<%=comboboxName%><%}%>" unselectable="on" onmousedown="return false" role="menu" aria-labelledby="dropdownMenu"><%if(autoRecord) {%><%for( var i=0, len = recordStack.length; i<len; i++ ) {%><%var index = recordStack[i];%><li class="<%=itemClassName%><%if( selected == index ) {%> edui-combobox-checked<%}%>" data-item-index="<%=index%>" unselectable="on" onmousedown="return false"><span class="edui-combobox-icon" unselectable="on" onmousedown="return false"></span><label class="<%=labelClassName%>" style="<%=itemStyles[ index ]%>" unselectable="on" onmousedown="return false"><%=items[index]%></label></li><%}%><%if( i ) {%><li class="edui-combobox-item-separator"></li><%}%><%}%><%for( var i=0, label; label = items[i]; i++ ) {%><li class="<%=itemClassName%><%if( selected == i ) {%> edui-combobox-checked<%}%> edui-combobox-item-<%=i%>" data-item-index="<%=i%>" unselectable="on" onmousedown="return false"><span class="edui-combobox-icon" unselectable="on" onmousedown="return false"></span><label class="<%=labelClassName%>" style="<%=itemStyles[ i ]%>" unselectable="on" onmousedown="return false"><%=label%></label></li><%}%></ul>',defaultOpt:{recordStack:[],items:[],value:[],comboboxName:"",selected:"",autoRecord:!0,recordCount:5},init:function(e){var i=this;$.extend(i._optionAdaptation(e),i._createItemMapping(e.recordStack,e.items),{itemClassName:t,iconClass:n,labelClassName:o}),this._transStack(e),i.root($($.parseTmpl(i.tpl,e))),this.data("options",e).initEvent()},initEvent:function(){var e=this;e.initSelectItem(),this.initItemActive()},initSelectItem:function(){var e=this,i="."+o;e.root().delegate("."+t,"click",function(){var t=$(this),n=t.attr("data-item-index");return e.trigger("comboboxselect",{index:n,label:t.find(i).text(),value:e.data("options").value[n]}).select(n),e.hide(),!1})},initItemActive:function(){var e={mouseenter:"addClass",mouseleave:"removeClass"};$.IE6&&this.root().delegate("."+t,"mouseenter mouseleave",function(t){$(this)[e[t.type]](i)}).one("afterhide",function(){})},select:function(e){var t=this.data("options").itemCount,i=this.data("options").autowidthitem;return i&&!i.length&&(i=this.data("options").items),0==t?null:(0>e?e=t+e%t:e>=t&&(e=t-1),this.trigger("changebefore",i[e]),this._update(e),this.trigger("changeafter",i[e]),null)},selectItemByLabel:function(e){var t=this.data("options").itemMapping,i=this,n=null;!$.isArray(e)&&(e=[e]),$.each(e,function(e,o){return n=t[o],void 0!==n?(i.select(n),!1):void 0})},_transStack:function(e){var t=[],i=-1,n=-1;$.each(e.recordStack,function(o,a){i=e.itemMapping[a],$.isNumeric(i)&&(t.push(i),a==e.selected&&(n=i))}),e.recordStack=t,e.selected=n,t=null},_optionAdaptation:function(e){if(!("itemStyles"in e)){e.itemStyles=[];for(var t=0,i=e.items.length;i>t;t++)e.itemStyles.push("")}return e.autowidthitem=e.autowidthitem||e.items,e.itemCount=e.items.length,e},_createItemMapping:function(e,t){var i={},n={recordStack:[],mapping:{}};return $.each(t,function(e,t){i[t]=e}),n.itemMapping=i,$.each(e,function(e,t){void 0!==i[t]&&(n.recordStack.push(i[t]),n.mapping[t]=i[t])}),n},_update:function(e){var t=this.data("options"),i=[],n=null;$.each(t.recordStack,function(t,n){n!=e&&i.push(n)}),i.unshift(e),i.length>t.recordCount&&(i.length=t.recordCount),t.recordStack=i,t.selected=e,n=$($.parseTmpl(this.tpl,t)),this.root().html(n.html()),n=null,i=null}}}(),"menu")}(),function(){var e="buttoncombobox";UM.ui.define(e,function(){return{defaultOpt:{label:"",title:""},init:function(e){var t=this,i=$.eduibutton({caret:!0,name:e.comboboxName,title:e.title,text:e.label,click:function(){t.show(this.root())}});t.supper.init.call(t,e),t.on("changebefore",function(e,t){i.eduibutton("label",t)}),t.data("button",i),t.attachTo(i)},button:function(){return this.data("button")}}}(),"combobox")}(),UM.ui.define("modal",{tpl:'<div class="edui-modal" tabindex="-1" ><div class="edui-modal-header"><div class="edui-close" data-hide="modal"></div><h3 class="edui-title"><%=title%></h3></div><div class="edui-modal-body"  style="<%if(width){%>width:<%=width%>px;<%}%><%if(height){%>height:<%=height%>px;<%}%>"> </div><% if(cancellabel || oklabel) {%><div class="edui-modal-footer"><div class="edui-modal-tip"></div><%if(oklabel){%><div class="edui-btn edui-btn-primary" data-ok="modal"><%=oklabel%></div><%}%><%if(cancellabel){%><div class="edui-btn" data-hide="modal"><%=cancellabel%></div><%}%></div><%}%></div>',defaultOpt:{title:"",cancellabel:"",oklabel:"",width:"",height:"",backdrop:!0,keyboard:!0},init:function(e){var t=this;t.root($($.parseTmpl(t.tpl,e||{}))),t.data("options",e),e.okFn&&t.on("ok",$.proxy(e.okFn,t)),e.cancelFn&&t.on("beforehide",$.proxy(e.cancelFn,t)),t.root().delegate('[data-hide="modal"]',"click",$.proxy(t.hide,t)).delegate('[data-ok="modal"]',"click",$.proxy(t.ok,t)),$('[data-hide="modal"],[data-ok="modal"]',t.root()).hover(function(){$(this).toggleClass("edui-hover")})},toggle:function(){var e=this;return e[e.data("isShown")?"hide":"show"]()},show:function(){var e=this;e.trigger("beforeshow"),e.data("isShown")||(e.data("isShown",!0),e.escape(),e.backdrop(function(){e.autoCenter(),e.root().show().focus().trigger("aftershow")}))},showTip:function(e){$(".edui-modal-tip",this.root()).html(e).fadeIn()},hideTip:function(e){$(".edui-modal-tip",this.root()).fadeOut(function(){$(this).html("")})},autoCenter:function(){!$.IE6&&this.root().css("margin-left",-(this.root().width()/2))},hide:function(){var e=this;e.trigger("beforehide"),e.data("isShown")&&(e.data("isShown",!1),e.escape(),e.hideModal())},escape:function(){var e=this;e.data("isShown")&&e.data("options").keyboard?e.root().on("keyup",function(t){27==t.which&&e.hide()}):e.data("isShown")||e.root().off("keyup")},hideModal:function(){var e=this;e.root().hide(),e.backdrop(function(){e.removeBackdrop(),e.trigger("afterhide")})},removeBackdrop:function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},backdrop:function(e){var t=this;t.data("isShown")&&t.data("options").backdrop&&(t.$backdrop=$('<div class="edui-modal-backdrop" />').click("static"==t.data("options").backdrop?$.proxy(t.root()[0].focus,t.root()[0]):$.proxy(t.hide,t))),t.trigger("afterbackdrop"),e&&e()},attachTo:function(e){var t=this;e.data("$mergeObj")||(e.data("$mergeObj",t.root()),e.on("click",function(){t.toggle(e)}),t.data("$mergeObj",e))},ok:function(){var e=this;e.trigger("beforeok"),e.trigger("ok",e)!==!1&&e.hide()},getBodyContainer:function(){return this.root().find(".edui-modal-body")}}),UM.ui.define("tooltip",{tpl:'<div class="edui-tooltip" unselectable="on" onmousedown="return false"><div class="edui-tooltip-arrow" unselectable="on" onmousedown="return false"></div><div class="edui-tooltip-inner" unselectable="on" onmousedown="return false"></div></div>',init:function(e){var t=this;t.root($($.parseTmpl(t.tpl,e||{})))},content:function(e){var t=this,i=$(e.currentTarget).attr("data-original-title");t.root().find(".edui-tooltip-inner").text(i)},position:function(e){var t=this,i=$(e.currentTarget);t.root().css($.extend({display:"block"},i?{top:i.outerHeight(),left:(i.outerWidth()-t.root().outerWidth())/2}:{}))},show:function(e){if(!$(e.currentTarget).hasClass("edui-disabled")){var t=this;t.content(e),t.root().appendTo($(e.currentTarget)),t.position(e),t.root().css("display","block")}},hide:function(){var e=this;e.root().css("display","none")},attachTo:function(e){function t(e){var t=this;$.contains(document.body,t.root()[0])||t.root().appendTo(e),t.data("tooltip",t.root()),e.each(function(){$(this).attr("data-original-title")&&$(this).on("mouseenter",$.proxy(t.show,t)).on("mouseleave click",$.proxy(t.hide,t))})}var i=this;"undefined"===$.type(e)?$("[data-original-title]").each(function(e,n){t.call(i,$(n))}):e.data("tooltip")||t.call(i,e)}}),UM.ui.define("tab",{init:function(e){var t=this,i=e.selector;$.type(i)&&(t.root($(i,e.context)),t.data("context",e.context),$(i,t.data("context")).on("click",function(e){t.show(e)}))},show:function(e){var t,i,n,e,o=this,a=$(e.target),r=a.closest("ul");t=a.attr("data-context"),t=t&&t.replace(/.*(?=#[^\s]*$)/,"");var s=a.parent("li");s.length&&!s.hasClass("edui-active")&&(i=r.find(".edui-active:last a")[0],e=$.Event("beforeshow",{target:a[0],relatedTarget:i}),o.trigger(e),e.isDefaultPrevented()||(n=$(t,o.data("context")),o.activate(a.parent("li"),r),o.activate(n,n.parent(),function(){o.trigger({type:"aftershow",relatedTarget:i})})))},
activate:function(e,t,i){if(void 0===e)return $(".edui-tab-item.edui-active",this.root()).index();var n=t.find("> .edui-active");n.removeClass("edui-active"),e.addClass("edui-active"),i&&i()}}),UM.ui.define("separator",{tpl:'<div class="edui-separator" unselectable="on" onmousedown="return false" ></div>',init:function(e){var t=this;return t.root($($.parseTmpl(t.tpl,e))),t}}),function(){var e={},t={},i=[],n=null,o={},a={},r={},s=null;utils.extend(UM,{defaultWidth:500,defaultHeight:500,registerUI:function(t,i){utils.each(t.split(/\s+/),function(t){e[t]=i})},setEditor:function(e){!t[e.id]&&(t[e.id]=e)},registerWidget:function(e,t,i){o[e]=$.extend2(t,{$root:"",_preventDefault:!1,root:function(e){return this.$root||(this.$root=e)},preventDefault:function(){this._preventDefault=!0},clear:!1}),i&&(a[e]=i)},getWidgetData:function(e){return o[e]},setWidgetBody:function(e,t,i){i._widgetData||utils.extend(i,{_widgetData:{},getWidgetData:function(e){return this._widgetData[e]},getWidgetCallback:function(e){var i=this;return function(){return a[e].apply(i,[i,t].concat(Array.prototype.slice.call(arguments,0)))}}});var n=o[e];return n?(n=i._widgetData[e],n||(n=o[e],n=i._widgetData[e]="function"==$.type(n)?n:utils.clone(n)),n.root(t.edui().getBodyContainer()),n.initContent(i,t),n._preventDefault||n.initEvent(i,t),void(n.width&&t.width(n.width))):null},setActiveWidget:function(e){n=e},getEditor:function(e,i){var n=t[e]||(t[e]=this.createEditor(e,i));return s=s?Math.max(n.getOpt("zIndex"),s):n.getOpt("zIndex"),n},setTopEditor:function(e){$.each(t,function(t,i){e==i?e.$container&&e.$container.css("zIndex",s+1):i.$container&&i.$container.css("zIndex",i.getOpt("zIndex"))})},clearCache:function(e){t[e]&&delete t[e]},delEditor:function(e){var i;(i=t[e])&&i.destroy()},ready:function(e){i.push(e)},createEditor:function(e,t){function n(){var t=this.createUI("#"+e,o);o.key=e,o.ready(function(){$.each(i,function(e,t){$.proxy(t,o)()})});var n=o.options;n.minFrameWidth=n.initialFrameWidth?n.initialFrameWidth:n.initialFrameWidth=o.$body.width()||UM.defaultWidth,t.css({width:n.initialFrameWidth,zIndex:o.getOpt("zIndex")}),UM.browser.ie&&6===UM.browser.version&&document.execCommand("BackgroundImageCache",!1,!0),o.render(e),$.eduitooltip&&$.eduitooltip("attachTo",$("[data-original-title]",t)).css("z-index",o.getOpt("zIndex")+1),t.find("a").click(function(e){e.preventDefault()}),o.fireEvent("afteruiready")}var o=new UM.Editor(t),a=this;return o.langIsReady?$.proxy(n,a)():o.addListener("langReady",$.proxy(n,a)),o},createUI:function(t,i){var n=$(t),o=$('<div class="edui-container"><div class="edui-editor-body"></div></div>').insertBefore(n);if(i.$container=o,i.container=o[0],i.$body=n,browser.ie&&browser.ie9above){var a=$('<span style="padding:0;margin:0;height:0;width:0"></span>');a.insertAfter(o)}return $.each(e,function(e,t){var n=t.call(i,e);n&&(r[e]=n)}),o.find(".edui-editor-body").append(n).before(this.createToolbar(i.options,i)),o.find(".edui-toolbar").append($('<div class="edui-dialog-container"></div>')),o},createToolbar:function(e,t){var i=$.eduitoolbar(),n=i.edui();if(e.toolbar&&e.toolbar.length){var o=[];$.each(e.toolbar,function(e,t){$.each(t.split(/\s+/),function(e,t){if("|"==t)$.eduiseparator&&o.push($.eduiseparator());else{var i=r[t];"fullscreen"==t?i&&o.unshift(i):i&&o.push(i)}}),o.length&&n.appendToBtnmenu(o)})}else i.find(".edui-btn-toolbar").remove();return i}})}(),UM.registerUI("bold italic redo undo underline strikethrough superscript subscript insertorderedlist insertunorderedlist cleardoc selectall link unlink print preview justifyleft justifycenter justifyright justifyfull removeformat horizontal drafts",function(e){var t=this,i=$.eduibutton({icon:e,click:function(){t.execCommand(e)},title:this.getLang("labelMap")[e]||""});return this.addListener("selectionchange",function(){var t=this.queryCommandState(e);i.edui().disabled(-1==t).active(1==t)}),i}),function(){function e(e){var t=this;if(!e)throw new Error("invalid params, notfound editor");t.editor=e,r[e.uid]=this,e.addListener("destroy",function(){delete r[e.uid],t.editor=null})}var t={},i=["width","height","position","top","left","margin","padding","overflowX","overflowY"],n={},o={},a={},r={};UM.registerUI("fullscreen",function(t){var i=this,n=$.eduibutton({icon:"fullscreen",title:i.options.labelMap&&i.options.labelMap[t]||i.getLang("labelMap."+t),click:function(){i.execCommand(t),UM.setTopEditor(i)}});return i.addListener("selectionchange",function(){var e=this.queryCommandState(t);n.edui().disabled(-1==e).active(1==e)}),i.addListener("ready",function(){i.options.fullscreen&&e.getInstance(i).toggle()}),n}),UM.commands.fullscreen={execCommand:function(t){e.getInstance(this).toggle()},queryCommandState:function(e){return this._edui_fullscreen_status},notNeedUndo:1},e.prototype={toggle:function(){var e=this.editor,t=this.isFullState();e.fireEvent("beforefullscreenchange",!t),this.update(!t),t?this.revert():this.enlarge(),e.fireEvent("afterfullscreenchange",!t),"true"===e.body.contentEditable&&e.fireEvent("fullscreenchanged",!t),e.fireEvent("selectionchange")},enlarge:function(){this.saveSataus(),this.setDocumentStatus(),this.resize()},revert:function(){var e=this.editor.options,t=/%$/.test(e.initialFrameHeight)?"100%":e.initialFrameHeight-this.getStyleValue("padding-top")-this.getStyleValue("padding-bottom")-this.getStyleValue("border-width");$.IE6&&this.getEditorHolder().style.setExpression("height","this.scrollHeight <= "+t+' ? "'+t+'px" : "auto"'),this.revertContainerStatus(),this.revertContentAreaStatus(),this.revertDocumentStatus()},update:function(e){this.editor._edui_fullscreen_status=e},resize:function(){var e=null,t=0,i=0,n=0,o=0,a=this.editor,r=null,s=null;this.isFullState()&&(e=$(window),i=e.width(),t=e.height(),s=this.getEditorHolder(),n=parseInt(domUtils.getComputedStyle(s,"border-width"),10)||0,n+=parseInt(domUtils.getComputedStyle(a.container,"border-width"),10)||0,o+=parseInt(domUtils.getComputedStyle(s,"padding-left"),10)+parseInt(domUtils.getComputedStyle(s,"padding-right"),10)||0,$.IE6&&s.style.setExpression("height",null),r=this.getBound(),$(a.container).css({width:i+"px",height:t+"px",position:$.IE6?"absolute":"fixed",top:r.top,left:r.left,margin:0,padding:0,overflowX:"hidden",overflowY:"hidden"}),$(s).css({width:i-2*n-o+"px",height:t-2*n-(a.options.withoutToolbar?0:$(".edui-toolbar",a.container).outerHeight())-$(".edui-bottombar",a.container).outerHeight()+"px",overflowX:"hidden",overflowY:"auto"}))},saveSataus:function(){for(var e=this.editor.container.style,n=null,o={},a=0,r=i.length;r>a;a++)n=i[a],o[n]=e[n];t[this.editor.uid]=o,this.saveContentAreaStatus(),this.saveDocumentStatus()},saveContentAreaStatus:function(){var e=$(this.getEditorHolder());n[this.editor.uid]={width:e.css("width"),overflowX:e.css("overflowX"),overflowY:e.css("overflowY"),height:e.css("height")}},saveDocumentStatus:function(){var e=$(this.getEditorDocumentBody());o[this.editor.uid]={overflowX:e.css("overflowX"),overflowY:e.css("overflowY")},a[this.editor.uid]={overflowX:$(this.getEditorDocumentElement()).css("overflowX"),overflowY:$(this.getEditorDocumentElement()).css("overflowY")}},revertContainerStatus:function(){$(this.editor.container).css(this.getEditorStatus())},revertContentAreaStatus:function(){var e=this.getEditorHolder(),t=this.getContentAreaStatus();this.supportMin()&&(delete t.height,e.style.height=null),$(e).css(t)},revertDocumentStatus:function(){var e=this.getDocumentStatus();$(this.getEditorDocumentBody()).css("overflowX",e.body.overflowX),$(this.getEditorDocumentElement()).css("overflowY",e.html.overflowY)},setDocumentStatus:function(){$(this.getEditorDocumentBody()).css({overflowX:"hidden",overflowY:"hidden"}),$(this.getEditorDocumentElement()).css({overflowX:"hidden",overflowY:"hidden"})},isFullState:function(){return!!this.editor._edui_fullscreen_status},getEditorStatus:function(){return t[this.editor.uid]},getContentAreaStatus:function(){return n[this.editor.uid]},getEditorDocumentElement:function(){return this.editor.container.ownerDocument.documentElement},getEditorDocumentBody:function(){return this.editor.container.ownerDocument.body},getEditorHolder:function(){return this.editor.body},getDocumentStatus:function(){return{body:o[this.editor.uid],html:a[this.editor.uid]}},supportMin:function(){var e=null;return this._support||(e=document.createElement("div"),this._support="minWidth"in e.style,e=null),this._support},getBound:function(){var e={html:!0,body:!0},t={top:0,left:0},i=null;return $.IE6?(i=this.editor.container.offsetParent,i&&!e[i.nodeName.toLowerCase()]&&(e=i.getBoundingClientRect(),t.top=-e.top,t.left=-e.left),t):t},getStyleValue:function(e){return parseInt(domUtils.getComputedStyle(this.getEditorHolder(),e))}},$.extend(e,{listen:function(){var t=null;e._hasFullscreenListener||(e._hasFullscreenListener=!0,$(window).on("resize",function(){null!==t&&(window.clearTimeout(t),t=null),t=window.setTimeout(function(){for(var e in r)r[e].resize();t=null},50)}))},getInstance:function(t){return r[t.uid]||new e(t),r[t.uid]}}),e.listen()}(),UM.registerUI("link image video map formula",function(e){var t,i,n=this,o={title:n.options.labelMap&&n.options.labelMap[e]||n.getLang("labelMap."+e),url:n.options.UMEDITOR_HOME_URL+"dialogs/"+e+"/"+e+".js"},a=$.eduibutton({icon:e,title:this.getLang("labelMap")[e]||""});return utils.loadFile(document,{src:o.url,tag:"script",type:"text/javascript",defer:"defer"},function(){var r=UM.getWidgetData(e);if(r){if(r.buttons){var s=r.buttons.ok;s&&(o.oklabel=s.label||n.getLang("ok"),s.exec&&(o.okFn=function(){return $.proxy(s.exec,null,n,i)()}));var l=r.buttons.cancel;l&&(o.cancellabel=l.label||n.getLang("cancel"),l.exec&&(o.cancelFn=function(){return $.proxy(l.exec,null,n,i)()}))}r.width&&(o.width=r.width),r.height&&(o.height=r.height),i=$.eduimodal(o),i.attr("id","edui-dialog-"+e).addClass("edui-dialog-"+e).find(".edui-modal-body").addClass("edui-dialog-"+e+"-body"),i.edui().on("beforehide",function(){var e=n.selection.getRange();e.equals(t)&&e.select()}).on("beforeshow",function(){var o=this.root(),a=null,r=null;t=n.selection.getRange(),o.parent()[0]||n.$container.find(".edui-dialog-container").append(o),$.IE6&&(a={width:$(window).width(),height:$(window).height()},r=o.parents(".edui-toolbar")[0].getBoundingClientRect(),o.css({position:"absolute",margin:0,left:(a.width-o.width())/2-r.left,top:100-r.top})),UM.setWidgetBody(e,i,n),UM.setTopEditor(n)}).on("afterbackdrop",function(){this.$backdrop.css("zIndex",n.getOpt("zIndex")+1).appendTo(n.$container.find(".edui-dialog-container")),i.css("zIndex",n.getOpt("zIndex")+2)}).on("beforeok",function(){try{t.select()}catch(e){}}).attachTo(a)}}),n.addListener("selectionchange",function(){var t=this.queryCommandState(e);a.edui().disabled(-1==t).active(1==t)}),a}),UM.registerUI("emotion formula",function(e){var t=this,i=t.options.UMEDITOR_HOME_URL+"dialogs/"+e+"/"+e+".js",n=$.eduibutton({icon:e,title:this.getLang("labelMap")[e]||""});return utils.loadFile(document,{src:i,tag:"script",type:"text/javascript",defer:"defer"},function(){var o={url:i},a=UM.getWidgetData(e);a.width&&(o.width=a.width),a.height&&(o.height=a.height),$.eduipopup(o).css("zIndex",t.options.zIndex+1).addClass("edui-popup-"+e).edui().on("beforeshow",function(){var i=this.root();i.parent().length||t.$container.find(".edui-dialog-container").append(i),UM.setWidgetBody(e,i,t),UM.setTopEditor(t)}).attachTo(n,{offsetTop:-5,offsetLeft:10,caretLeft:11,caretTop:-8}),t.addListener("selectionchange",function(){var t=this.queryCommandState(e);n.edui().disabled(-1==t).active(1==t)})}),n}),UM.registerUI("imagescale",function(){var e,t=this;t.setOpt("imageScaleEnabled",!0),browser.webkit&&t.getOpt("imageScaleEnabled")&&(t.addListener("click",function(i,n){var o=t.selection.getRange(),a=o.getClosedNode(),r=n.target;if(a&&"IMG"==a.tagName&&r==a){if(!e){e=$.eduiscale({$wrap:t.$container}).css("zIndex",t.options.zIndex),t.$container.append(e);var s,l=function(){e.edui().hide()},d=function(e){var t=e.target||e.srcElement;t&&-1==t.className.indexOf("edui-scale")&&l(e)};e.edui().on("aftershow",function(){$(document).bind("keydown",l),$(document).bind("mousedown",d),t.selection.getNative().removeAllRanges()}).on("afterhide",function(){$(document).unbind("keydown",l),$(document).unbind("mousedown",d);var i=e.edui().getScaleTarget();i.parentNode&&t.selection.getRange().selectNode(i).select()}).on("mousedown",function(i){t.selection.getNative().removeAllRanges();var n=i.target||i.srcElement;n&&-1==n.className.indexOf("edui-scale-hand")&&(s=setTimeout(function(){e.edui().hide()},200))}).on("mouseup",function(e){var t=e.target||e.srcElement;t&&-1==t.className.indexOf("edui-scale-hand")&&clearTimeout(s)})}e.edui().show($(a))}else e&&"none"!=e.css("display")&&e.edui().hide()}),t.addListener("click",function(e,i){if("IMG"==i.target.tagName){var n=new dom.Range(t.document,t.body);n.selectNode(i.target).select()}}))}),UM.registerUI("autofloat",function(){var e=this,t=e.getLang();e.setOpt({autoFloatEnabled:!0,topOffset:0});var i=e.options.autoFloatEnabled!==!1,n=e.options.topOffset;i&&e.ready(function(){function i(){return UM.ui?1:(alert(t.autofloatMsg),0)}function o(){var e=document.body.style;e.backgroundImage='url("about:blank")',e.backgroundAttachment="fixed"}function a(){if(!m){var t=domUtils.getXY(d),i=domUtils.getComputedStyle(d,"position"),o=domUtils.getComputedStyle(d,"left");d.style.width=d.offsetWidth+"px",d.style.zIndex=1*e.options.zIndex+1,d.parentNode.insertBefore(f,d),u||h&&browser.ie?("absolute"!=d.style.position&&(d.style.position="absolute"),d.style.top=(document.body.scrollTop||document.documentElement.scrollTop)-c+n+"px"):"fixed"!=d.style.position&&(d.style.position="fixed",d.style.top=n+"px",("absolute"==i||"relative"==i)&&parseFloat(o)&&(d.style.left=t.x+"px"))}}function r(){f.parentNode&&f.parentNode.removeChild(f),d.style.cssText=l}function s(){var t=p(e.container),i=e.options.toolbarTopOffset||0;t.top<0&&t.bottom-d.offsetHeight>i?a():r()}var l,d,c,u=browser.ie&&browser.version<=6,h=browser.quirks,f=document.createElement("div"),p=function(e){var t;try{t=e.getBoundingClientRect()}catch(i){t={left:0,top:0,height:0,width:0}}for(var n,o={left:Math.round(t.left),top:Math.round(t.top),height:Math.round(t.bottom-t.top),width:Math.round(t.right-t.left)};(n=e.ownerDocument)!==document&&(e=domUtils.getWindow(n).frameElement);)t=e.getBoundingClientRect(),o.left+=t.left,o.top+=t.top;return o.bottom=o.top+o.height,o.right=o.left+o.width,o},m=!1,g=utils.defer(function(){s()},browser.ie?200:100,!0);e.addListener("destroy",function(){$(window).off("scroll resize",s),e.removeListener("keydown",g)}),i(e)&&(d=$(".edui-toolbar",e.container)[0],e.addListener("afteruiready",function(){setTimeout(function(){c=$(d).offset().top},100)}),l=d.style.cssText,f.style.height=d.offsetHeight+"px",u&&o(),$(window).on("scroll resize",s),e.addListener("keydown",g),e.addListener("resize",function(){r(),f.style.height=d.offsetHeight+"px",s()}),e.addListener("beforefullscreenchange",function(e,t){t&&(r(),m=t)}),e.addListener("fullscreenchanged",function(e,t){t||s(),m=t}),e.addListener("sourcemodechanged",function(e,t){setTimeout(function(){s()},0)}),e.addListener("clearDoc",function(){setTimeout(function(){s()},0)}))})}),UM.registerUI("source",function(e){var t=this;t.addListener("fullscreenchanged",function(){t.$container.find("textarea").width(t.$body.width()-10).height(t.$body.height())});var i=$.eduibutton({icon:e,click:function(){t.execCommand(e),UM.setTopEditor(t)},title:this.getLang("labelMap")[e]||""});return this.addListener("selectionchange",function(){var t=this.queryCommandState(e);i.edui().disabled(-1==t).active(1==t)}),i}),UM.registerUI("paragraph fontfamily fontsize",function(e){function t(e,i){var n=$("<span>").html(e).css({display:"inline",position:"absolute",top:-1e7,left:-1e5}).appendTo(document.body),o=n.width();return n.remove(),n=null,50>o?e:(e=e.slice(0,i?-4:-1),e.length?t(e+"...",!0):"...")}function i(e){var i=[];for(var n in e.items)e.value.push(n),i.push(n),e.autowidthitem.push(t(n));return e.items=i,e.autoRecord=!1,e}function n(e){for(var i=null,n=[],o=0,a=e.items.length;a>o;o++)i=e.items[o].val,n.push(i.split(/\s*,\s*/)[0]),e.itemStyles.push("font-family: "+i),e.value.push(i),e.autowidthitem.push(t(n[o]));return e.items=n,e}function o(e){var t=null,i=[];e.itemStyles=[],e.value=[];for(var n=0,o=e.items.length;o>n;n++)t=e.items[n],i.push(t),e.itemStyles.push("font-size: "+t+"px");return e.value=e.items,e.items=i,e.autoRecord=!1,e}var a=this,r=a.options.labelMap&&a.options.labelMap[e]||a.getLang("labelMap."+e),s={label:r,title:r,comboboxName:e,items:a.options[e]||[],itemStyles:[],value:[],autowidthitem:[]},l=null,d=null;if(0==s.items.length)return null;switch(e){case"paragraph":s=i(s);break;case"fontfamily":s=n(s);break;case"fontsize":s=o(s)}return l=$.eduibuttoncombobox(s).css("zIndex",a.getOpt("zIndex")+1),d=l.edui(),d.on("comboboxselect",function(t,i){a.execCommand(e,i.value)}).on("beforeshow",function(){0===l.parent().length&&l.appendTo(a.$container.find(".edui-dialog-container")),UM.setTopEditor(a)}),this.addListener("selectionchange",function(t){var i=this.queryCommandState(e),n=this.queryCommandValue(e);d.button().edui().disabled(-1==i).active(1==i),n&&(n=n.replace(/['"]/g,"").toLowerCase().split(/['|"]?\s*,\s*[\1]?/),d.selectItemByLabel(n))}),d.button().addClass("edui-combobox")}),UM.registerUI("forecolor backcolor",function(e){function t(){return domUtils.getComputedStyle(o[0],"background-color")}var i=this,n=null,o=null,a=null;return this.addListener("selectionchange",function(){var t=this.queryCommandState(e);a.edui().disabled(-1==t).active(1==t)}),a=$.eduicolorsplitbutton({icon:e,caret:!0,name:e,title:i.getLang("labelMap")[e],click:function(){i.execCommand(e,t())}}),o=a.edui().colorLabel(),n=$.eduicolorpicker({name:e,lang_clearColor:i.getLang("clearColor")||"",lang_themeColor:i.getLang("themeColor")||"",lang_standardColor:i.getLang("standardColor")||""}).on("pickcolor",function(t,n){window.setTimeout(function(){o.css("backgroundColor",n),i.execCommand(e,n)},0)}).on("show",function(){UM.setActiveWidget(colorPickerWidget.root())}).css("zIndex",i.getOpt("zIndex")+1),a.edui().on("arrowclick",function(){n.parent().length||i.$container.find(".edui-dialog-container").append(n),n.edui().show(a,{caretDir:"down",offsetTop:-5,offsetLeft:8,caretLeft:11,caretTop:-8}),UM.setTopEditor(i)}).register("click",a,function(){n.edui().hide()}),a})}(jQuery);var Auction;!function(e){var t=function(){function e(e,t,i,n){this.httpService=t,this.scope=e,this.refreshAuctionRecords(e),this.Init(e);var o=this;this.hub=new n("auction",{listeners:{refreshauctionrecords:function(t){o.refreshAuctionRecords(e),toastr.success(t)}},methods:["joinRoom"],errorHandler:function(e){console.error(e)},stateChanged:function(e){switch(e.newState){case $.signalR.connectionState.connecting:console.log("连接中");break;case $.signalR.connectionState.connected:console.log("已连接");break;case $.signalR.connectionState.reconnecting:console.log("重新连接");break;case $.signalR.connectionState.disconnected:console.log("断开")}}}),e.dobid=function(){o.postAuctionRecords(e.myauctionrecord,function(){o.Init(e)},function(t){alert(t.Message?t.Message:t),o.refreshAuctionRecords(e),o.Init(e)})},this.joinroom()}return e.prototype.joinroom=function(){this.hub.invoke("joinRoom","room"+id)},e.prototype.Init=function(e){e.myauctionrecord=new Models.AuctionRecord,e.myauctionrecord.mid=mid,e.myauctionrecord.gid=id,e.myauctionrecord.name="我的出价"},e.prototype.refreshAuctionRecords=function(e){this.getAuctionRecords(function(t){e.auctionrecords!=t&&(e.auctionrecords=t)})},e.prototype.getAuctionRecords=function(e){this.httpService.get("/api/AuctionRecords/"+id).success(function(t,i){e(t)})},e.prototype.postAuctionRecords=function(e,t,i){this.httpService.post("/api/AuctionRecords",e).success(function(e,i){t(e)}).error(function(e){i(e)})},e}();e.Controller=t}(Auction||(Auction={})),angular.module("lswapp",["SignalR"]).controller("Auction.Controller",Auction.Controller);var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},Models;!function(e){var t=function(){function e(){}return e}();e.EntityBase=t;var i=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(t);e.AuctionRecord=i;var n=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(t);e.Auction=n;var o=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(t);e.Member=o,function(e){e[e["未开始"]=0]="未开始",e[e["进行中"]=1]="进行中",e[e["成交"]=2]="成交",e[e["流拍"]=3]="流拍"}(e.EndStatus||(e.EndStatus={}));e.EndStatus}(Models||(Models={})),function(){var e=null;UM.registerWidget("emotion",{tpl:'<link type="text/css" rel="stylesheet" href="<%=emotion_url%>emotion.css"><div class="edui-emotion-tab-Jpanel edui-emotion-wrapper"><ul class="edui-emotion-Jtabnav edui-tab-nav"><li class="edui-tab-item"><a data-context=".edui-emotion-Jtab0" hideFocus="true" class="edui-tab-text"><%=lang_input_choice%></a></li><li class="edui-tab-item"><a data-context=".edui-emotion-Jtab1" class="edui-tab-text"><%=lang_input_Tuzki%></a></li><li class="edui-tab-item"><a data-context=".edui-emotion-Jtab2" hideFocus="true" class="edui-tab-text"><%=lang_input_lvdouwa%></a></li><li class="edui-tab-item"><a data-context=".edui-emotion-Jtab3" hideFocus="true" class="edui-tab-text"><%=lang_input_BOBO%></a></li><li class="edui-tab-item"><a data-context=".edui-emotion-Jtab4" hideFocus="true" class="edui-tab-text"><%=lang_input_babyCat%></a></li><li class="edui-tab-item"><a data-context=".edui-emotion-Jtab5" hideFocus="true" class="edui-tab-text"><%=lang_input_bubble%></a></li><li class="edui-tab-item"><a data-context=".edui-emotion-Jtab6" hideFocus="true" class="edui-tab-text"><%=lang_input_youa%></a></li><li class="edui-emotion-tabs"></li></ul><div class="edui-tab-content edui-emotion-JtabBodys"><div class="edui-emotion-Jtab0 edui-tab-pane"></div><div class="edui-emotion-Jtab1 edui-tab-pane"></div><div class="edui-emotion-Jtab2 edui-tab-pane"></div><div class="edui-emotion-Jtab3 edui-tab-pane"></div><div class="edui-emotion-Jtab4 edui-tab-pane"></div><div class="edui-emotion-Jtab5 edui-tab-pane"></div><div class="edui-emotion-Jtab6 edui-tab-pane"></div></div><div class="edui-emotion-JtabIconReview edui-emotion-preview-box"><img src="<%=cover_img%>" class=\'edui-emotion-JfaceReview edui-emotion-preview-img\'/></div>',sourceData:{emotion:{tabNum:7,SmilmgName:{"edui-emotion-Jtab0":["j_00",84],"edui-emotion-Jtab1":["t_00",40],"edui-emotion-Jtab2":["w_00",52],"edui-emotion-Jtab3":["B_00",63],"edui-emotion-Jtab4":["C_00",20],"edui-emotion-Jtab5":["i_f",50],"edui-emotion-Jtab6":["y_00",40]},imageFolders:{"edui-emotion-Jtab0":"jx2/","edui-emotion-Jtab1":"tsj/","edui-emotion-Jtab2":"ldw/","edui-emotion-Jtab3":"bobo/","edui-emotion-Jtab4":"babycat/","edui-emotion-Jtab5":"face/","edui-emotion-Jtab6":"youa/"},imageCss:{"edui-emotion-Jtab0":"jd","edui-emotion-Jtab1":"tsj","edui-emotion-Jtab2":"ldw","edui-emotion-Jtab3":"bb","edui-emotion-Jtab4":"cat","edui-emotion-Jtab5":"pp","edui-emotion-Jtab6":"youa"},imageCssOffset:{"edui-emotion-Jtab0":35,"edui-emotion-Jtab1":35,"edui-emotion-Jtab2":35,"edui-emotion-Jtab3":35,"edui-emotion-Jtab4":35,"edui-emotion-Jtab5":25,"edui-emotion-Jtab6":35},SmileyInfor:{"edui-emotion-Jtab0":["Kiss","Love","Yeah","啊！","背扭","顶","抖胸","88","汗","瞌睡","鲁拉","拍砖","揉脸","生日快乐","大笑","瀑布汗~","惊讶","臭美","傻笑","抛媚眼","发怒","打酱油","俯卧撑","气愤","?","吻","怒","胜利","HI","KISS","不说","不要","扯花","大心","顶","大惊","飞吻","鬼脸","害羞","口水","狂哭","来","发财了","吃西瓜","套牢","害羞","庆祝","我来了","敲打","晕了","胜利","臭美","被打了","贪吃","迎接","酷","微笑","亲吻","调皮","惊恐","耍酷","发火","害羞","汗水","大哭","","加油","困","你NB","晕倒","开心","偷笑","大哭","滴汗","叹气","超赞","??","飞吻","天使","撒花","生气","被砸","吓傻","随意吐"],"edui-emotion-Jtab1":["Kiss","Love","Yeah","啊！","背扭","顶","抖胸","88","汗","瞌睡","鲁拉","拍砖","揉脸","生日快乐","摊手","睡觉","瘫坐","无聊","星星闪","旋转","也不行","郁闷","正Music","抓墙","撞墙至死","歪头","戳眼","飘过","互相拍砖","砍死你","扔桌子","少林寺","什么？","转头","我爱牛奶","我踢","摇晃","晕厥","在笼子里","震荡"],"edui-emotion-Jtab2":["大笑","瀑布汗~","惊讶","臭美","傻笑","抛媚眼","发怒","我错了","money","气愤","挑逗","吻","怒","胜利","委屈","受伤","说啥呢？","闭嘴","不","逗你玩儿","飞吻","眩晕","魔法","我来了","睡了","我打","闭嘴","打","打晕了","刷牙","爆揍","炸弹","倒立","刮胡子","邪恶的笑","不要不要","爱恋中","放大仔细看","偷窥","超高兴","晕","松口气","我跑","享受","修养","哭","汗","啊~","热烈欢迎","打酱油","俯卧撑","?"],"edui-emotion-Jtab3":["HI","KISS","不说","不要","扯花","大心","顶","大惊","飞吻","鬼脸","害羞","口水","狂哭","来","泪眼","流泪","生气","吐舌","喜欢","旋转","再见","抓狂","汗","鄙视","拜","吐血","嘘","打人","蹦跳","变脸","扯肉","吃To","吃花","吹泡泡糖","大变身","飞天舞","回眸","可怜","猛抽","泡泡","苹果","亲","","骚舞","烧香","睡","套娃娃","捅捅","舞倒","西红柿","爱慕","摇","摇摆","杂耍","招财","被殴","被球闷","大惊","理想","欧打","呕吐","碎","吐痰"],"edui-emotion-Jtab4":["发财了","吃西瓜","套牢","害羞","庆祝","我来了","敲打","晕了","胜利","臭美","被打了","贪吃","迎接","酷","顶","幸运","爱心","躲","送花","选择"],"edui-emotion-Jtab5":["微笑","亲吻","调皮","惊讶","耍酷","发火","害羞","汗水","大哭","得意","鄙视","困","夸奖","晕倒","疑问","媒婆","狂吐","青蛙","发愁","亲吻","","爱心","心碎","玫瑰","礼物","哭","奸笑","可爱","得意","呲牙","暴汗","楚楚可怜","困","哭","生气","惊讶","口水","彩虹","夜空","太阳","钱钱","灯泡","咖啡","蛋糕","音乐","爱","胜利","赞","鄙视","OK"],"edui-emotion-Jtab6":["男兜","女兜","开心","乖乖","偷笑","大笑","抽泣","大哭","无奈","滴汗","叹气","狂晕","委屈","超赞","??","疑问","飞吻","天使","撒花","生气","被砸","口水","泪奔","吓傻","吐舌头","点头","随意吐","旋转","困困","鄙视","狂顶","篮球","再见","欢迎光临","恭喜发财","稍等","我在线","恕不议价","库房有货","货在路上"]}}},initContent:function(t,i){var n=this,o=n.sourceData.emotion,a=t.getLang("emotion")["static"],r=UMEDITOR_CONFIG.UMEDITOR_HOME_URL+"dialogs/emotion/",s=$.extend({},a,{emotion_url:r}),l=n.root();return n.inited?(n.preventDefault(),void this.switchToFirst()):(n.inited=!0,e=t,this.widget=i,o.SmileyPath=t.options.emotionLocalization===!0?r+"images/":"http://img.baidu.com/hi/",o.SmileyBox=n.createTabList(o.tabNum),o.tabExist=n.createArr(o.tabNum),s.cover_img=o.SmileyPath+(e.options.emotionLocalization?"0.gif":"default/0.gif"),l.html($.parseTmpl(n.tpl,s)),n.tabs=$.eduitab({selector:".edui-emotion-tab-Jpanel"}),n.previewBox=l.find(".edui-emotion-JtabIconReview"),n.previewImg=l.find(".edui-emotion-JfaceReview"),void n.initImgName())},initEvent:function(){var e=this;e.root().on("click",function(e){return!1}),e.root().delegate("td","mouseover mouseout",function(t){var i=$(this),n=i.attr("data-surl")||null;return n&&e[t.type](this,n,i.attr("data-posflag")),!1}),e.root().delegate("td","click",function(t){var i=$(this),n=i.attr("data-realurl")||null;return n&&e.insertSmiley(n.replace(/'/g,"\\'"),t),!1}),e.tabs.edui().on("beforeshow",function(t){var i=$(t.target).attr("data-context").replace(/^.*\.(?=[^\s]*$)/,"");t.stopPropagation(),e.updateTab(i)}),this.switchToFirst()},initImgName:function(){var e=this.sourceData.emotion;for(var t in e.SmilmgName){var i=e.SmilmgName[t],n=e.SmileyBox[t],o="";if(n.length)return;for(var a=1;a<=i[1];a++)o=i[0],10>a&&(o+="0"),o=o+a+".gif",n.push(o)}},switchToFirst:function(){this.root().find(".edui-emotion-Jtabnav .edui-tab-text:first").trigger("click")},updateTab:function(e){var t=this,i=t.sourceData.emotion;t.autoHeight(e),i.tabExist[e]||(i.tabExist[e]=!0,t.createTab(e))},autoHeight:function(){this.widget.height(this.root()+2)},createTabList:function(e){for(var t={},i=0;e>i;i++)t["edui-emotion-Jtab"+i]=[];return t},mouseover:function(e,t,i){i-=0,$(e).css("backgroundColor","#ACCD3C"),this.previewImg.css("backgroundImage","url("+t+")"),i&&this.previewBox.addClass("edui-emotion-preview-left"),this.previewBox.show()},mouseout:function(e){$(e).css("backgroundColor","transparent"),this.previewBox.removeClass("edui-emotion-preview-left").hide()},insertSmiley:function(t,i){var n={src:t};n._src=n.src,e.execCommand("insertimage",n),i.ctrlKey||(this.previewBox.removeClass("edui-emotion-preview-left").hide(),this.widget.edui().hide())},createTab:function(t){for(var i,n,o,a,r,s,l="?v=1.1",d=this,c=this.root().find("."+t),u=d.sourceData.emotion,h=u.SmileyPath+u.imageFolders[t],f=5.5,p=iHeight=35,m=u.imageCss[t],g=u.imageCssOffset[t],v=['<table border="1" class="edui-emotion-smileytable">'],b=0,y=u.SmileyBox[t].length,w=11;y>b;){v.push("<tr>");for(var C=0;w>C;C++,b++)i=u.SmileyBox[t][b],i?(n=h+i+l,o=h+i,a=f>C?0:1,r=g*b*-1-1,s=u.SmileyInfor[t][b],v.push('<td  class="edui-emotion-'+m+'" data-surl="'+n+'" data-realurl="'+o+'" data-posflag="'+a+'" align="center">'),v.push("<span>"),v.push('<img  style="background-position:left '+r+'px;" title="'+s+'" src="'+u.SmileyPath+(e.options.emotionLocalization?'0.gif" width="':'default/0.gif" width="')+p+'" height="'+iHeight+'"></img>'),v.push("</span>")):v.push('<td bgcolor="#FFFFFF">'),v.push("</td>");v.push("</tr>")}v.push("</table>"),v=v.join(""),c.html(v)},createArr:function(e){for(var t=[],i=0;e>i;i++)t[i]=0;return t},width:603,height:400})}(),function(){var e=null;UM.registerWidget("formula",{tpl:'<link type="text/css" rel="stylesheet" href="<%=formula_url%>formula.css"><div class="edui-formula-wrapper"><ul class="edui-tab-nav"></ul><div class="edui-tab-content"></div></div>',sourceData:{formula:{common:["{/}frac{ }{ }","^{ }/_{ }","x^{ }","x_{ }","x^{ }_{ }","{/}bar{ }","{/}sqrt{ }","{/}nthroot{ }{ }","{/}sum^{ }_{n=}","{/}sum","{/}log_{ }","{/}ln","{/}int_{ }^{ }","{/}oint_{ }^{ }"],symbol:["+","-","{/}pm","{/}times","{/}ast","{/}div","/","{/}bigtriangleup","=","{/}ne","{/}approx",">","<","{/}ge","{/}le","{/}infty","{/}cap","{/}cup","{/}because","{/}therefore","{/}subset","{/}supset","{/}subseteq","{/}supseteq","{/}nsubseteq","{/}nsupseteq","{/}in","{/}ni","{/}notin","{/}mapsto","{/}leftarrow","{/}rightarrow","{/}Leftarrow","{/}Rightarrow","{/}leftrightarrow","{/}Leftrightarrow"],letter:["{/}alpha","{/}beta","{/}gamma","{/}delta","{/}varepsilon","{/}varphi","{/}lambda","{/}mu","{/}rho","{/}sigma","{/}omega","{/}Gamma","{/}Delta","{/}Theta","{/}Lambda","{/}Xi","{/}Pi","{/}Sigma","{/}Upsilon","{/}Phi","{/}Psi","{/}Omega"]}},initContent:function(t,i){var n=this,o=n.sourceData.formula,a=t.getLang("formula")["static"],r=UMEDITOR_CONFIG.UMEDITOR_HOME_URL+"dialogs/formula/",s=$.extend({},a,{formula_url:r}),l=n.root();if(n.inited)return void n.preventDefault();n.inited=!0,e=t,n.$widget=i,l.html($.parseTmpl(n.tpl,s)),n.tabs=$.eduitab({selector:"#edui-formula-tab-Jpanel"});var d=[],c=0,u=0,h=n.root().find(".edui-tab-content");$.each(o,function(e,t){var i=[];$.each(t,function(e,t){i.push('<li class="edui-formula-latex-item" data-latex="'+t+'" style="background-position:-'+30*c+"px -"+30*u+'px"></li>'),++c>=8&&(++u,c=0)}),u++,c=0,h.append('<div class="edui-tab-pane"><ul>'+i.join("")+"</ul>"),d.push('<li class="edui-tab-item"><a href="javascript:void(0);" class="edui-tab-text">'+a["lang_tab_"+e]+"</a></li>")}),d.push('<li class="edui-formula-clearboth"></li>'),l.find(".edui-tab-nav").html(d.join("")),l.find(".edui-tab-content").append('<div class="edui-formula-clearboth"></div>'),n.switchTab(0)},initEvent:function(){var e=this;e.root().on("click",function(e){return!1}),e.root().find(".edui-tab-nav").delegate(".edui-tab-item","click",function(t){return e.switchTab(this),!1}),e.root().find(".edui-tab-pane").delegate(".edui-formula-latex-item","click",function(t){var i=$(this),n=i.attr("data-latex")||"";return n&&e.insertLatex(n.replace("{/}","\\")),e.$widget.edui().hide(),!1})},switchTab:function(e){var t=this,i=t.root(),e=$.isNumeric(e)?e:$.inArray(e,i.find(".edui-tab-nav .edui-tab-item"));i.find(".edui-tab-nav .edui-tab-item").removeClass("edui-active").eq(e).addClass("edui-active"),i.find(".edui-tab-content .edui-tab-pane").removeClass("edui-active").eq(e).addClass("edui-active"),t.autoHeight(0)},autoHeight:function(){this.$widget.height(this.root()+2)},insertLatex:function(t){e.execCommand("formula",t)},width:350,height:400})}(),function(){var utils=UM.utils,browser=UM.browser,Base={checkURL:function(e){return e?(e=utils.trim(e),e.length<=0?!1:(0!==e.search(/http:\/\/|https:\/\//)&&(e+="http://"),e=e.replace(/\?[\s\S]*$/,""),/(.gif|.jpg|.jpeg|.png)$/i.test(e)?e:!1)):!1},getAllPic:function(e,t,i){var n=[],o=$(e,t);return $.each(o,function(e,t){
return $(t).removeAttr("width").removeAttr("height"),n.push({_src:t.src,src:t.src})}),n},scale:function(e,t,i,n){var o,a=0,r=0,s=e.width||i,l=e.height||n;return(s>t||l>t)&&(s>=l?(a=s-t)&&(o=(a/s).toFixed(2),e.height=l-l*o,e.width=t):(r=l-t)&&(o=(r/l).toFixed(2),e.width=s-s*o,e.height=t)),this},close:function(e){return e.css({top:(e.parent().height()-e.height())/2,left:(e.parent().width()-e.width())/2}).prev().on("click",function(){$(this).parent().remove().hasClass("edui-image-upload-item")&&(Upload.showCount--,Upload.updateView())}),this},createImgBase64:function(e,t,i){if(browser.webkit)e.src=window.webkitURL.createObjectURL(t);else if(browser.gecko)e.src=window.URL.createObjectURL(t);else{var n=new FileReader;n.onload=function(t){e.src=this.result,i.append(e)},n.readAsDataURL(t)}},callback:function(e,t,i,n){if("SUCCESS"==n){Upload.showCount++;var o=$("<img src='"+e.options.imagePath+i+"' class='edui-image-pic' />"),a=$("<div class='edui-image-item edui-image-upload-item'><div class='edui-image-close'></div></div>").append(o);$(".edui-image-upload2",t).length<1?($(".edui-image-content",t).append(a),Upload.render(".edui-image-content",2).config(".edui-image-upload2")):$(".edui-image-upload2",t).before(a).show(),o.on("load",function(){Base.scale(this,120),Base.close($(this)),$(".edui-image-content",t).focus()})}else currentDialog.showTip(n),window.setTimeout(function(){currentDialog.hideTip()},3e3);Upload.toggleMask()}},Upload={showCount:0,uploadTpl:'<div class="edui-image-upload%%"><span class="edui-image-icon"></span><form class="edui-image-form" method="post" enctype="multipart/form-data" target="up"><input style="filter: alpha(opacity=0);" class="edui-image-file" type="file" hidefocus name="upfile" accept="image/gif,image/jpeg,image/png,image/jpg,image/bmp"/></form></div>',init:function(e,t){var i=this;return i.editor=e,i.dialog=t,i.render(".edui-image-local",1),i.config(".edui-image-upload1"),i.submit(),i.drag(),$(".edui-image-upload1").hover(function(){$(".edui-image-icon",this).toggleClass("hover")}),UM.browser.ie&&UM.browser.version<=9||$(".edui-image-dragTip",i.dialog).css("display","block"),i},render:function(e,t){var i=this;return $(e,i.dialog).append($(i.uploadTpl.replace(/%%/g,t))),i},config:function(e){var t=this,i=t.editor.options.imageUrl;return i=i+(-1==i.indexOf("?")?"?":"&")+"editorid="+t.editor.id,$("form",$(e,t.dialog)).attr("action",i),t},uploadComplete:function(r){var me=this;try{var json=eval("("+r+")");Base.callback(me.editor,me.dialog,json.url,json.state)}catch(e){var lang=me.editor.getLang("image");Base.callback(me.editor,me.dialog,"",lang&&lang.uploadError||"Error!")}},submit:function(e){var t=this,i=$('<input style="filter: alpha(opacity=0);" class="edui-image-file" type="file" hidefocus="" name="upfile" accept="image/gif,image/jpeg,image/png,image/jpg,image/bmp">'),i=i[0];return $(t.dialog).delegate(".edui-image-file","change",function(n){this.parentNode&&($('<iframe name="up"  style="display: none"></iframe>').insertBefore(t.dialog).on("load",function(){var e=this.contentWindow.document.body.innerHTML;""!=e&&(t.uploadComplete(e),$(this).unbind("load"),$(this).remove())}),$(this).parent()[0].submit(),Upload.updateInput(i),t.toggleMask("Loading...."),e&&e())}),t},updateInput:function(e){$(".edui-image-file",this.dialog).each(function(t,i){i.parentNode.replaceChild(e.cloneNode(!0),i)})},updateView:function(){0===Upload.showCount&&($(".edui-image-upload2",this.dialog).hide(),$(".edui-image-dragTip",this.dialog).show(),$(".edui-image-upload1",this.dialog).show())},drag:function(){var e=this;UM.browser.ie9below||e.dialog.find(".edui-image-content").on("drop",function(t){var i=t.originalEvent.dataTransfer.files,n=document.createElement("img"),o=!1;$.each(i,function(t,a){if(/^image/.test(a.type)){Base.createImgBase64(n,a,e.dialog);var r=new XMLHttpRequest;r.open("post",e.editor.getOpt("imageUrl")+"?type=ajax",!0),r.setRequestHeader("X-Requested-With","XMLHttpRequest");var s=new FormData;s.append(e.editor.getOpt("imageFieldName"),a),r.send(s),r.addEventListener("load",function(o){var a=o.target.response;e.uploadComplete(a),t==i.length-1&&$(n).remove()}),o=!0}}),o&&(t.preventDefault(),e.toggleMask("Loading...."))}).on("dragover",function(e){e.preventDefault()})},toggleMask:function(e){var t=this,i=$(".edui-image-mask",t.dialog);if(e)UM.browser.ie&&UM.browser.version<=9||$(".edui-image-dragTip",t.dialog).css("display","none"),$(".edui-image-upload1",t.dialog).css("display","none"),i.addClass("edui-active").html(e);else{if(i.removeClass("edui-active").html(),Upload.showCount>0)return t;UM.browser.ie&&UM.browser.version<=9||$(".edui-image-dragTip",t.dialog).css("display","block"),$(".edui-image-upload1",t.dialog).css("display","block")}return t}},NetWork={init:function(e,t){var i=this;i.editor=e,i.dialog=t,i.initEvt()},initEvt:function(){var e,t=this,i=$(".edui-image-searchTxt",t.dialog);$(".edui-image-searchAdd",t.dialog).on("click",function(){e=Base.checkURL(i.val()),e&&$("<img src='"+e+"' class='edui-image-pic' />").on("load",function(){var e=$("<div class='edui-image-item'><div class='edui-image-close'></div></div>").append(this);$(".edui-image-searchRes",t.dialog).append(e),Base.scale(this,120),e.width($(this).width()),Base.close($(this)),i.val("")})}).hover(function(){$(this).toggleClass("hover")})}},$tab=null,currentDialog=null;UM.registerWidget("image",{tpl:'<link rel="stylesheet" type="text/css" href="<%=image_url%>image.css"><div class="edui-image-wrapper"><ul class="edui-tab-nav"><li class="edui-tab-item edui-active"><a data-context=".edui-image-local" class="edui-tab-text"><%=lang_tab_local%></a></li><li  class="edui-tab-item"><a data-context=".edui-image-JimgSearch" class="edui-tab-text"><%=lang_tab_imgSearch%></a></li></ul><div class="edui-tab-content"><div class="edui-image-local edui-tab-pane edui-active"><div class="edui-image-content"></div><div class="edui-image-mask"></div><div class="edui-image-dragTip"><%=lang_input_dragTip%></div></div><div class="edui-image-JimgSearch edui-tab-pane"><div class="edui-image-searchBar"><table><tr><td><input class="edui-image-searchTxt" type="text"></td><td><div class="edui-image-searchAdd"><%=lang_btn_add%></div></td></tr></table></div><div class="edui-image-searchRes"></div></div></div></div>',initContent:function(e,t){var i=e.getLang("image")["static"],n=$.extend({},i,{image_url:UMEDITOR_CONFIG.UMEDITOR_HOME_URL+"dialogs/image/"});if(Upload.showCount=0,i)var o=$.parseTmpl(this.tpl,n);currentDialog=t.edui(),this.root().html(o)},initEvent:function(e,t){$tab=$.eduitab({selector:".edui-image-wrapper"}).edui().on("beforeshow",function(e){e.stopPropagation()}),Upload.init(e,t),NetWork.init(e,t)},buttons:{ok:{exec:function(e,t){var i="",n=$tab.activate();0==n?i=".edui-image-content .edui-image-pic":1==n&&(i=".edui-image-searchRes .edui-image-pic");var o=Base.getAllPic(i,t,e);-1!=n&&e.execCommand("insertimage",o)}},cancel:{}},width:700,height:408},function(e,t,i,n){Base.callback(e,t,i,n)})}(),function(){var e=UM.utils;UM.registerWidget("link",{tpl:'<style type="text/css">.edui-dialog-link .edui-link-table{font-size: 12px;margin: 10px;line-height: 30px}.edui-dialog-link .edui-link-txt{width:300px;height:21px;line-height:21px;border:1px solid #d7d7d7;}</style><table class="edui-link-table"><tr><td><label for="href"><%=lang_input_url%></label></td><td><input class="edui-link-txt" id="edui-link-Jhref" type="text" /></td></tr><tr><td><label for="title"><%=lang_input_title%></label></td><td><input class="edui-link-txt" id="edui-link-Jtitle" type="text"/></td></tr><tr><td colspan="2"><label for="target"><%=lang_input_target%></label><input id="edui-link-Jtarget" type="checkbox"/></td></tr></table>',initContent:function(e){var t=e.getLang("link");if(t)var i=$.parseTmpl(this.tpl,t["static"]);this.root().html(i)},initEvent:function(t,i){var n=t.queryCommandValue("link");n&&($("#edui-link-Jhref",i).val(e.html($(n).attr("href"))),$("#edui-link-Jtitle",i).val($(n).attr("title")),"_blank"==$(n).attr("target")&&$("#edui-link-Jtarget").attr("checked",!0)),$("#edui-link-Jhref",i).focus()},buttons:{ok:{exec:function(e,t){var i=$("#edui-link-Jhref").val().replace(/^\s+|\s+$/g,"");i&&e.execCommand("link",{href:i,target:$("#edui-link-Jtarget:checked").length?"_blank":"_self",title:$("#edui-link-Jtitle").val().replace(/^\s+|\s+$/g,""),_href:i})}},cancel:{}},width:400})}(),function(){var e="map";UM.registerWidget(e,{tpl:'<style type="text/css">.edui-dialog-map .edui-map-content{width:530px; height: 350px;margin: 10px auto;}.edui-dialog-map .edui-map-content table{width: 100%}.edui-dialog-map .edui-map-content table td{vertical-align: middle;}.edui-dialog-map .edui-map-button { border: 1px solid #ccc; float: left; cursor: default; height: 23px; width: 70px; cursor: pointer; margin: 0; font-size: 12px; line-height: 24px; text-align: center; }.edui-dialog-map .edui-map-button:hover {background:#eee;}.edui-dialog-map .edui-map-city,.edui-dialog-map .edui-map-address{height:21px;background: #FFF;border:1px solid #d7d7d7; line-height: 21px;}.edui-dialog-map .edui-map-city{width:90px}.edui-dialog-map .edui-map-address{width:150px}.edui-dialog-map .edui-map-dynamic-label span{vertical-align:middle;margin: 3px 0px 3px 3px;}.edui-dialog-map .edui-map-dynamic-label input{vertical-align:middle;margin: 3px;}</style><div class="edui-map-content"><table><tr><td><%=lang_city%>:</td><td><input class="edui-map-city" type="text" value="<%=city.value%>"/></td><td><%=lang_address%>:</td><td><input class="edui-map-address" type="text" value="" /></td><td><a class="edui-map-button"><%=lang_search%></a></td><td><label class="edui-map-dynamic-label"><input class="edui-map-dynamic" type="checkbox" name="edui-map-dynamic" /><span><%=lang_dynamicmap%></span></label></td></tr></table><div style="width:100%;height:340px;margin:5px auto;border:1px solid gray" class="edui-map-container"></div></div><script class="edui-tpl-container" type="text/plain"><!DOCTYPE html><html><head><title></title></head><body><scr_ipt>window.onload = function(){var scripts = document.scripts || document.getElementsByTagName("script"),src = [];for( var i = 1, len = scripts.length; i<len; i++ ) {src.push( scripts[i].src );}parent.UM.getEditor(<<id>>).getWidgetData(\'map\').requestMapApi( src );};function mapReadyStateChange ( state ) { '+" if ( state === 'complete' || state === 'loaded' ) { document.close();  } }</scr_ipt><scr_ipt onreadystatechange='mapReadyStateChange(this.readyState);' onload='mapReadyStateChange(\"loaded\");' src=\"http://api.map.baidu.com/api?v=2.0&ak=6b6c1a67eaa7db1ca6d6da28e590e343&services=true\"></scr_ipt></body></html></script>",initContent:function(t,i){var n=this,o=t.getLang(e),a=t.options.themePath+t.options.theme;return n.inited?(n.preventDefault(),!1):(n.inited=!0,n.lang=o,n.editor=t,n.root().html($.parseTmpl(n.tpl,$.extend({},o["static"],{theme_url:a}))),void n.initRequestApi())},initRequestApi:function(){var e=null;window.BMap&&window.BMap.Map?this.initBaiduMap():(e=$('<iframe style="display: none;"></iframe>'),e.appendTo(this.root()),e=e[0].contentWindow.document,e.open(),e.write(this.root().find(".edui-tpl-container").html().replace(/scr_ipt/g,"script").replace("<<id>>","'"+this.editor.id+"'")))},requestMapApi:function(e){var t=this;if(e.length){var i=e[0];e=e.slice(1),i?$.getScript(i,function(){t.requestMapApi(e)}):t.requestMapApi(e)}else t.initBaiduMap()},initBaiduMap:function(){var e,t,i,n=this.root(),o=new BMap.Map(n.find(".edui-map-container")[0]),a=this,r=$(a.editor.selection.getRange().getClosedNode());if(o.enableInertialDragging(),o.enableScrollWheelZoom(),o.enableContinuousZoom(),r.length&&/api[.]map[.]baidu[.]com/gi.test(r.attr("src"))){var s=r.attr("src"),l=a.getPars(s,"center").split(","),d=a.getPars(s,"markers").split(",");t=new BMap.Point(Number(l[0]),Number(l[1])),e=new BMap.Marker(new BMap.Point(Number(d[0]),Number(d[1]))),o.addControl(new BMap.NavigationControl),o.centerAndZoom(t,Number(a.getPars(s,"zoom"))),i=r.attr("style")}else t=new BMap.Point(116.404,39.915),e=new BMap.Marker(t),o.addControl(new BMap.NavigationControl),o.centerAndZoom(t,10);e.enableDragging(),o.addOverlay(e),a.map=o,a.marker=e,a.imgcss=i},doSearch:function(){var e=this,t=e.root().find(".edui-map-city").val(),i=e.root().find(".edui-map-address").val();if(!t)return void alert(e.lang.cityMsg);var n=new BMap.LocalSearch(t,{onSearchComplete:function(t){if(t&&t.getNumPois()){for(var i=[],n=0;n<t.getCurrentNumPois();n++)i.push(t.getPoi(n).point);i.length>1?e.map.setViewport(i):e.map.centerAndZoom(i[0],13),point=e.map.getCenter(),e.marker.setPoint(point)}else alert(e.lang.errorMsg)}});n.search(i||t)},getPars:function(e,t){var i=new RegExp(t+"=((\\d+|[.,])*)","g");return i.exec(e)[1]},reset:function(){this.map&&this.map.reset()},initEvent:function(){var e=this,t=e.root();t.find(".edui-map-address").on("keydown",function(t){return t=t||event,13==t.keyCode?(e.doSearch(),!1):void 0}),t.find(".edui-map-button").on("click",function(t){e.doSearch()}),t.find(".edui-map-address").focus(),t.on("mousewheel DOMMouseScroll",function(e){return!1})},width:580,height:408,buttons:{ok:{exec:function(t){var i=t.getWidgetData(e),n=i.map.getCenter(),o=i.map.getZoom(),a=i.map.getSize(),r=i.marker.P;if(i.root().find(".edui-map-dynamic")[0].checked){var s=t.getOpt("UMEDITOR_HOME_URL"),l=[s+(/\/$/.test(s)?"":"/")+"dialogs/map/map.html#center="+n.lng+","+n.lat,"&zoom="+o,"&width="+a.width,"&height="+a.height,"&markers="+r.lng+","+r.lat].join("");t.execCommand("inserthtml",'<iframe class="ueditor_baidumap" src="'+l+'" frameborder="0" width="'+(a.width+4)+'" height="'+(a.height+4)+'"></iframe>')}else l="http://api.map.baidu.com/staticimage?center="+n.lng+","+n.lat+"&zoom="+o+"&width="+a.width+"&height="+a.height+"&markers="+r.lng+","+r.lat,t.execCommand("inserthtml",'<img width="'+a.width+'"height="'+a.height+'" src="'+l+'"'+(i.imgcss?' style="'+i.imgcss+'"':"")+"/>",!0);i.reset()}},cancel:{exec:function(t){t.getWidgetData(e).reset()}}}})}(),function(){var e=UM.dom.domUtils,t="video";UM.registerWidget(t,{tpl:'<link rel="stylesheet" type="text/css" href="<%=video_url%>video.css" /><div class="edui-video-wrapper"><div id="eduiVideoTab"><div id="eduiVideoTabHeads" class="edui-video-tabhead"><span tabSrc="video" class="edui-video-focus"><%=lang_tab_insertV%></span></div><div id="eduiVideoTabBodys" class="edui-video-tabbody"><div id="eduiVideoPanel" class="edui-video-panel"><table><tr><td><label for="eduiVideoUrl" class="edui-video-url"><%=lang_video_url%></label></td><td><input id="eduiVideoUrl" type="text"></td></tr></table><div id="eduiVideoPreview"></div><div id="eduiVideoInfo"><fieldset><legend><%=lang_video_size%></legend><table><tr><td><label for="eduiVideoWidth"><%=lang_videoW%></label></td><td><input class="edui-video-txt" id="eduiVideoWidth" type="text"/></td></tr><tr><td><label for="eduiVideoHeight"><%=lang_videoH%></label></td><td><input class="edui-video-txt" id="eduiVideoHeight" type="text"/></td></tr></table></fieldset><fieldset><legend><%=lang_alignment%></legend><div id="eduiVideoFloat"></div></fieldset></div></div></div></div></div>',initContent:function(e,i){var n=this,o=e.getLang(t),a=UMEDITOR_CONFIG.UMEDITOR_HOME_URL+"dialogs/video/";n.lang=o,n.editor=e,n.$widget=i,n.root().html($.parseTmpl(n.tpl,$.extend({video_url:a},o["static"]))),n.initController(o)},initEvent:function(){var e=this,t=$("#eduiVideoUrl",e.$widget)[0];"oninput"in t?t.oninput=function(){e.createPreviewVideo(this.value)}:t.onpropertychange=function(){e.createPreviewVideo(this.value)}},initController:function(t){var i,n=this,o=n.editor.selection.getRange().getClosedNode();if(n.createAlignButton(["eduiVideoFloat"]),o&&"edui-faked-video"==o.className){$("#eduiVideoUrl",n.$widget)[0].value=i=o.getAttribute("_url"),$("#eduiVideoWidth",n.$widget)[0].value=o.width,$("#eduiVideoHeight",n.$widget)[0].value=o.height;var a=e.getComputedStyle(o,"float"),r=e.getComputedStyle(o.parentNode,"text-align");n.updateAlignButton("center"===r?"center":a)}n.createPreviewVideo(i)},createPreviewVideo:function(e){if(e){var t=this,i=t.lang,n=t.convert_url(e);return t.endWith(n,[".swf",".flv",".wmv"])?void($("#eduiVideoPreview",t.$widget)[0].innerHTML='<embed type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" src="'+e+'" width="420" height="280" wmode="transparent" play="true" loop="false" menu="false" allowscriptaccess="never" allowfullscreen="true" ></embed>'):void $("#eduiVideoPreview",t.$widget).html(i.urlError)}},insertSingle:function(){var e=this,t=$("#eduiVideoWidth",e.$widget)[0],i=$("#eduiVideoHeight",e.$widget)[0],n=$("#eduiVideoUrl",e.$widget)[0].value,o=this.findFocus("eduiVideoFloat","name");return n&&e.checkNum([t,i])?void this.editor.execCommand("insertvideo",{url:e.convert_url(n),width:t.value,height:i.value,align:o}):!1},convert_url:function(e){if(!e)return"";var t=e.match(/youtu.be\/(\w+)$/)||e.match(/youtube\.com\/watch\?v=(\w+)/)||e.match(/youtube.com\/v\/(\w+)/),i=e.match(/youku\.com\/v_show\/id_(\w+)/),n=/player\.youku\.com/gi.test(e);return e=n?e.replace(/\?f=.*/,""):t?"https://www.youtube.com/v/"+t[1]+"?version=3&feature=player_embedded":i?"http://player.youku.com/player.php/sid/"+i[1]+"/v.swf":e.replace(/http:\/\/www\.tudou\.com\/programs\/view\/([\w\-]+)\/?/i,"http://www.tudou.com/v/$1").replace(/http:\/\/www\.youtube\.com\/watch\?v=([\w\-]+)/i,"http://www.youtube.com/v/$1").replace(/http:\/\/v\.youku\.com\/v_show\/id_([\w\-=]+)\.html/i,"http://player.youku.com/player.php/sid/$1").replace(/http:\/\/www\.56\.com\/u\d+\/v_([\w\-]+)\.html/i,"http://player.56.com/v_$1.swf").replace(/http:\/\/www.56.com\/w\d+\/play_album\-aid\-\d+_vid\-([^.]+)\.html/i,"http://player.56.com/v_$1.swf").replace(/http:\/\/v\.ku6\.com\/.+\/([^.]+)\.html/i,"http://player.ku6.com/refer/$1/v.swf").replace(/\?f=.*/,"")},checkNum:function(e){for(var t,i=this,n=0;t=e[n++];){var o=t.value;if(!i.isNumber(o)&&o)return alert(i.lang.numError),t.value="",t.focus(),!1}return!0},isNumber:function(e){return/(0|^[1-9]\d*$)/.test(e)},updateAlignButton:function(e){for(var t,i=$("#eduiVideoFloat",this.$widget)[0].children,n=0;t=i[n++];)t.getAttribute("name")==e?"edui-video-focus"!=t.className&&(t.className="edui-video-focus"):"edui-video-focus"==t.className&&(t.className="")},createAlignButton:function(e){for(var t,i=this.lang,n=UMEDITOR_CONFIG.UMEDITOR_HOME_URL+"dialogs/video/",o=0;t=e[o++];){var a=$("#"+t,this.$widget)[0],r={none:i["default"],left:i.floatLeft,right:i.floatRight};for(var s in r){var l=document.createElement("div");l.setAttribute("name",s),"none"==s&&(l.className="edui-video-focus"),l.style.cssText="background:url("+n+"images/"+s+"_focus.jpg);",l.setAttribute("title",r[s]),a.appendChild(l)}this.switchSelect(t)}},switchSelect:function(e){for(var t,i=$("#"+e,this.$widget)[0].children,n=0;t=i[n++];)$(t).on("click",function(){for(var e,t=0;e=i[t++];)e.className="",e.removeAttribute&&e.removeAttribute("class");this.className="edui-video-focus"})},findFocus:function(e,t){for(var i,n,o=$("#"+e,this.$widget)[0].children,a=0;n=o[a++];)if("edui-video-focus"==n.className){i=n.getAttribute(t);break}return i},endWith:function(e,t){for(var i=0,n=t.length;n>i;i++){var o=t[i];if(e.length-o.length<0)return!1;if(e.substring(e.length-o.length)==o)return!0}return!1},width:610,height:498,buttons:{ok:{exec:function(e,i){$("#eduiVideoPreview",i).html(""),e.getWidgetData(t).insertSingle()}},cancel:{exec:function(){$("#eduiVideoPreview").html("")}}}})}(),UM.I18N.en={labelMap:{anchor:"Anchor",undo:"Undo",redo:"Redo",bold:"Bold",indent:"Indent",snapscreen:"SnapScreen",italic:"Italic",underline:"Underline",strikethrough:"Strikethrough",subscript:"SubScript",fontborder:"text border",superscript:"SuperScript",formatmatch:"Format Match",source:"Source",blockquote:"BlockQuote",pasteplain:"PastePlain",selectall:"SelectAll",print:"Print",preview:"Preview",horizontal:"Horizontal",removeformat:"RemoveFormat",time:"Time",date:"Date",unlink:"Unlink",insertrow:"InsertRow",insertcol:"InsertCol",mergeright:"MergeRight",mergedown:"MergeDown",deleterow:"DeleteRow",deletecol:"DeleteCol",splittorows:"SplitToRows",insertcode:"insert code",splittocols:"SplitToCols",splittocells:"SplitToCells",deletecaption:"DeleteCaption",inserttitle:"InsertTitle",mergecells:"MergeCells",deletetable:"DeleteTable",cleardoc:"Clear",insertparagraphbeforetable:"InsertParagraphBeforeTable",fontfamily:"FontFamily",fontsize:"FontSize",paragraph:"Paragraph",image:"Image",edittable:"Edit Table",edittd:"Edit Td",link:"Link",emotion:"Emotion",spechars:"Spechars",searchreplace:"SearchReplace",map:"BaiduMap",gmap:"GoogleMap",video:"Video",help:"Help",justifyleft:"JustifyLeft",justifyright:"JustifyRight",justifycenter:"JustifyCenter",justifyjustify:"Justify",forecolor:"FontColor",backcolor:"BackColor",insertorderedlist:"OL",insertunorderedlist:"UL",fullscreen:"FullScreen",directionalityltr:"EnterFromLeft",directionalityrtl:"EnterFromRight",rowspacingtop:"RowSpacingTop",rowspacingbottom:"RowSpacingBottom",highlightcode:"Code",pagebreak:"PageBreak",insertframe:"Iframe",imagenone:"Default",imageleft:"ImageLeft",imageright:"ImageRight",attachment:"Attachment",imagecenter:"ImageCenter",wordimage:"WordImage",lineheight:"LineHeight",edittip:"EditTip",customstyle:"CustomStyle",scrawl:"Scrawl",autotypeset:"AutoTypeset",webapp:"WebAPP",touppercase:"UpperCase",tolowercase:"LowerCase",template:"Template",background:"Background",inserttable:"InsertTable",drafts:"drafts",formula:"formula"},paragraph:{p:"Paragraph",h1:"Title 1",h2:"Title 2",h3:"Title 3",h4:"Title 4",h5:"Title 5",h6:"Title 6"},fontfamily:{songti:"Sim sun",kaiti:"Sim kai",heiti:"Sim hei",lishu:"Sim li",yahei:"Microsoft yahei",andaleMono:"Andale mono",arial:"Arial",arialBlack:"Arial black",comicSansMs:"Comic sans ms",impact:"Impact",timesNewRoman:"Times new roman"},ok:"OK",cancel:"Cancel",closeDialog:"closeDialog",tableDrag:"You must import the file uiUtils.js before drag! ",autofloatMsg:"The plugin AutoFloat depends on EditorUI!",anthorMsg:"Link",clearColor:"Clear",standardColor:"Standard color",themeColor:"Theme color",property:"Property","default":"Default",modify:"Modify",justifyleft:"Justify Left",justifyright:"Justify Right",justifycenter:"Justify Center",justify:"Default",clear:"Clear",anchorMsg:"Anchor","delete":"Delete",clickToUpload:"Click to upload",unset:"Language hasn't been set!",t_row:"row",t_col:"col",more:"More",pasteOpt:"Paste Option",pasteSourceFormat:"Keep Source Formatting",tagFormat:"Keep tag",pasteTextFormat:"Keep Text only",image:{"static":{lang_tab_local:"Local Upload",lang_tab_imgSearch:"Network Pictures",lang_input_dragTip:"Support drag upload",lang_btn_add:"Add"},uploadError:"Upload Error"},emotion:{"static":{lang_input_choice:"Choice",lang_input_Tuzki:"Tuzki",lang_input_lvdouwa:"LvDouWa",lang_input_BOBO:"BOBO",lang_input_babyCat:"BabyCat",lang_input_bubble:"Bubble",lang_input_youa:"YouA"}},gmap:{"static":{lang_input_address:"Address:",lang_input_search:"Search",address:{value:"Beijing"}},searchError:"Unable to locate the address!"},link:{"static":{lang_input_text:"Text：",lang_input_url:"URL：",lang_input_title:"Title：",lang_input_target:"open in new window："},validLink:"Supports only effective when a link is selected",httpPrompt:'The hyperlink you enter should start with "http|https|ftp://"!'},map:{"static":{lang_city:"City",lang_address:"Address",city:{value:"Beijing"},lang_search:"Search",lang_dynamicmap:"Dynamic map"},cityMsg:"Please enter the city name!",errorMsg:"Can't find the place!"},video:{"static":{lang_tab_insertV:"Video",lang_video_url:" URL ",lang_video_size:"Video Size",lang_videoW:"Width",lang_videoH:"Height",lang_alignment:"Alignment",videoSearchTxt:{value:"Enter the search keyword!"},videoType:{options:["All","Hot","Entertainment","Funny","Sports","Science","variety"]},videoSearchBtn:{value:"Search in Baidu"},videoSearchReset:{value:"Clear result"}},numError:"Please enter the correct Num. e.g 123,400",floatLeft:"Float left",floatRight:"Float right","default":"Default",block:"Display in block",urlError:"The video url format may be wrong!",loading:" &nbsp;The video is loading, please wait…",clickToSelect:"Click to select",goToSource:"Visit source video ",noVideo:" &nbsp; &nbsp;Sorry,can't find the video,please try again!"},formula:{"static":{lang_tab_common:"Common",lang_tab_symbol:"Symbol",lang_tab_letter:"Letter"}}},UM.I18N["zh-cn"]={labelMap:{anchor:"锚点",undo:"撤销",redo:"重做",bold:"加粗",indent:"首行缩进",snapscreen:"截图",italic:"斜体",underline:"下划线",strikethrough:"删除线",subscript:"下标",fontborder:"字符边框",superscript:"上标",formatmatch:"格式刷",source:"源代码",blockquote:"引用",pasteplain:"纯文本粘贴模式",selectall:"全选",print:"打印",preview:"预览",horizontal:"分隔线",removeformat:"清除格式",time:"时间",date:"日期",unlink:"取消链接",insertrow:"前插入行",insertcol:"前插入列",mergeright:"右合并单元格",mergedown:"下合并单元格",deleterow:"删除行",deletecol:"删除列",splittorows:"拆分成行",splittocols:"拆分成列",splittocells:"完全拆分单元格",mergecells:"合并多个单元格",deletetable:"删除表格",cleardoc:"清空文档",insertparagraphbeforetable:"表格前插入行",insertcode:"代码语言",fontfamily:"字体",fontsize:"字号",paragraph:"段落格式",image:"图片",edittable:"表格属性",edittd:"单元格属性",link:"超链接",emotion:"表情",spechars:"特殊字符",searchreplace:"查询替换",map:"百度地图",gmap:"Google地图",video:"视频",help:"帮助",justifyleft:"居左对齐",justifyright:"居右对齐",justifycenter:"居中对齐",justifyjustify:"两端对齐",forecolor:"字体颜色",backcolor:"背景色",insertorderedlist:"有序列表",insertunorderedlist:"无序列表",fullscreen:"全屏",directionalityltr:"从左向右输入",directionalityrtl:"从右向左输入",rowspacingtop:"段前距",rowspacingbottom:"段后距",highlightcode:"插入代码",pagebreak:"分页",insertframe:"插入Iframe",imagenone:"默认",imageleft:"左浮动",imageright:"右浮动",attachment:"附件",imagecenter:"居中",wordimage:"图片转存",lineheight:"行间距",edittip:"编辑提示",customstyle:"自定义标题",autotypeset:"自动排版",webapp:"百度应用",touppercase:"字母大写",tolowercase:"字母小写",background:"背景",template:"模板",scrawl:"涂鸦",music:"音乐",inserttable:"插入表格",drafts:"草稿箱",formula:"数学公式"},paragraph:{p:"段落",h1:"标题 1",h2:"标题 2",h3:"标题 3",h4:"标题 4",h5:"标题 5",h6:"标题 6"},fontfamily:{songti:"宋体",kaiti:"楷体",heiti:"黑体",lishu:"隶书",yahei:"微软雅黑",andaleMono:"andale mono",arial:"arial",arialBlack:"arial black",comicSansMs:"comic sans ms",impact:"impact",timesNewRoman:"times new roman"},ok:"确认",cancel:"取消",closeDialog:"关闭对话框",tableDrag:"表格拖动必须引入uiUtils.js文件！",autofloatMsg:"工具栏浮动依赖编辑器UI，您首先需要引入UI文件!",anthorMsg:"链接",clearColor:"清空颜色",standardColor:"标准颜色",themeColor:"主题颜色",property:"属性","default":"默认",modify:"修改",justifyleft:"左对齐",justifyright:"右对齐",justifycenter:"居中",justify:"默认",clear:"清除",anchorMsg:"锚点","delete":"删除",clickToUpload:"点击上传",unset:"尚未设置语言文件",t_row:"行",t_col:"列",more:"更多",pasteOpt:"粘贴选项",pasteSourceFormat:"保留源格式",tagFormat:"只保留标签",pasteTextFormat:"只保留文本",image:{"static":{lang_tab_local:"本地上传",lang_tab_imgSearch:"网络图片",lang_input_dragTip:"支持图片拖拽上传",lang_btn_add:"添加"},uploadError:"上传出错"},emotion:{"static":{lang_input_choice:"精选",lang_input_Tuzki:"兔斯基",lang_input_BOBO:"BOBO",lang_input_lvdouwa:"绿豆蛙",lang_input_babyCat:"baby猫",lang_input_bubble:"泡泡",lang_input_youa:"有啊"}},gmap:{"static":{lang_input_address:"地址",lang_input_search:"搜索",address:{value:"北京"}},searchError:"无法定位到该地址!"},link:{"static":{lang_input_text:"文本内容：",lang_input_url:"链接地址：",lang_input_title:"标题：",lang_input_target:"是否在新窗口打开："},validLink:"只支持选中一个链接时生效",httpPrompt:"您输入的超链接中不包含http等协议名称，默认将为您添加http://前缀"},map:{"static":{lang_city:"城市",lang_address:"地址",city:{value:"北京"},lang_search:"搜索",lang_dynamicmap:"插入动态地图"},cityMsg:"请选择城市",errorMsg:"抱歉，找不到该位置！"},video:{"static":{lang_tab_insertV:"插入视频",lang_video_url:"视频网址",lang_video_size:"视频尺寸",lang_videoW:"宽度",lang_videoH:"高度",lang_alignment:"对齐方式",videoSearchTxt:{value:"请输入搜索关键字！"},videoType:{options:["全部","热门","娱乐","搞笑","体育","科技","综艺"]},videoSearchBtn:{value:"百度一下"},videoSearchReset:{value:"清空结果"}},numError:"请输入正确的数值，如123,400",floatLeft:"左浮动",floatRight:"右浮动","default":"默认",block:"独占一行",urlError:"输入的视频地址有误，请检查后再试！",loading:" &nbsp;视频加载中，请等待……",clickToSelect:"点击选中",goToSource:"访问源视频",noVideo:" &nbsp; &nbsp;抱歉，找不到对应的视频，请重试！"},formula:{"static":{lang_tab_common:"常用公式",lang_tab_symbol:"符号",lang_tab_letter:"字母"}}};